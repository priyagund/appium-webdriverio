"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = void 0;

require("source-map-support/register");

var _remoteMessages = _interopRequireDefault(require("./remote-messages"));

var _asyncbox = require("asyncbox");

var _logger = _interopRequireDefault(require("../logger"));

var _lodash = _interopRequireDefault(require("lodash"));

var _bluebird = _interopRequireDefault(require("bluebird"));

var _rpcMessageHandler = _interopRequireDefault(require("./rpc-message-handler"));

var _support = require("appium/support");

const DATA_LOG_LENGTH = {
  length: 200
};
const WAIT_FOR_TARGET_TIMEOUT = 10000;
const WAIT_FOR_TARGET_INTERVAL = 1000;
const MIN_PLATFORM_FOR_TARGET_BASED = '12.2';
const MIN_PLATFORM_NO_TARGET_EXISTS = '13.4';

function isTargetBased(isSafari, platformVersion) {
  const isHighVersion = _support.util.compareVersions(platformVersion, '>=', MIN_PLATFORM_FOR_TARGET_BASED);

  _logger.default.debug(`Checking which communication style to use (${isSafari ? '' : 'non-'}Safari on platform version '${platformVersion}')`);

  _logger.default.debug(`Platform version equal or higher than '${MIN_PLATFORM_FOR_TARGET_BASED}': ${isHighVersion}`);

  return isHighVersion;
}

class RpcClient {
  constructor(opts = {}) {
    this._targets = [];
    this._shouldCheckForTarget = !!opts.shouldCheckForTarget;
    const {
      bundleId,
      platformVersion = {},
      isSafari = true,
      logAllCommunication = false,
      logAllCommunicationHexDump = false,
      webInspectorMaxFrameLength,
      socketChunkSize,
      fullPageInitialization = false
    } = opts;
    this.isSafari = isSafari;
    this.isConnected = false;
    this.connId = _support.util.uuidV4();
    this.senderId = _support.util.uuidV4();
    this.msgId = 0;
    this.logAllCommunication = logAllCommunication;
    this.logAllCommunicationHexDump = logAllCommunicationHexDump;
    this.socketChunkSize = socketChunkSize;
    this.webInspectorMaxFrameLength = webInspectorMaxFrameLength;
    this.fullPageInitialization = fullPageInitialization;
    this.bundleId = bundleId;
    this.platformVersion = platformVersion;
    this._contexts = [];
    this._targets = {};
    this.isTargetBased = isTargetBased(isSafari, this.platformVersion);
  }

  get contexts() {
    return this._contexts;
  }

  get needsTarget() {
    return this.shouldCheckForTarget && this.isTargetBased;
  }

  get targets() {
    return this._targets;
  }

  get shouldCheckForTarget() {
    return this._shouldCheckForTarget;
  }

  set shouldCheckForTarget(shouldCheckForTarget) {
    this._shouldCheckForTarget = !!shouldCheckForTarget;
  }

  get isConnected() {
    return this.connected;
  }

  set isConnected(connected) {
    this.connected = !!connected;
  }

  on(event, listener) {
    this.messageHandler.on(event, listener);
    return this;
  }

  once(event, listener) {
    this.messageHandler.once(event, listener);
    return this;
  }

  off(event, listener) {
    this.messageHandler.off(event, listener);
    return this;
  }

  set isTargetBased(isTargetBased) {
    _logger.default.warn(`Setting communication protocol: using ${isTargetBased ? 'Target-based' : 'full Web Inspector protocol'} communication`);

    this._isTargetBased = isTargetBased;

    if (!this.remoteMessages) {
      this.remoteMessages = new _remoteMessages.default(isTargetBased);
    } else {
      this.remoteMessages.isTargetBased = isTargetBased;
    }

    if (!this.messageHandler) {
      this.messageHandler = new _rpcMessageHandler.default(isTargetBased);
      this.messageHandler.on('Target.targetCreated', this.addTarget.bind(this));
      this.messageHandler.on('Target.didCommitProvisionalTarget', this.updateTarget.bind(this));
      this.messageHandler.on('Target.targetDestroyed', this.removeTarget.bind(this));
      this.messageHandler.on('Runtime.executionContextCreated', this.onExecutionContextCreated.bind(this));
      this.messageHandler.on('Heap.garbageCollected', this.onGarbageCollected.bind(this));
    } else {
      this.messageHandler.isTargetBased = isTargetBased;
    }
  }

  get isTargetBased() {
    return this._isTargetBased;
  }

  async waitForTarget(appIdKey, pageIdKey, force = false) {
    if (!force && !this.needsTarget) {
      return;
    }

    if (this.getTarget(appIdKey, pageIdKey)) {
      return;
    }

    try {
      await (0, _asyncbox.waitForCondition)(() => !_lodash.default.isEmpty(this.getTarget(appIdKey, pageIdKey)), {
        waitMs: WAIT_FOR_TARGET_TIMEOUT,
        intervalMs: WAIT_FOR_TARGET_INTERVAL,
        error: 'No targets found, unable to communicate with device'
      });
    } catch (err) {
      if (!err.message.includes('Condition unmet')) {
        throw err;
      }

      throw new Error('No targets found, unable to communicate with device');
    }
  }

  async send(command, opts = {}, waitForResponse = true) {
    const timer = new _support.timing.Timer().start();
    const {
      appIdKey,
      pageIdKey
    } = opts;

    try {
      if (!_lodash.default.isEmpty(appIdKey) && !_lodash.default.isEmpty(pageIdKey)) {
        await this.waitForTarget(appIdKey, pageIdKey);
      }

      return await this.sendToDevice(command, opts, waitForResponse);
    } catch (err) {
      let {
        message = ''
      } = err;
      message = message.toLowerCase();

      if (message.includes(`'target' domain was not found`)) {
        _logger.default.info('The target device does not support Target based communication. ' + 'Will follow non-target based communication.');

        this.isTargetBased = false;
        return await this.sendToDevice(command, opts, waitForResponse);
      } else if (message.includes(`domain was not found`) || message.includes(`some arguments of method`) || message.includes(`missing target`)) {
        this.isTargetBased = true;
        await this.waitForTarget(appIdKey, pageIdKey);
        return await this.sendToDevice(command, opts, waitForResponse);
      }

      throw err;
    } finally {
      _logger.default.debug(`Sending to Web Inspector took ${timer.getDuration().asMilliSeconds.toFixed(0)}ms`);
    }
  }

  async sendToDevice(command, opts = {}, waitForResponse = true) {
    return await new _bluebird.default(async (resolve, reject) => {
      var _cmd$__argument, _cmd$__argument2;

      const msgId = this.msgId++;
      let wrapperMsgId = msgId;

      if (this.isTargetBased) {
        wrapperMsgId = this.msgId++;
        this.messageHandler.on(wrapperMsgId.toString(), function (err) {
          if (err) {
            reject(err);
          }
        });
      }

      const appIdKey = opts.appIdKey;
      const pageIdKey = opts.pageIdKey;
      const targetId = this.getTarget(appIdKey, pageIdKey);

      const fullOpts = _lodash.default.defaults({
        connId: this.connId,
        senderId: this.senderId,
        targetId,
        id: msgId
      }, opts);

      const cmd = this.remoteMessages.getRemoteCommand(command, fullOpts);

      if (cmd !== null && cmd !== void 0 && (_cmd$__argument = cmd.__argument) !== null && _cmd$__argument !== void 0 && _cmd$__argument.WIRSocketDataKey) {
        if (_lodash.default.isNil(cmd.__argument.WIRSocketDataKey.id)) {
          cmd.__argument.WIRSocketDataKey.id = wrapperMsgId;
        }

        cmd.__argument.WIRSocketDataKey = Buffer.from(JSON.stringify(cmd.__argument.WIRSocketDataKey));
      }

      let messageHandled = true;

      if (!waitForResponse) {
        messageHandled = false;
        this.messageHandler.once(msgId.toString(), function (err) {
          if (err) {
            _logger.default.error(`Received error from send that is not being waited for (id: ${msgId}): '${_lodash.default.truncate(JSON.stringify(err), DATA_LOG_LENGTH)}'`);

            reject(err);
          }
        });
      } else if (this.messageHandler.listeners(cmd.__selector).length) {
        this.messageHandler.prependOnceListener(cmd.__selector, function (err, ...args) {
          if (err) {
            return reject(err);
          }

          _logger.default.debug(`Received response from send (id: ${msgId}): '${_lodash.default.truncate(JSON.stringify(args), DATA_LOG_LENGTH)}'`);

          resolve(args);
        });
      } else if (cmd !== null && cmd !== void 0 && (_cmd$__argument2 = cmd.__argument) !== null && _cmd$__argument2 !== void 0 && _cmd$__argument2.WIRSocketDataKey) {
        this.messageHandler.once(msgId.toString(), function (err, value) {
          if (err) {
            return reject(new Error(`Remote debugger error with code '${err.code}': ${err.message}`));
          }

          _logger.default.debug(`Received data response from send (id: ${msgId}): '${_lodash.default.truncate(JSON.stringify(value), DATA_LOG_LENGTH)}'`);

          resolve(value);
        });
      } else {
        messageHandled = false;
      }

      const msg = `Sending '${cmd.__selector}' message` + (fullOpts.appIdKey ? ` to app '${fullOpts.appIdKey}'` : '') + (fullOpts.pageIdKey ? `, page '${fullOpts.pageIdKey}'` : '') + (this.needsTarget && targetId ? `, target '${targetId}'` : '') + ` (id: ${msgId}): '${command}'`;

      _logger.default.debug(msg);

      try {
        const res = await this.sendMessage(cmd);

        if (!messageHandled) {
          resolve(res);
        }
      } catch (err) {
        return reject(err);
      }
    });
  }

  async connect() {
    throw new Error(`Sub-classes need to implement a 'connect' function`);
  }

  async disconnect() {
    this.messageHandler.removeAllListeners();
  }

  async sendMessage() {
    throw new Error(`Sub-classes need to implement a 'sendMessage' function`);
  }

  async receive() {
    throw new Error(`Sub-classes need to implement a 'receive' function`);
  }

  addTarget(err, app, targetInfo) {
    if (_lodash.default.isNil(targetInfo === null || targetInfo === void 0 ? void 0 : targetInfo.targetId)) {
      _logger.default.warn(`Received 'Target.targetCreated' event for app '${app}' with no target. Skipping`);

      return;
    }

    if (_lodash.default.isEmpty(this.pendingTargetNotification) && !targetInfo.isProvisional) {
      _logger.default.warn(`Received 'Target.targetCreated' event for app '${app}' with no pending request: ${JSON.stringify(targetInfo)}`);

      return;
    }

    if (targetInfo.isProvisional) {
      _logger.default.debug(`Provisional target created for app '${app}', '${targetInfo.targetId}'. Ignoring until target update event`);

      return;
    }

    const [appIdKey, pageIdKey] = this.pendingTargetNotification;

    _logger.default.debug(`Target created for app '${appIdKey}' and page '${pageIdKey}': ${JSON.stringify(targetInfo)}`);

    if (_lodash.default.has(this.targets[appIdKey], pageIdKey)) {
      _logger.default.debug(`There is already a target for this app and page ('${this.targets[appIdKey][pageIdKey]}'). This might cause problems`);
    }

    this.targets[app] = this.targets[app] || {};
    this.targets[appIdKey][pageIdKey] = targetInfo.targetId;
  }

  updateTarget(err, app, oldTargetId, newTargetId) {
    _logger.default.debug(`Target updated for app '${app}'. Old target: '${oldTargetId}', new target: '${newTargetId}'`);

    if (!this.targets[app]) {
      _logger.default.warn(`No existing target for app '${app}'. Not sure what to do`);

      return;
    }

    this.targets[app].provisional = {
      oldTargetId,
      newTargetId
    };
  }

  removeTarget(err, app, targetInfo) {
    var _this$targets$app, _this$targets$app$pro;

    if (_lodash.default.isNil(targetInfo === null || targetInfo === void 0 ? void 0 : targetInfo.targetId)) {
      _logger.default.debug(`Received 'Target.targetDestroyed' event with no target. Skipping`);

      return;
    }

    _logger.default.debug(`Target destroyed for app '${app}': ${targetInfo.targetId}`);

    if (((_this$targets$app = this.targets[app]) === null || _this$targets$app === void 0 ? void 0 : (_this$targets$app$pro = _this$targets$app.provisional) === null || _this$targets$app$pro === void 0 ? void 0 : _this$targets$app$pro.oldTargetId) === targetInfo.targetId) {
      const {
        oldTargetId,
        newTargetId
      } = this.targets[app].provisional;
      delete this.targets[app].provisional;
      const targets = this.targets[app];

      for (const [page, targetId] of _lodash.default.toPairs(targets)) {
        if (targetId === oldTargetId) {
          _logger.default.debug(`Found provisional target for app '${app}'. Old target: '${oldTargetId}', new target: '${newTargetId}'. Updating`);

          targets[page] = newTargetId;
          return;
        }
      }

      _logger.default.warn(`Provisional target for app '${app}' found, but no suitable existing target found. This may cause problems`);

      _logger.default.warn(`Old target: '${oldTargetId}', new target: '${newTargetId}'. Existing targets: ${JSON.stringify(targets)}`);
    }

    const targets = this.targets[app];

    for (const [page, targetId] of _lodash.default.toPairs(targets)) {
      if (targetId === targetInfo.targetId) {
        delete targets[page];
        return;
      }
    }

    _logger.default.debug(`Target '${targetInfo.targetId}' deleted for app '${app}', but no such target exists`);
  }

  getTarget(appIdKey, pageIdKey) {
    return (this.targets[appIdKey] || {})[pageIdKey];
  }

  async selectPage(appIdKey, pageIdKey) {
    this.pendingTargetNotification = [appIdKey, pageIdKey];
    this.shouldCheckForTarget = false;
    const sendOpts = {
      appIdKey,
      pageIdKey
    };

    for (const enabled of [true, false]) {
      await this.send('indicateWebView', Object.assign({
        enabled
      }, sendOpts), false);
    }

    await this.send('setSenderKey', sendOpts);

    _logger.default.debug('Sender key set');

    if (this.isTargetBased && _support.util.compareVersions(this.platformVersion, '<', MIN_PLATFORM_NO_TARGET_EXISTS)) {
      await this.send('Target.exists', sendOpts, false);
    }

    this.shouldCheckForTarget = true;

    if (this.fullPageInitialization) {
      await this.initializePageFull(appIdKey, pageIdKey);
    } else {
      await this.initializePage(appIdKey, pageIdKey);
    }
  }

  async initializePage(appIdKey, pageIdKey) {
    const sendOpts = {
      appIdKey,
      pageIdKey
    };
    await this.send('Inspector.enable', sendOpts, false);
    await this.send('Page.enable', sendOpts, false);
    await this.send('Network.enable', sendOpts, false);
    await this.send('Runtime.enable', sendOpts, false);
    await this.send('Heap.enable', sendOpts, false);
    await this.send('Debugger.enable', sendOpts, false);
    await this.send('Console.enable', sendOpts, false);
    await this.send('Inspector.initialized', sendOpts, false);
  }

  async initializePageFull(appIdKey, pageIdKey) {
    const sendOpts = {
      appIdKey,
      pageIdKey
    };
    await this.send('Inspector.enable', sendOpts, false);
    await this.send('Page.enable', sendOpts, false);
    await this.send('Page.getResourceTree', sendOpts, false);
    await this.send('Network.enable', sendOpts, false);
    await this.send('Network.setResourceCachingDisabled', Object.assign({
      disabled: false
    }, sendOpts), false);
    await this.send('DOMStorage.enable', sendOpts, false);
    await this.send('Database.enable', sendOpts, false);
    await this.send('IndexedDB.enable', sendOpts, false);
    await this.send('CSS.enable', sendOpts, false);
    await this.send('Runtime.enable', sendOpts, false);
    await this.send('Heap.enable', sendOpts, false);
    await this.send('Memory.enable', sendOpts, false);
    await this.send('ApplicationCache.enable', sendOpts, false);
    await this.send('ApplicationCache.getFramesWithManifests', sendOpts, false);
    await this.send('Timeline.setInstruments', Object.assign({
      instruments: ['Timeline', 'ScriptProfiler', 'CPU']
    }, sendOpts), false);
    await this.send('Timeline.setAutoCaptureEnabled', Object.assign({
      enabled: false
    }, sendOpts), false);
    await this.send('Debugger.enable', sendOpts, false);
    await this.send('Debugger.setBreakpointsActive', Object.assign({
      active: true
    }, sendOpts), false);
    await this.send('Debugger.setPauseOnExceptions', Object.assign({
      state: 'none'
    }, sendOpts), false);
    await this.send('Debugger.setPauseOnAssertions', Object.assign({
      enabled: false
    }, sendOpts), false);
    await this.send('Debugger.setAsyncStackTraceDepth', Object.assign({
      depth: 200
    }, sendOpts), false);
    await this.send('Debugger.setPauseForInternalScripts', Object.assign({
      shouldPause: false
    }, sendOpts), false);
    await this.send('LayerTree.enable', sendOpts, false);
    await this.send('Worker.enable', sendOpts, false);
    await this.send('Canvas.enable', sendOpts, false);
    await this.send('Console.enable', sendOpts, false);
    await this.send('DOM.getDocument', sendOpts, false);
    const loggingChannels = await this.send('Console.getLoggingChannels', sendOpts);

    for (const source of (loggingChannels.channels || []).map(entry => entry.source)) {
      await this.send('Console.setLoggingChannelLevel', Object.assign({
        source,
        level: 'verbose'
      }, sendOpts), false);
    }

    await this.send('Inspector.initialized', sendOpts, false);
  }

  async selectApp(appIdKey) {
    return await new _bluebird.default((resolve, reject) => {
      const onAppChange = (err, dict) => {
        if (err) {
          return reject(err);
        }

        const oldAppIdKey = dict.WIRHostApplicationIdentifierKey;
        const correctAppIdKey = dict.WIRApplicationIdentifierKey;

        if (oldAppIdKey && correctAppIdKey !== oldAppIdKey) {
          _logger.default.debug(`We were notified we might have connected to the wrong app. ` + `Using id ${correctAppIdKey} instead of ${oldAppIdKey}`);
        }

        reject(new Error('New application has connected'));
      };

      this.messageHandler.prependOnceListener('_rpc_applicationConnected:', onAppChange);
      return (async () => {
        let pageDict, connectedAppIdKey;

        try {
          [connectedAppIdKey, pageDict] = await this.send('connectToApp', {
            appIdKey
          });
        } catch (err) {
          _logger.default.warn(`Unable to connect to app: ${err.message}`);

          reject(err);
        }

        if (_lodash.default.isEmpty(pageDict)) {
          let msg = 'Empty page dictionary received';

          _logger.default.debug(msg);

          reject(new Error(msg));
        } else {
          resolve([connectedAppIdKey, pageDict]);
        }
      })();
    });
  }

  onExecutionContextCreated(err, context) {
    this.contexts.push(context.id);
  }

  onGarbageCollected() {
    _logger.default.debug(`Web Inspector garbage collected`);
  }

  onScriptParsed(err, scriptInfo) {
    _logger.default.debug(`Script parsed: ${JSON.stringify(scriptInfo)}`);
  }

}

exports.default = RpcClient;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJEQVRBX0xPR19MRU5HVEgiLCJsZW5ndGgiLCJXQUlUX0ZPUl9UQVJHRVRfVElNRU9VVCIsIldBSVRfRk9SX1RBUkdFVF9JTlRFUlZBTCIsIk1JTl9QTEFURk9STV9GT1JfVEFSR0VUX0JBU0VEIiwiTUlOX1BMQVRGT1JNX05PX1RBUkdFVF9FWElTVFMiLCJpc1RhcmdldEJhc2VkIiwiaXNTYWZhcmkiLCJwbGF0Zm9ybVZlcnNpb24iLCJpc0hpZ2hWZXJzaW9uIiwidXRpbCIsImNvbXBhcmVWZXJzaW9ucyIsImxvZyIsImRlYnVnIiwiUnBjQ2xpZW50IiwiY29uc3RydWN0b3IiLCJvcHRzIiwiX3RhcmdldHMiLCJfc2hvdWxkQ2hlY2tGb3JUYXJnZXQiLCJzaG91bGRDaGVja0ZvclRhcmdldCIsImJ1bmRsZUlkIiwibG9nQWxsQ29tbXVuaWNhdGlvbiIsImxvZ0FsbENvbW11bmljYXRpb25IZXhEdW1wIiwid2ViSW5zcGVjdG9yTWF4RnJhbWVMZW5ndGgiLCJzb2NrZXRDaHVua1NpemUiLCJmdWxsUGFnZUluaXRpYWxpemF0aW9uIiwiaXNDb25uZWN0ZWQiLCJjb25uSWQiLCJ1dWlkVjQiLCJzZW5kZXJJZCIsIm1zZ0lkIiwiX2NvbnRleHRzIiwiY29udGV4dHMiLCJuZWVkc1RhcmdldCIsInRhcmdldHMiLCJjb25uZWN0ZWQiLCJvbiIsImV2ZW50IiwibGlzdGVuZXIiLCJtZXNzYWdlSGFuZGxlciIsIm9uY2UiLCJvZmYiLCJ3YXJuIiwiX2lzVGFyZ2V0QmFzZWQiLCJyZW1vdGVNZXNzYWdlcyIsIlJlbW90ZU1lc3NhZ2VzIiwiUnBjTWVzc2FnZUhhbmRsZXIiLCJhZGRUYXJnZXQiLCJiaW5kIiwidXBkYXRlVGFyZ2V0IiwicmVtb3ZlVGFyZ2V0Iiwib25FeGVjdXRpb25Db250ZXh0Q3JlYXRlZCIsIm9uR2FyYmFnZUNvbGxlY3RlZCIsIndhaXRGb3JUYXJnZXQiLCJhcHBJZEtleSIsInBhZ2VJZEtleSIsImZvcmNlIiwiZ2V0VGFyZ2V0Iiwid2FpdEZvckNvbmRpdGlvbiIsIl8iLCJpc0VtcHR5Iiwid2FpdE1zIiwiaW50ZXJ2YWxNcyIsImVycm9yIiwiZXJyIiwibWVzc2FnZSIsImluY2x1ZGVzIiwiRXJyb3IiLCJzZW5kIiwiY29tbWFuZCIsIndhaXRGb3JSZXNwb25zZSIsInRpbWVyIiwidGltaW5nIiwiVGltZXIiLCJzdGFydCIsInNlbmRUb0RldmljZSIsInRvTG93ZXJDYXNlIiwiaW5mbyIsImdldER1cmF0aW9uIiwiYXNNaWxsaVNlY29uZHMiLCJ0b0ZpeGVkIiwiQiIsInJlc29sdmUiLCJyZWplY3QiLCJ3cmFwcGVyTXNnSWQiLCJ0b1N0cmluZyIsInRhcmdldElkIiwiZnVsbE9wdHMiLCJkZWZhdWx0cyIsImlkIiwiY21kIiwiZ2V0UmVtb3RlQ29tbWFuZCIsIl9fYXJndW1lbnQiLCJXSVJTb2NrZXREYXRhS2V5IiwiaXNOaWwiLCJCdWZmZXIiLCJmcm9tIiwiSlNPTiIsInN0cmluZ2lmeSIsIm1lc3NhZ2VIYW5kbGVkIiwidHJ1bmNhdGUiLCJsaXN0ZW5lcnMiLCJfX3NlbGVjdG9yIiwicHJlcGVuZE9uY2VMaXN0ZW5lciIsImFyZ3MiLCJ2YWx1ZSIsImNvZGUiLCJtc2ciLCJyZXMiLCJzZW5kTWVzc2FnZSIsImNvbm5lY3QiLCJkaXNjb25uZWN0IiwicmVtb3ZlQWxsTGlzdGVuZXJzIiwicmVjZWl2ZSIsImFwcCIsInRhcmdldEluZm8iLCJwZW5kaW5nVGFyZ2V0Tm90aWZpY2F0aW9uIiwiaXNQcm92aXNpb25hbCIsImhhcyIsIm9sZFRhcmdldElkIiwibmV3VGFyZ2V0SWQiLCJwcm92aXNpb25hbCIsInBhZ2UiLCJ0b1BhaXJzIiwic2VsZWN0UGFnZSIsInNlbmRPcHRzIiwiZW5hYmxlZCIsIk9iamVjdCIsImFzc2lnbiIsImluaXRpYWxpemVQYWdlRnVsbCIsImluaXRpYWxpemVQYWdlIiwiZGlzYWJsZWQiLCJpbnN0cnVtZW50cyIsImFjdGl2ZSIsInN0YXRlIiwiZGVwdGgiLCJzaG91bGRQYXVzZSIsImxvZ2dpbmdDaGFubmVscyIsInNvdXJjZSIsImNoYW5uZWxzIiwibWFwIiwiZW50cnkiLCJsZXZlbCIsInNlbGVjdEFwcCIsIm9uQXBwQ2hhbmdlIiwiZGljdCIsIm9sZEFwcElkS2V5IiwiV0lSSG9zdEFwcGxpY2F0aW9uSWRlbnRpZmllcktleSIsImNvcnJlY3RBcHBJZEtleSIsIldJUkFwcGxpY2F0aW9uSWRlbnRpZmllcktleSIsInBhZ2VEaWN0IiwiY29ubmVjdGVkQXBwSWRLZXkiLCJjb250ZXh0IiwicHVzaCIsIm9uU2NyaXB0UGFyc2VkIiwic2NyaXB0SW5mbyJdLCJzb3VyY2VzIjpbIi4uLy4uLy4uL2xpYi9ycGMvcnBjLWNsaWVudC5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgUmVtb3RlTWVzc2FnZXMgZnJvbSAnLi9yZW1vdGUtbWVzc2FnZXMnO1xuaW1wb3J0IHsgd2FpdEZvckNvbmRpdGlvbiB9IGZyb20gJ2FzeW5jYm94JztcbmltcG9ydCBsb2cgZnJvbSAnLi4vbG9nZ2VyJztcbmltcG9ydCBfIGZyb20gJ2xvZGFzaCc7XG5pbXBvcnQgQiBmcm9tICdibHVlYmlyZCc7XG5pbXBvcnQgUnBjTWVzc2FnZUhhbmRsZXIgZnJvbSAnLi9ycGMtbWVzc2FnZS1oYW5kbGVyJztcbmltcG9ydCB7IHV0aWwsIHRpbWluZyB9IGZyb20gJ2FwcGl1bS9zdXBwb3J0JztcblxuXG5jb25zdCBEQVRBX0xPR19MRU5HVEggPSB7bGVuZ3RoOiAyMDB9O1xuXG5jb25zdCBXQUlUX0ZPUl9UQVJHRVRfVElNRU9VVCA9IDEwMDAwO1xuY29uc3QgV0FJVF9GT1JfVEFSR0VUX0lOVEVSVkFMID0gMTAwMDtcblxuY29uc3QgTUlOX1BMQVRGT1JNX0ZPUl9UQVJHRVRfQkFTRUQgPSAnMTIuMic7XG5cbi8vIGBUYXJnZXQuZXhpc3RzYCBwcm90b2NvbCBtZXRob2Qgd2FzIHJlbW92ZWQgZnJvbSBXZWJLaXRpbiAxMy40XG5jb25zdCBNSU5fUExBVEZPUk1fTk9fVEFSR0VUX0VYSVNUUyA9ICcxMy40JztcblxuZnVuY3Rpb24gaXNUYXJnZXRCYXNlZCAoaXNTYWZhcmksIHBsYXRmb3JtVmVyc2lvbikge1xuICAvLyBPbiBpT1MgMTIuMiB0aGUgbWVzc2FnZXMgZ2V0IHNlbnQgdGhyb3VnaCB0aGUgVGFyZ2V0IGRvbWFpblxuICAvLyBPbiBpT1MgMTMuMCssIFdLV2ViVmlldyBhbHNvIG5lZWRzIHRvIGZvbGxvdyB0aGUgVGFyZ2V0IGRvbWFpbixcbiAgLy8gc28gaGVyZSBvbmx5IGNoZWNrIHRoZSB0YXJnZXQgT1MgdmVyc2lvbiBhcyB0aGUgZGVmYXVsdCBiZWhhdmlvdXIuXG4gIGNvbnN0IGlzSGlnaFZlcnNpb24gPSB1dGlsLmNvbXBhcmVWZXJzaW9ucyhwbGF0Zm9ybVZlcnNpb24sICc+PScsIE1JTl9QTEFURk9STV9GT1JfVEFSR0VUX0JBU0VEKTtcbiAgbG9nLmRlYnVnKGBDaGVja2luZyB3aGljaCBjb21tdW5pY2F0aW9uIHN0eWxlIHRvIHVzZSAoJHtpc1NhZmFyaSA/ICcnIDogJ25vbi0nfVNhZmFyaSBvbiBwbGF0Zm9ybSB2ZXJzaW9uICcke3BsYXRmb3JtVmVyc2lvbn0nKWApO1xuICBsb2cuZGVidWcoYFBsYXRmb3JtIHZlcnNpb24gZXF1YWwgb3IgaGlnaGVyIHRoYW4gJyR7TUlOX1BMQVRGT1JNX0ZPUl9UQVJHRVRfQkFTRUR9JzogJHtpc0hpZ2hWZXJzaW9ufWApO1xuICByZXR1cm4gaXNIaWdoVmVyc2lvbjtcbn1cblxuZXhwb3J0IGRlZmF1bHQgY2xhc3MgUnBjQ2xpZW50IHtcbiAgY29uc3RydWN0b3IgKG9wdHMgPSB7fSkge1xuICAgIHRoaXMuX3RhcmdldHMgPSBbXTtcbiAgICB0aGlzLl9zaG91bGRDaGVja0ZvclRhcmdldCA9ICEhb3B0cy5zaG91bGRDaGVja0ZvclRhcmdldDtcblxuICAgIGNvbnN0IHtcbiAgICAgIGJ1bmRsZUlkLFxuICAgICAgcGxhdGZvcm1WZXJzaW9uID0ge30sXG4gICAgICBpc1NhZmFyaSA9IHRydWUsXG4gICAgICBsb2dBbGxDb21tdW5pY2F0aW9uID0gZmFsc2UsXG4gICAgICBsb2dBbGxDb21tdW5pY2F0aW9uSGV4RHVtcCA9IGZhbHNlLFxuICAgICAgd2ViSW5zcGVjdG9yTWF4RnJhbWVMZW5ndGgsXG4gICAgICBzb2NrZXRDaHVua1NpemUsXG4gICAgICBmdWxsUGFnZUluaXRpYWxpemF0aW9uID0gZmFsc2UsXG4gICAgfSA9IG9wdHM7XG5cbiAgICB0aGlzLmlzU2FmYXJpID0gaXNTYWZhcmk7XG5cbiAgICB0aGlzLmlzQ29ubmVjdGVkID0gZmFsc2U7XG4gICAgdGhpcy5jb25uSWQgPSB1dGlsLnV1aWRWNCgpO1xuICAgIHRoaXMuc2VuZGVySWQgPSB1dGlsLnV1aWRWNCgpO1xuICAgIHRoaXMubXNnSWQgPSAwO1xuXG4gICAgdGhpcy5sb2dBbGxDb21tdW5pY2F0aW9uID0gbG9nQWxsQ29tbXVuaWNhdGlvbjtcbiAgICB0aGlzLmxvZ0FsbENvbW11bmljYXRpb25IZXhEdW1wID0gbG9nQWxsQ29tbXVuaWNhdGlvbkhleER1bXA7XG4gICAgdGhpcy5zb2NrZXRDaHVua1NpemUgPSBzb2NrZXRDaHVua1NpemU7XG4gICAgdGhpcy53ZWJJbnNwZWN0b3JNYXhGcmFtZUxlbmd0aCA9IHdlYkluc3BlY3Rvck1heEZyYW1lTGVuZ3RoO1xuXG4gICAgdGhpcy5mdWxsUGFnZUluaXRpYWxpemF0aW9uID0gZnVsbFBhZ2VJbml0aWFsaXphdGlvbjtcblxuICAgIHRoaXMuYnVuZGxlSWQgPSBidW5kbGVJZDtcbiAgICB0aGlzLnBsYXRmb3JtVmVyc2lvbiA9IHBsYXRmb3JtVmVyc2lvbjtcblxuICAgIHRoaXMuX2NvbnRleHRzID0gW107XG4gICAgdGhpcy5fdGFyZ2V0cyA9IHt9O1xuXG4gICAgLy8gc3RhcnQgd2l0aCBhIGJlc3QgZ3Vlc3MgZm9yIHRoZSBwcm90b2NvbFxuICAgIHRoaXMuaXNUYXJnZXRCYXNlZCA9IGlzVGFyZ2V0QmFzZWQoaXNTYWZhcmksIHRoaXMucGxhdGZvcm1WZXJzaW9uKTtcbiAgfVxuXG4gIGdldCBjb250ZXh0cyAoKSB7XG4gICAgcmV0dXJuIHRoaXMuX2NvbnRleHRzO1xuICB9XG5cbiAgZ2V0IG5lZWRzVGFyZ2V0ICgpIHtcbiAgICByZXR1cm4gdGhpcy5zaG91bGRDaGVja0ZvclRhcmdldCAmJiB0aGlzLmlzVGFyZ2V0QmFzZWQ7XG4gIH1cblxuICBnZXQgdGFyZ2V0cyAoKSB7XG4gICAgcmV0dXJuIHRoaXMuX3RhcmdldHM7XG4gIH1cblxuICBnZXQgc2hvdWxkQ2hlY2tGb3JUYXJnZXQgKCkge1xuICAgIHJldHVybiB0aGlzLl9zaG91bGRDaGVja0ZvclRhcmdldDtcbiAgfVxuXG4gIHNldCBzaG91bGRDaGVja0ZvclRhcmdldCAoc2hvdWxkQ2hlY2tGb3JUYXJnZXQpIHtcbiAgICB0aGlzLl9zaG91bGRDaGVja0ZvclRhcmdldCA9ICEhc2hvdWxkQ2hlY2tGb3JUYXJnZXQ7XG4gIH1cblxuICBnZXQgaXNDb25uZWN0ZWQgKCkge1xuICAgIHJldHVybiB0aGlzLmNvbm5lY3RlZDtcbiAgfVxuXG4gIHNldCBpc0Nvbm5lY3RlZCAoY29ubmVjdGVkKSB7XG4gICAgdGhpcy5jb25uZWN0ZWQgPSAhIWNvbm5lY3RlZDtcbiAgfVxuXG4gIG9uIChldmVudCwgbGlzdGVuZXIpIHtcbiAgICB0aGlzLm1lc3NhZ2VIYW5kbGVyLm9uKGV2ZW50LCBsaXN0ZW5lcik7XG4gICAgcmV0dXJuIHRoaXM7XG4gIH1cblxuICBvbmNlIChldmVudCwgbGlzdGVuZXIpIHtcbiAgICB0aGlzLm1lc3NhZ2VIYW5kbGVyLm9uY2UoZXZlbnQsIGxpc3RlbmVyKTtcbiAgICByZXR1cm4gdGhpcztcbiAgfVxuXG4gIG9mZiAoZXZlbnQsIGxpc3RlbmVyKSB7XG4gICAgdGhpcy5tZXNzYWdlSGFuZGxlci5vZmYoZXZlbnQsIGxpc3RlbmVyKTtcbiAgICByZXR1cm4gdGhpcztcbiAgfVxuXG4gIHNldCBpc1RhcmdldEJhc2VkIChpc1RhcmdldEJhc2VkKSB7XG4gICAgbG9nLndhcm4oYFNldHRpbmcgY29tbXVuaWNhdGlvbiBwcm90b2NvbDogdXNpbmcgJHtpc1RhcmdldEJhc2VkID8gJ1RhcmdldC1iYXNlZCcgOiAnZnVsbCBXZWIgSW5zcGVjdG9yIHByb3RvY29sJ30gY29tbXVuaWNhdGlvbmApO1xuICAgIHRoaXMuX2lzVGFyZ2V0QmFzZWQgPSBpc1RhcmdldEJhc2VkO1xuXG4gICAgaWYgKCF0aGlzLnJlbW90ZU1lc3NhZ2VzKSB7XG4gICAgICB0aGlzLnJlbW90ZU1lc3NhZ2VzID0gbmV3IFJlbW90ZU1lc3NhZ2VzKGlzVGFyZ2V0QmFzZWQpO1xuICAgIH0gZWxzZSB7XG4gICAgICB0aGlzLnJlbW90ZU1lc3NhZ2VzLmlzVGFyZ2V0QmFzZWQgPSBpc1RhcmdldEJhc2VkO1xuICAgIH1cblxuICAgIGlmICghdGhpcy5tZXNzYWdlSGFuZGxlcikge1xuICAgICAgdGhpcy5tZXNzYWdlSGFuZGxlciA9IG5ldyBScGNNZXNzYWdlSGFuZGxlcihpc1RhcmdldEJhc2VkKTtcblxuICAgICAgLy8gYWRkIGhhbmRsZXJzIGZvciBpbnRlcm5hbCBldmVudHNcbiAgICAgIHRoaXMubWVzc2FnZUhhbmRsZXIub24oJ1RhcmdldC50YXJnZXRDcmVhdGVkJywgdGhpcy5hZGRUYXJnZXQuYmluZCh0aGlzKSk7XG4gICAgICB0aGlzLm1lc3NhZ2VIYW5kbGVyLm9uKCdUYXJnZXQuZGlkQ29tbWl0UHJvdmlzaW9uYWxUYXJnZXQnLCB0aGlzLnVwZGF0ZVRhcmdldC5iaW5kKHRoaXMpKTtcbiAgICAgIHRoaXMubWVzc2FnZUhhbmRsZXIub24oJ1RhcmdldC50YXJnZXREZXN0cm95ZWQnLCB0aGlzLnJlbW92ZVRhcmdldC5iaW5kKHRoaXMpKTtcbiAgICAgIHRoaXMubWVzc2FnZUhhbmRsZXIub24oJ1J1bnRpbWUuZXhlY3V0aW9uQ29udGV4dENyZWF0ZWQnLCB0aGlzLm9uRXhlY3V0aW9uQ29udGV4dENyZWF0ZWQuYmluZCh0aGlzKSk7XG4gICAgICB0aGlzLm1lc3NhZ2VIYW5kbGVyLm9uKCdIZWFwLmdhcmJhZ2VDb2xsZWN0ZWQnLCB0aGlzLm9uR2FyYmFnZUNvbGxlY3RlZC5iaW5kKHRoaXMpKTtcbiAgICB9IGVsc2Uge1xuICAgICAgdGhpcy5tZXNzYWdlSGFuZGxlci5pc1RhcmdldEJhc2VkID0gaXNUYXJnZXRCYXNlZDtcbiAgICB9XG4gIH1cblxuICBnZXQgaXNUYXJnZXRCYXNlZCAoKSB7XG4gICAgcmV0dXJuIHRoaXMuX2lzVGFyZ2V0QmFzZWQ7XG4gIH1cblxuICBhc3luYyB3YWl0Rm9yVGFyZ2V0IChhcHBJZEtleSwgcGFnZUlkS2V5LCBmb3JjZSA9IGZhbHNlKSB7XG4gICAgaWYgKCFmb3JjZSAmJiAhdGhpcy5uZWVkc1RhcmdldCkge1xuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIGlmICh0aGlzLmdldFRhcmdldChhcHBJZEtleSwgcGFnZUlkS2V5KSkge1xuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIC8vIG90aGVyd2lzZSB3YWl0aW5nIGlzIG5lY2Vzc2FyeSB0byBzZWUgd2hhdCB0aGUgdGFyZ2V0IGlzXG4gICAgdHJ5IHtcbiAgICAgIGF3YWl0IHdhaXRGb3JDb25kaXRpb24oKCkgPT4gIV8uaXNFbXB0eSh0aGlzLmdldFRhcmdldChhcHBJZEtleSwgcGFnZUlkS2V5KSksIHtcbiAgICAgICAgd2FpdE1zOiBXQUlUX0ZPUl9UQVJHRVRfVElNRU9VVCxcbiAgICAgICAgaW50ZXJ2YWxNczogV0FJVF9GT1JfVEFSR0VUX0lOVEVSVkFMLFxuICAgICAgICBlcnJvcjogJ05vIHRhcmdldHMgZm91bmQsIHVuYWJsZSB0byBjb21tdW5pY2F0ZSB3aXRoIGRldmljZScsXG4gICAgICB9KTtcbiAgICB9IGNhdGNoIChlcnIpIHtcbiAgICAgIGlmICghZXJyLm1lc3NhZ2UuaW5jbHVkZXMoJ0NvbmRpdGlvbiB1bm1ldCcpKSB7XG4gICAgICAgIHRocm93IGVycjtcbiAgICAgIH1cbiAgICAgIHRocm93IG5ldyBFcnJvcignTm8gdGFyZ2V0cyBmb3VuZCwgdW5hYmxlIHRvIGNvbW11bmljYXRlIHdpdGggZGV2aWNlJyk7XG4gICAgfVxuICB9XG5cbiAgYXN5bmMgc2VuZCAoY29tbWFuZCwgb3B0cyA9IHt9LCB3YWl0Rm9yUmVzcG9uc2UgPSB0cnVlKSB7XG4gICAgY29uc3QgdGltZXIgPSBuZXcgdGltaW5nLlRpbWVyKCkuc3RhcnQoKTtcbiAgICBjb25zdCB7XG4gICAgICBhcHBJZEtleSxcbiAgICAgIHBhZ2VJZEtleVxuICAgIH0gPSBvcHRzO1xuICAgIHRyeSB7XG4gICAgICBpZiAoIV8uaXNFbXB0eShhcHBJZEtleSkgJiYgIV8uaXNFbXB0eShwYWdlSWRLZXkpKSB7XG4gICAgICAgIGF3YWl0IHRoaXMud2FpdEZvclRhcmdldChhcHBJZEtleSwgcGFnZUlkS2V5KTtcbiAgICAgIH1cbiAgICAgIHJldHVybiBhd2FpdCB0aGlzLnNlbmRUb0RldmljZShjb21tYW5kLCBvcHRzLCB3YWl0Rm9yUmVzcG9uc2UpO1xuICAgIH0gY2F0Y2ggKGVycikge1xuICAgICAgbGV0IHsgbWVzc2FnZSA9ICcnIH0gPSBlcnI7XG4gICAgICBtZXNzYWdlID0gbWVzc2FnZS50b0xvd2VyQ2FzZSgpO1xuICAgICAgaWYgKG1lc3NhZ2UuaW5jbHVkZXMoYCd0YXJnZXQnIGRvbWFpbiB3YXMgbm90IGZvdW5kYCkpIHtcbiAgICAgICAgbG9nLmluZm8oJ1RoZSB0YXJnZXQgZGV2aWNlIGRvZXMgbm90IHN1cHBvcnQgVGFyZ2V0IGJhc2VkIGNvbW11bmljYXRpb24uICcgK1xuICAgICAgICAgICdXaWxsIGZvbGxvdyBub24tdGFyZ2V0IGJhc2VkIGNvbW11bmljYXRpb24uJyk7XG4gICAgICAgIHRoaXMuaXNUYXJnZXRCYXNlZCA9IGZhbHNlO1xuICAgICAgICByZXR1cm4gYXdhaXQgdGhpcy5zZW5kVG9EZXZpY2UoY29tbWFuZCwgb3B0cywgd2FpdEZvclJlc3BvbnNlKTtcbiAgICAgIH0gZWxzZSBpZiAobWVzc2FnZS5pbmNsdWRlcyhgZG9tYWluIHdhcyBub3QgZm91bmRgKSB8fFxuICAgICAgICAgIG1lc3NhZ2UuaW5jbHVkZXMoYHNvbWUgYXJndW1lbnRzIG9mIG1ldGhvZGApIHx8XG4gICAgICAgICAgbWVzc2FnZS5pbmNsdWRlcyhgbWlzc2luZyB0YXJnZXRgKSkge1xuICAgICAgICB0aGlzLmlzVGFyZ2V0QmFzZWQgPSB0cnVlO1xuICAgICAgICBhd2FpdCB0aGlzLndhaXRGb3JUYXJnZXQoYXBwSWRLZXksIHBhZ2VJZEtleSk7XG4gICAgICAgIHJldHVybiBhd2FpdCB0aGlzLnNlbmRUb0RldmljZShjb21tYW5kLCBvcHRzLCB3YWl0Rm9yUmVzcG9uc2UpO1xuICAgICAgfVxuICAgICAgdGhyb3cgZXJyO1xuICAgIH0gZmluYWxseSB7XG4gICAgICBsb2cuZGVidWcoYFNlbmRpbmcgdG8gV2ViIEluc3BlY3RvciB0b29rICR7dGltZXIuZ2V0RHVyYXRpb24oKS5hc01pbGxpU2Vjb25kcy50b0ZpeGVkKDApfW1zYCk7XG4gICAgfVxuICB9XG5cbiAgYXN5bmMgc2VuZFRvRGV2aWNlIChjb21tYW5kLCBvcHRzID0ge30sIHdhaXRGb3JSZXNwb25zZSA9IHRydWUpIHtcbiAgICByZXR1cm4gYXdhaXQgbmV3IEIoYXN5bmMgKHJlc29sdmUsIHJlamVjdCkgPT4ge1xuICAgICAgLy8gcHJvbWlzZSB0byBiZSByZXNvbHZlZCB3aGVuZXZlciByZW1vdGUgZGVidWdnZXJcbiAgICAgIC8vIHJlcGxpZXMgdG8gb3VyIHJlcXVlc3RcblxuICAgICAgLy8ga2VlcCB0cmFjayBvZiB0aGUgbWVzc2FnZXMgY29taW5nIGFuZCBnb2luZyB1c2luZyBhIHNpbXBsZSBzZXF1ZW50aWFsIGlkXG4gICAgICBjb25zdCBtc2dJZCA9IHRoaXMubXNnSWQrKztcbiAgICAgIGxldCB3cmFwcGVyTXNnSWQgPSBtc2dJZDtcbiAgICAgIGlmICh0aGlzLmlzVGFyZ2V0QmFzZWQpIHtcbiAgICAgICAgLy8gZm9yIHRhcmdldC1iYXNlIGNvbW11bmljYXRpb24sIGV2ZXJ5dGhpbmcgaXMgd3JhcHBlZCB1cFxuICAgICAgICB3cmFwcGVyTXNnSWQgPSB0aGlzLm1zZ0lkKys7XG4gICAgICAgIC8vIGFja25vd2xlZGdlIHdyYXBwZXIgbWVzc2FnZVxuICAgICAgICB0aGlzLm1lc3NhZ2VIYW5kbGVyLm9uKHdyYXBwZXJNc2dJZC50b1N0cmluZygpLCBmdW5jdGlvbiAoZXJyKSB7XG4gICAgICAgICAgaWYgKGVycikge1xuICAgICAgICAgICAgcmVqZWN0KGVycik7XG4gICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICAgIH1cblxuICAgICAgY29uc3QgYXBwSWRLZXkgPSBvcHRzLmFwcElkS2V5O1xuICAgICAgY29uc3QgcGFnZUlkS2V5ID0gb3B0cy5wYWdlSWRLZXk7XG4gICAgICBjb25zdCB0YXJnZXRJZCA9IHRoaXMuZ2V0VGFyZ2V0KGFwcElkS2V5LCBwYWdlSWRLZXkpO1xuXG4gICAgICAvLyByZXRyaWV2ZSB0aGUgY29ycmVjdCBjb21tYW5kIHRvIHNlbmRcbiAgICAgIGNvbnN0IGZ1bGxPcHRzID0gXy5kZWZhdWx0cyh7XG4gICAgICAgIGNvbm5JZDogdGhpcy5jb25uSWQsXG4gICAgICAgIHNlbmRlcklkOiB0aGlzLnNlbmRlcklkLFxuICAgICAgICB0YXJnZXRJZCxcbiAgICAgICAgaWQ6IG1zZ0lkLFxuICAgICAgfSwgb3B0cyk7XG4gICAgICBjb25zdCBjbWQgPSB0aGlzLnJlbW90ZU1lc3NhZ2VzLmdldFJlbW90ZUNvbW1hbmQoY29tbWFuZCwgZnVsbE9wdHMpO1xuXG4gICAgICBpZiAoY21kPy5fX2FyZ3VtZW50Py5XSVJTb2NrZXREYXRhS2V5KSB7XG4gICAgICAgIC8vIG1ha2Ugc3VyZSB0aGUgbWVzc2FnZSBiZWluZyBzZW50IGhhcyBhbGwgdGhlIGluZm9ybWF0aW9uIHRoYXQgaXMgbmVlZGVkXG4gICAgICAgIGlmIChfLmlzTmlsKGNtZC5fX2FyZ3VtZW50LldJUlNvY2tldERhdGFLZXkuaWQpKSB7XG4gICAgICAgICAgY21kLl9fYXJndW1lbnQuV0lSU29ja2V0RGF0YUtleS5pZCA9IHdyYXBwZXJNc2dJZDtcbiAgICAgICAgfVxuICAgICAgICBjbWQuX19hcmd1bWVudC5XSVJTb2NrZXREYXRhS2V5ID1cbiAgICAgICAgICBCdWZmZXIuZnJvbShKU09OLnN0cmluZ2lmeShjbWQuX19hcmd1bWVudC5XSVJTb2NrZXREYXRhS2V5KSk7XG4gICAgICB9XG5cbiAgICAgIGxldCBtZXNzYWdlSGFuZGxlZCA9IHRydWU7XG4gICAgICBpZiAoIXdhaXRGb3JSZXNwb25zZSkge1xuICAgICAgICAvLyB0aGUgcHJvbWlzZSB3aWxsIGJlIHJlc29sdmVkIGFzIHNvb24gYXMgdGhlIHNvY2tldCBoYXMgYmVlbiBzZW50XG4gICAgICAgIG1lc3NhZ2VIYW5kbGVkID0gZmFsc2U7XG4gICAgICAgIC8vIGRvIG5vdCBsb2cgcmVjZWlwdHNcbiAgICAgICAgdGhpcy5tZXNzYWdlSGFuZGxlci5vbmNlKG1zZ0lkLnRvU3RyaW5nKCksIGZ1bmN0aW9uIChlcnIpIHtcbiAgICAgICAgICBpZiAoZXJyKSB7XG4gICAgICAgICAgICAvLyB3ZSBhcmUgbm90IHdhaXRpbmcgZm9yIHRoaXMsIGFuZCBpZiBpdCBlcnJvcnMgaXQgaXMgbW9zdCBsaWtlbHlcbiAgICAgICAgICAgIC8vIGEgcHJvdG9jb2wgY2hhbmdlLiBMb2cgYW5kIGNoZWNrIGR1cmluZyB0ZXN0aW5nXG4gICAgICAgICAgICBsb2cuZXJyb3IoYFJlY2VpdmVkIGVycm9yIGZyb20gc2VuZCB0aGF0IGlzIG5vdCBiZWluZyB3YWl0ZWQgZm9yIChpZDogJHttc2dJZH0pOiAnJHtfLnRydW5jYXRlKEpTT04uc3RyaW5naWZ5KGVyciksIERBVEFfTE9HX0xFTkdUSCl9J2ApO1xuICAgICAgICAgICAgLy8gcmVqZWN0LCB0aG91Z2ggaXQgaXMgdmVyeSByYXJlIHRoYXQgdGhpcyB3aWxsIGJlIHRyaWdnZXJlZCwgc2luY2VcbiAgICAgICAgICAgIC8vIHRoZSBwcm9taXNlIGlzIHJlc29sdmVkIGRpcmVjdGx0eSBhZnRlciBzZW5kLiBPbiB0aGUgb2ZmIGNoYW5jZSxcbiAgICAgICAgICAgIC8vIHRob3VnaCwgaXQgd2lsbCBhbGVydCBvZiBhIHByb3RvY29sIGNoYW5nZS5cbiAgICAgICAgICAgIHJlamVjdChlcnIpO1xuICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgICB9IGVsc2UgaWYgKHRoaXMubWVzc2FnZUhhbmRsZXIubGlzdGVuZXJzKGNtZC5fX3NlbGVjdG9yKS5sZW5ndGgpIHtcbiAgICAgICAgdGhpcy5tZXNzYWdlSGFuZGxlci5wcmVwZW5kT25jZUxpc3RlbmVyKGNtZC5fX3NlbGVjdG9yLCBmdW5jdGlvbiAoZXJyLCAuLi5hcmdzKSB7XG4gICAgICAgICAgaWYgKGVycikge1xuICAgICAgICAgICAgcmV0dXJuIHJlamVjdChlcnIpO1xuICAgICAgICAgIH1cbiAgICAgICAgICBsb2cuZGVidWcoYFJlY2VpdmVkIHJlc3BvbnNlIGZyb20gc2VuZCAoaWQ6ICR7bXNnSWR9KTogJyR7Xy50cnVuY2F0ZShKU09OLnN0cmluZ2lmeShhcmdzKSwgREFUQV9MT0dfTEVOR1RIKX0nYCk7XG4gICAgICAgICAgcmVzb2x2ZShhcmdzKTtcbiAgICAgICAgfSk7XG4gICAgICB9IGVsc2UgaWYgKGNtZD8uX19hcmd1bWVudD8uV0lSU29ja2V0RGF0YUtleSkge1xuICAgICAgICB0aGlzLm1lc3NhZ2VIYW5kbGVyLm9uY2UobXNnSWQudG9TdHJpbmcoKSwgZnVuY3Rpb24gKGVyciwgdmFsdWUpIHtcbiAgICAgICAgICBpZiAoZXJyKSB7XG4gICAgICAgICAgICByZXR1cm4gcmVqZWN0KG5ldyBFcnJvcihgUmVtb3RlIGRlYnVnZ2VyIGVycm9yIHdpdGggY29kZSAnJHtlcnIuY29kZX0nOiAke2Vyci5tZXNzYWdlfWApKTtcbiAgICAgICAgICB9XG4gICAgICAgICAgbG9nLmRlYnVnKGBSZWNlaXZlZCBkYXRhIHJlc3BvbnNlIGZyb20gc2VuZCAoaWQ6ICR7bXNnSWR9KTogJyR7Xy50cnVuY2F0ZShKU09OLnN0cmluZ2lmeSh2YWx1ZSksIERBVEFfTE9HX0xFTkdUSCl9J2ApO1xuICAgICAgICAgIHJlc29sdmUodmFsdWUpO1xuICAgICAgICB9KTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIC8vIG5vdGhpbmcgZWxzZSBpcyBoYW5kbGluZyB0aGluZ3MsIHNvIGp1c3QgcmVzb2x2ZSB3aGVuIHRoZSBtZXNzYWdlIGlzIHNlbnRcbiAgICAgICAgbWVzc2FnZUhhbmRsZWQgPSBmYWxzZTtcbiAgICAgIH1cblxuICAgICAgY29uc3QgbXNnID0gYFNlbmRpbmcgJyR7Y21kLl9fc2VsZWN0b3J9JyBtZXNzYWdlYCArXG4gICAgICAgIChmdWxsT3B0cy5hcHBJZEtleSA/IGAgdG8gYXBwICcke2Z1bGxPcHRzLmFwcElkS2V5fSdgIDogJycpICtcbiAgICAgICAgKGZ1bGxPcHRzLnBhZ2VJZEtleSA/IGAsIHBhZ2UgJyR7ZnVsbE9wdHMucGFnZUlkS2V5fSdgIDogJycpICtcbiAgICAgICAgKHRoaXMubmVlZHNUYXJnZXQgJiYgdGFyZ2V0SWQgPyBgLCB0YXJnZXQgJyR7dGFyZ2V0SWR9J2AgOiAnJykgK1xuICAgICAgICBgIChpZDogJHttc2dJZH0pOiAnJHtjb21tYW5kfSdgO1xuICAgICAgbG9nLmRlYnVnKG1zZyk7XG4gICAgICB0cnkge1xuICAgICAgICBjb25zdCByZXMgPSBhd2FpdCB0aGlzLnNlbmRNZXNzYWdlKGNtZCk7XG4gICAgICAgIGlmICghbWVzc2FnZUhhbmRsZWQpIHtcbiAgICAgICAgICAvLyBUaGVyZSBhcmUgbm8gaGFuZGxlcnMgd2FpdGluZyBmb3IgYSByZXNwb25zZSBiZWZvcmUgcmVzb2x2aW5nLFxuICAgICAgICAgIC8vIGFuZCBubyBlcnJvcnMgc2VuZGluZyB0aGUgbWVzc2FnZSBvdmVyIHRoZSBzb2NrZXQsIHNvIHJlc29sdmVcbiAgICAgICAgICByZXNvbHZlKHJlcyk7XG4gICAgICAgIH1cbiAgICAgIH0gY2F0Y2ggKGVycikge1xuICAgICAgICByZXR1cm4gcmVqZWN0KGVycik7XG4gICAgICB9XG4gICAgfSk7XG4gIH1cblxuICBhc3luYyBjb25uZWN0ICgpIHsgLy8gZXNsaW50LWRpc2FibGUtbGluZSByZXF1aXJlLWF3YWl0XG4gICAgdGhyb3cgbmV3IEVycm9yKGBTdWItY2xhc3NlcyBuZWVkIHRvIGltcGxlbWVudCBhICdjb25uZWN0JyBmdW5jdGlvbmApO1xuICB9XG5cbiAgYXN5bmMgZGlzY29ubmVjdCAoKSB7IC8vIGVzbGludC1kaXNhYmxlLWxpbmUgcmVxdWlyZS1hd2FpdFxuICAgIHRoaXMubWVzc2FnZUhhbmRsZXIucmVtb3ZlQWxsTGlzdGVuZXJzKCk7XG4gIH1cblxuICBhc3luYyBzZW5kTWVzc2FnZSAoLyogY29tbWFuZCAqLykgeyAvLyBlc2xpbnQtZGlzYWJsZS1saW5lIHJlcXVpcmUtYXdhaXRcbiAgICB0aHJvdyBuZXcgRXJyb3IoYFN1Yi1jbGFzc2VzIG5lZWQgdG8gaW1wbGVtZW50IGEgJ3NlbmRNZXNzYWdlJyBmdW5jdGlvbmApO1xuICB9XG5cbiAgYXN5bmMgcmVjZWl2ZSAoLyogZGF0YSAqLykgeyAvLyBlc2xpbnQtZGlzYWJsZS1saW5lIHJlcXVpcmUtYXdhaXRcbiAgICB0aHJvdyBuZXcgRXJyb3IoYFN1Yi1jbGFzc2VzIG5lZWQgdG8gaW1wbGVtZW50IGEgJ3JlY2VpdmUnIGZ1bmN0aW9uYCk7XG4gIH1cblxuICBhZGRUYXJnZXQgKGVyciwgYXBwLCB0YXJnZXRJbmZvKSB7XG4gICAgaWYgKF8uaXNOaWwodGFyZ2V0SW5mbz8udGFyZ2V0SWQpKSB7XG4gICAgICBsb2cud2FybihgUmVjZWl2ZWQgJ1RhcmdldC50YXJnZXRDcmVhdGVkJyBldmVudCBmb3IgYXBwICcke2FwcH0nIHdpdGggbm8gdGFyZ2V0LiBTa2lwcGluZ2ApO1xuICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICBpZiAoXy5pc0VtcHR5KHRoaXMucGVuZGluZ1RhcmdldE5vdGlmaWNhdGlvbikgJiYgIXRhcmdldEluZm8uaXNQcm92aXNpb25hbCkge1xuICAgICAgbG9nLndhcm4oYFJlY2VpdmVkICdUYXJnZXQudGFyZ2V0Q3JlYXRlZCcgZXZlbnQgZm9yIGFwcCAnJHthcHB9JyB3aXRoIG5vIHBlbmRpbmcgcmVxdWVzdDogJHtKU09OLnN0cmluZ2lmeSh0YXJnZXRJbmZvKX1gKTtcbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICBpZiAodGFyZ2V0SW5mby5pc1Byb3Zpc2lvbmFsKSB7XG4gICAgICBsb2cuZGVidWcoYFByb3Zpc2lvbmFsIHRhcmdldCBjcmVhdGVkIGZvciBhcHAgJyR7YXBwfScsICcke3RhcmdldEluZm8udGFyZ2V0SWR9Jy4gSWdub3JpbmcgdW50aWwgdGFyZ2V0IHVwZGF0ZSBldmVudGApO1xuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIGNvbnN0IFthcHBJZEtleSwgcGFnZUlkS2V5XSA9IHRoaXMucGVuZGluZ1RhcmdldE5vdGlmaWNhdGlvbjtcblxuICAgIGxvZy5kZWJ1ZyhgVGFyZ2V0IGNyZWF0ZWQgZm9yIGFwcCAnJHthcHBJZEtleX0nIGFuZCBwYWdlICcke3BhZ2VJZEtleX0nOiAke0pTT04uc3RyaW5naWZ5KHRhcmdldEluZm8pfWApO1xuICAgIGlmIChfLmhhcyh0aGlzLnRhcmdldHNbYXBwSWRLZXldLCBwYWdlSWRLZXkpKSB7XG4gICAgICBsb2cuZGVidWcoYFRoZXJlIGlzIGFscmVhZHkgYSB0YXJnZXQgZm9yIHRoaXMgYXBwIGFuZCBwYWdlICgnJHt0aGlzLnRhcmdldHNbYXBwSWRLZXldW3BhZ2VJZEtleV19JykuIFRoaXMgbWlnaHQgY2F1c2UgcHJvYmxlbXNgKTtcbiAgICB9XG4gICAgdGhpcy50YXJnZXRzW2FwcF0gPSB0aGlzLnRhcmdldHNbYXBwXSB8fCB7fTtcbiAgICB0aGlzLnRhcmdldHNbYXBwSWRLZXldW3BhZ2VJZEtleV0gPSB0YXJnZXRJbmZvLnRhcmdldElkO1xuICB9XG5cbiAgdXBkYXRlVGFyZ2V0IChlcnIsIGFwcCwgb2xkVGFyZ2V0SWQsIG5ld1RhcmdldElkKSB7XG4gICAgbG9nLmRlYnVnKGBUYXJnZXQgdXBkYXRlZCBmb3IgYXBwICcke2FwcH0nLiBPbGQgdGFyZ2V0OiAnJHtvbGRUYXJnZXRJZH0nLCBuZXcgdGFyZ2V0OiAnJHtuZXdUYXJnZXRJZH0nYCk7XG4gICAgaWYgKCF0aGlzLnRhcmdldHNbYXBwXSkge1xuICAgICAgbG9nLndhcm4oYE5vIGV4aXN0aW5nIHRhcmdldCBmb3IgYXBwICcke2FwcH0nLiBOb3Qgc3VyZSB3aGF0IHRvIGRvYCk7XG4gICAgICByZXR1cm47XG4gICAgfVxuICAgIC8vIHNhdmUgdGhpcywgdG8gYmUgdXNlZCBpZi93aGVuIHRoZSBleGlzdGluZyB0YXJnZXQgaXMgZGVzdHJveWVkXG4gICAgdGhpcy50YXJnZXRzW2FwcF0ucHJvdmlzaW9uYWwgPSB7XG4gICAgICBvbGRUYXJnZXRJZCxcbiAgICAgIG5ld1RhcmdldElkLFxuICAgIH07XG4gIH1cblxuICByZW1vdmVUYXJnZXQgKGVyciwgYXBwLCB0YXJnZXRJbmZvKSB7XG4gICAgaWYgKF8uaXNOaWwodGFyZ2V0SW5mbz8udGFyZ2V0SWQpKSB7XG4gICAgICBsb2cuZGVidWcoYFJlY2VpdmVkICdUYXJnZXQudGFyZ2V0RGVzdHJveWVkJyBldmVudCB3aXRoIG5vIHRhcmdldC4gU2tpcHBpbmdgKTtcbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICBsb2cuZGVidWcoYFRhcmdldCBkZXN0cm95ZWQgZm9yIGFwcCAnJHthcHB9JzogJHt0YXJnZXRJbmZvLnRhcmdldElkfWApO1xuXG4gICAgLy8gZ28gdGhyb3VnaCB0aGUgdGFyZ2V0cyBhbmQgZmluZCB0aGUgb25lIHRoYXQgaGFzIGEgd2FpdGluZyBwcm92aXNpb25hbCB0YXJnZXRcbiAgICBpZiAodGhpcy50YXJnZXRzW2FwcF0/LnByb3Zpc2lvbmFsPy5vbGRUYXJnZXRJZCA9PT0gdGFyZ2V0SW5mby50YXJnZXRJZCkge1xuICAgICAgY29uc3Qge29sZFRhcmdldElkLCBuZXdUYXJnZXRJZH0gPSB0aGlzLnRhcmdldHNbYXBwXS5wcm92aXNpb25hbDtcbiAgICAgIGRlbGV0ZSB0aGlzLnRhcmdldHNbYXBwXS5wcm92aXNpb25hbDtcblxuICAgICAgLy8gd2UgZG8gbm90IGtub3cgdGhlIHBhZ2UsIHNvIGdvIHRocm91Z2ggYW5kIGZpbmQgdGhlIGV4aXN0aW5nIHRhcmdldFxuICAgICAgY29uc3QgdGFyZ2V0cyA9IHRoaXMudGFyZ2V0c1thcHBdO1xuICAgICAgZm9yIChjb25zdCBbcGFnZSwgdGFyZ2V0SWRdIG9mIF8udG9QYWlycyh0YXJnZXRzKSkge1xuICAgICAgICBpZiAodGFyZ2V0SWQgPT09IG9sZFRhcmdldElkKSB7XG4gICAgICAgICAgbG9nLmRlYnVnKGBGb3VuZCBwcm92aXNpb25hbCB0YXJnZXQgZm9yIGFwcCAnJHthcHB9Jy4gT2xkIHRhcmdldDogJyR7b2xkVGFyZ2V0SWR9JywgbmV3IHRhcmdldDogJyR7bmV3VGFyZ2V0SWR9Jy4gVXBkYXRpbmdgKTtcbiAgICAgICAgICB0YXJnZXRzW3BhZ2VdID0gbmV3VGFyZ2V0SWQ7XG4gICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgICBsb2cud2FybihgUHJvdmlzaW9uYWwgdGFyZ2V0IGZvciBhcHAgJyR7YXBwfScgZm91bmQsIGJ1dCBubyBzdWl0YWJsZSBleGlzdGluZyB0YXJnZXQgZm91bmQuIFRoaXMgbWF5IGNhdXNlIHByb2JsZW1zYCk7XG4gICAgICBsb2cud2FybihgT2xkIHRhcmdldDogJyR7b2xkVGFyZ2V0SWR9JywgbmV3IHRhcmdldDogJyR7bmV3VGFyZ2V0SWR9Jy4gRXhpc3RpbmcgdGFyZ2V0czogJHtKU09OLnN0cmluZ2lmeSh0YXJnZXRzKX1gKTtcbiAgICB9XG5cbiAgICAvLyBpZiB0aGVyZSBpcyBubyB3YWl0aW5nIHByb3Zpc2lvbmFsIHRhcmdldCwganVzdCBnZXQgcmlkIG9mIHRoZSBleGlzdGluZyBvbmVcbiAgICBjb25zdCB0YXJnZXRzID0gdGhpcy50YXJnZXRzW2FwcF07XG4gICAgZm9yIChjb25zdCBbcGFnZSwgdGFyZ2V0SWRdIG9mIF8udG9QYWlycyh0YXJnZXRzKSkge1xuICAgICAgaWYgKHRhcmdldElkID09PSB0YXJnZXRJbmZvLnRhcmdldElkKSB7XG4gICAgICAgIGRlbGV0ZSB0YXJnZXRzW3BhZ2VdO1xuICAgICAgICByZXR1cm47XG4gICAgICB9XG4gICAgfVxuICAgIGxvZy5kZWJ1ZyhgVGFyZ2V0ICcke3RhcmdldEluZm8udGFyZ2V0SWR9JyBkZWxldGVkIGZvciBhcHAgJyR7YXBwfScsIGJ1dCBubyBzdWNoIHRhcmdldCBleGlzdHNgKTtcbiAgfVxuXG4gIGdldFRhcmdldCAoYXBwSWRLZXksIHBhZ2VJZEtleSkge1xuICAgIHJldHVybiAodGhpcy50YXJnZXRzW2FwcElkS2V5XSB8fCB7fSlbcGFnZUlkS2V5XTtcbiAgfVxuXG4gIGFzeW5jIHNlbGVjdFBhZ2UgKGFwcElkS2V5LCBwYWdlSWRLZXkpIHtcbiAgICB0aGlzLnBlbmRpbmdUYXJnZXROb3RpZmljYXRpb24gPSBbYXBwSWRLZXksIHBhZ2VJZEtleV07XG4gICAgdGhpcy5zaG91bGRDaGVja0ZvclRhcmdldCA9IGZhbHNlO1xuXG4gICAgLy8gZ28gdGhyb3VnaCB0aGUgc3RlcHMgdGhhdCB0aGUgRGVza3RvcCBTYWZhcmkgc3lzdGVtXG4gICAgLy8gZ29lcyB0aHJvdWdoIHRvIGluaXRpYWxpemUgdGhlIFdlYiBJbnNwZWN0b3Igc2Vzc2lvblxuXG4gICAgY29uc3Qgc2VuZE9wdHMgPSB7XG4gICAgICBhcHBJZEtleSxcbiAgICAgIHBhZ2VJZEtleSxcbiAgICB9O1xuXG4gICAgLy8gaGlnaGxpZ2h0IGFuZCB0aGVuIHVuLWhpZ2hsaWdodCB0aGUgd2Vidmlld1xuICAgIGZvciAoY29uc3QgZW5hYmxlZCBvZiBbdHJ1ZSwgZmFsc2VdKSB7XG4gICAgICBhd2FpdCB0aGlzLnNlbmQoJ2luZGljYXRlV2ViVmlldycsIE9iamVjdC5hc3NpZ24oe1xuICAgICAgICBlbmFibGVkLFxuICAgICAgfSwgc2VuZE9wdHMpLCBmYWxzZSk7XG4gICAgfVxuXG4gICAgYXdhaXQgdGhpcy5zZW5kKCdzZXRTZW5kZXJLZXknLCBzZW5kT3B0cyk7XG4gICAgbG9nLmRlYnVnKCdTZW5kZXIga2V5IHNldCcpO1xuXG4gICAgaWYgKHRoaXMuaXNUYXJnZXRCYXNlZCAmJiB1dGlsLmNvbXBhcmVWZXJzaW9ucyh0aGlzLnBsYXRmb3JtVmVyc2lvbiwgJzwnLCBNSU5fUExBVEZPUk1fTk9fVEFSR0VUX0VYSVNUUykpIHtcbiAgICAgIGF3YWl0IHRoaXMuc2VuZCgnVGFyZ2V0LmV4aXN0cycsIHNlbmRPcHRzLCBmYWxzZSk7XG4gICAgfVxuXG4gICAgdGhpcy5zaG91bGRDaGVja0ZvclRhcmdldCA9IHRydWU7XG5cbiAgICBpZiAodGhpcy5mdWxsUGFnZUluaXRpYWxpemF0aW9uKSB7XG4gICAgICBhd2FpdCB0aGlzLmluaXRpYWxpemVQYWdlRnVsbChhcHBJZEtleSwgcGFnZUlkS2V5KTtcbiAgICB9IGVsc2Uge1xuICAgICAgYXdhaXQgdGhpcy5pbml0aWFsaXplUGFnZShhcHBJZEtleSwgcGFnZUlkS2V5KTtcbiAgICB9XG4gIH1cblxuICAvKlxuICAgKiBQZXJmb3JtIHRoZSBtaW5pbWFsIGluaXRpYWxpemF0aW9uIHRvIGdldCB0aGUgV2ViIEluc3BlY3RvciB3b3JraW5nXG4gICAqL1xuICBhc3luYyBpbml0aWFsaXplUGFnZSAoYXBwSWRLZXksIHBhZ2VJZEtleSkge1xuICAgIGNvbnN0IHNlbmRPcHRzID0ge1xuICAgICAgYXBwSWRLZXksXG4gICAgICBwYWdlSWRLZXksXG4gICAgfTtcblxuICAgIGF3YWl0IHRoaXMuc2VuZCgnSW5zcGVjdG9yLmVuYWJsZScsIHNlbmRPcHRzLCBmYWxzZSk7XG4gICAgYXdhaXQgdGhpcy5zZW5kKCdQYWdlLmVuYWJsZScsIHNlbmRPcHRzLCBmYWxzZSk7XG5cbiAgICAvLyBnbyB0aHJvdWdoIHRoZSB0YXNrcyB0byBpbml0aWFsaXplXG4gICAgYXdhaXQgdGhpcy5zZW5kKCdOZXR3b3JrLmVuYWJsZScsIHNlbmRPcHRzLCBmYWxzZSk7XG4gICAgYXdhaXQgdGhpcy5zZW5kKCdSdW50aW1lLmVuYWJsZScsIHNlbmRPcHRzLCBmYWxzZSk7XG4gICAgYXdhaXQgdGhpcy5zZW5kKCdIZWFwLmVuYWJsZScsIHNlbmRPcHRzLCBmYWxzZSk7XG4gICAgYXdhaXQgdGhpcy5zZW5kKCdEZWJ1Z2dlci5lbmFibGUnLCBzZW5kT3B0cywgZmFsc2UpO1xuICAgIGF3YWl0IHRoaXMuc2VuZCgnQ29uc29sZS5lbmFibGUnLCBzZW5kT3B0cywgZmFsc2UpO1xuICAgIGF3YWl0IHRoaXMuc2VuZCgnSW5zcGVjdG9yLmluaXRpYWxpemVkJywgc2VuZE9wdHMsIGZhbHNlKTtcbiAgfVxuXG4gIC8qXG4gICAqIE1pbWljIGV2ZXJ5IHN0ZXAgdGhhdCBEZXNrdG9wIFNhZmFyaSBEZXZlbG9wIHRvb2xzIHVzZXMgdG8gaW5pdGlhbGl6ZSBhXG4gICAqIFdlYiBJbnNwZWN0b3Igc2Vzc2lvblxuICAgKi9cbiAgYXN5bmMgaW5pdGlhbGl6ZVBhZ2VGdWxsIChhcHBJZEtleSwgcGFnZUlkS2V5KSB7XG4gICAgY29uc3Qgc2VuZE9wdHMgPSB7XG4gICAgICBhcHBJZEtleSxcbiAgICAgIHBhZ2VJZEtleSxcbiAgICB9O1xuXG4gICAgYXdhaXQgdGhpcy5zZW5kKCdJbnNwZWN0b3IuZW5hYmxlJywgc2VuZE9wdHMsIGZhbHNlKTtcbiAgICBhd2FpdCB0aGlzLnNlbmQoJ1BhZ2UuZW5hYmxlJywgc2VuZE9wdHMsIGZhbHNlKTtcblxuICAgIC8vIGdvIHRocm91Z2ggdGhlIHRhc2tzIHRvIGluaXRpYWxpemVcbiAgICBhd2FpdCB0aGlzLnNlbmQoJ1BhZ2UuZ2V0UmVzb3VyY2VUcmVlJywgc2VuZE9wdHMsIGZhbHNlKTtcbiAgICBhd2FpdCB0aGlzLnNlbmQoJ05ldHdvcmsuZW5hYmxlJywgc2VuZE9wdHMsIGZhbHNlKTtcbiAgICBhd2FpdCB0aGlzLnNlbmQoJ05ldHdvcmsuc2V0UmVzb3VyY2VDYWNoaW5nRGlzYWJsZWQnLCBPYmplY3QuYXNzaWduKHtcbiAgICAgIGRpc2FibGVkOiBmYWxzZSxcbiAgICB9LCBzZW5kT3B0cyksIGZhbHNlKTtcbiAgICBhd2FpdCB0aGlzLnNlbmQoJ0RPTVN0b3JhZ2UuZW5hYmxlJywgc2VuZE9wdHMsIGZhbHNlKTtcbiAgICBhd2FpdCB0aGlzLnNlbmQoJ0RhdGFiYXNlLmVuYWJsZScsIHNlbmRPcHRzLCBmYWxzZSk7XG4gICAgYXdhaXQgdGhpcy5zZW5kKCdJbmRleGVkREIuZW5hYmxlJywgc2VuZE9wdHMsIGZhbHNlKTtcbiAgICBhd2FpdCB0aGlzLnNlbmQoJ0NTUy5lbmFibGUnLCBzZW5kT3B0cywgZmFsc2UpO1xuICAgIGF3YWl0IHRoaXMuc2VuZCgnUnVudGltZS5lbmFibGUnLCBzZW5kT3B0cywgZmFsc2UpO1xuICAgIGF3YWl0IHRoaXMuc2VuZCgnSGVhcC5lbmFibGUnLCBzZW5kT3B0cywgZmFsc2UpO1xuICAgIGF3YWl0IHRoaXMuc2VuZCgnTWVtb3J5LmVuYWJsZScsIHNlbmRPcHRzLCBmYWxzZSk7XG4gICAgYXdhaXQgdGhpcy5zZW5kKCdBcHBsaWNhdGlvbkNhY2hlLmVuYWJsZScsIHNlbmRPcHRzLCBmYWxzZSk7XG4gICAgYXdhaXQgdGhpcy5zZW5kKCdBcHBsaWNhdGlvbkNhY2hlLmdldEZyYW1lc1dpdGhNYW5pZmVzdHMnLCBzZW5kT3B0cywgZmFsc2UpO1xuICAgIGF3YWl0IHRoaXMuc2VuZCgnVGltZWxpbmUuc2V0SW5zdHJ1bWVudHMnLCBPYmplY3QuYXNzaWduKHtcbiAgICAgIGluc3RydW1lbnRzOiBbJ1RpbWVsaW5lJywgJ1NjcmlwdFByb2ZpbGVyJywgJ0NQVSddLFxuICAgIH0sIHNlbmRPcHRzKSwgZmFsc2UpO1xuICAgIGF3YWl0IHRoaXMuc2VuZCgnVGltZWxpbmUuc2V0QXV0b0NhcHR1cmVFbmFibGVkJywgT2JqZWN0LmFzc2lnbih7XG4gICAgICBlbmFibGVkOiBmYWxzZSxcbiAgICB9LCBzZW5kT3B0cyksIGZhbHNlKTtcbiAgICBhd2FpdCB0aGlzLnNlbmQoJ0RlYnVnZ2VyLmVuYWJsZScsIHNlbmRPcHRzLCBmYWxzZSk7XG4gICAgYXdhaXQgdGhpcy5zZW5kKCdEZWJ1Z2dlci5zZXRCcmVha3BvaW50c0FjdGl2ZScsIE9iamVjdC5hc3NpZ24oe1xuICAgICAgYWN0aXZlOiB0cnVlLFxuICAgIH0sIHNlbmRPcHRzKSwgZmFsc2UpO1xuICAgIGF3YWl0IHRoaXMuc2VuZCgnRGVidWdnZXIuc2V0UGF1c2VPbkV4Y2VwdGlvbnMnLCBPYmplY3QuYXNzaWduKHtcbiAgICAgIHN0YXRlOiAnbm9uZScsXG4gICAgfSwgc2VuZE9wdHMpLCBmYWxzZSk7XG4gICAgYXdhaXQgdGhpcy5zZW5kKCdEZWJ1Z2dlci5zZXRQYXVzZU9uQXNzZXJ0aW9ucycsIE9iamVjdC5hc3NpZ24oe1xuICAgICAgZW5hYmxlZDogZmFsc2UsXG4gICAgfSwgc2VuZE9wdHMpLCBmYWxzZSk7XG4gICAgYXdhaXQgdGhpcy5zZW5kKCdEZWJ1Z2dlci5zZXRBc3luY1N0YWNrVHJhY2VEZXB0aCcsIE9iamVjdC5hc3NpZ24oe1xuICAgICAgZGVwdGg6IDIwMCxcbiAgICB9LCBzZW5kT3B0cyksIGZhbHNlKTtcbiAgICBhd2FpdCB0aGlzLnNlbmQoJ0RlYnVnZ2VyLnNldFBhdXNlRm9ySW50ZXJuYWxTY3JpcHRzJywgT2JqZWN0LmFzc2lnbih7XG4gICAgICBzaG91bGRQYXVzZTogZmFsc2UsXG4gICAgfSwgc2VuZE9wdHMpLCBmYWxzZSk7XG5cbiAgICBhd2FpdCB0aGlzLnNlbmQoJ0xheWVyVHJlZS5lbmFibGUnLCBzZW5kT3B0cywgZmFsc2UpO1xuICAgIGF3YWl0IHRoaXMuc2VuZCgnV29ya2VyLmVuYWJsZScsIHNlbmRPcHRzLCBmYWxzZSk7XG4gICAgYXdhaXQgdGhpcy5zZW5kKCdDYW52YXMuZW5hYmxlJywgc2VuZE9wdHMsIGZhbHNlKTtcbiAgICBhd2FpdCB0aGlzLnNlbmQoJ0NvbnNvbGUuZW5hYmxlJywgc2VuZE9wdHMsIGZhbHNlKTtcbiAgICBhd2FpdCB0aGlzLnNlbmQoJ0RPTS5nZXREb2N1bWVudCcsIHNlbmRPcHRzLCBmYWxzZSk7XG4gICAgY29uc3QgbG9nZ2luZ0NoYW5uZWxzID0gYXdhaXQgdGhpcy5zZW5kKCdDb25zb2xlLmdldExvZ2dpbmdDaGFubmVscycsIHNlbmRPcHRzKTtcbiAgICBmb3IgKGNvbnN0IHNvdXJjZSBvZiAobG9nZ2luZ0NoYW5uZWxzLmNoYW5uZWxzIHx8IFtdKS5tYXAoKGVudHJ5KSA9PiBlbnRyeS5zb3VyY2UpKSB7XG4gICAgICBhd2FpdCB0aGlzLnNlbmQoJ0NvbnNvbGUuc2V0TG9nZ2luZ0NoYW5uZWxMZXZlbCcsIE9iamVjdC5hc3NpZ24oe1xuICAgICAgICBzb3VyY2UsXG4gICAgICAgIGxldmVsOiAndmVyYm9zZScsXG4gICAgICB9LCBzZW5kT3B0cyksIGZhbHNlKTtcbiAgICB9XG5cbiAgICBhd2FpdCB0aGlzLnNlbmQoJ0luc3BlY3Rvci5pbml0aWFsaXplZCcsIHNlbmRPcHRzLCBmYWxzZSk7XG4gIH1cblxuICBhc3luYyBzZWxlY3RBcHAgKGFwcElkS2V5KSB7XG4gICAgcmV0dXJuIGF3YWl0IG5ldyBCKChyZXNvbHZlLCByZWplY3QpID0+IHtcbiAgICAgIC8vIGxvY2FsIGNhbGxiYWNrLCB0ZW1wb3JhcmlseSBhZGRlZCBhcyBjYWxsYmFjayB0b1xuICAgICAgLy8gYF9ycGNfYXBwbGljYXRpb25Db25uZWN0ZWQ6YCByZW1vdGUgZGVidWdnZXIgcmVzcG9uc2VcbiAgICAgIC8vIHRvIGhhbmRsZSB0aGUgaW5pdGlhbCBjb25uZWN0aW9uXG4gICAgICBjb25zdCBvbkFwcENoYW5nZSA9IChlcnIsIGRpY3QpID0+IHtcbiAgICAgICAgaWYgKGVycikge1xuICAgICAgICAgIHJldHVybiByZWplY3QoZXJyKTtcbiAgICAgICAgfVxuICAgICAgICAvLyBmcm9tIHRoZSBkaWN0aW9uYXJ5IHJldHVybmVkLCBnZXQgdGhlIGlkc1xuICAgICAgICBjb25zdCBvbGRBcHBJZEtleSA9IGRpY3QuV0lSSG9zdEFwcGxpY2F0aW9uSWRlbnRpZmllcktleTtcbiAgICAgICAgY29uc3QgY29ycmVjdEFwcElkS2V5ID0gZGljdC5XSVJBcHBsaWNhdGlvbklkZW50aWZpZXJLZXk7XG5cbiAgICAgICAgLy8gaWYgdGhpcyBpcyBhIHJlcG9ydCBvZiBhIHByb3h5IHJlZGlyZWN0IGZyb20gdGhlIHJlbW90ZSBkZWJ1Z2dlclxuICAgICAgICAvLyB3ZSB3YW50IHRvIHVwZGF0ZSBvdXIgZGljdGlvbmFyeSBhbmQgZ2V0IGEgbmV3IGFwcCBpZFxuICAgICAgICBpZiAob2xkQXBwSWRLZXkgJiYgY29ycmVjdEFwcElkS2V5ICE9PSBvbGRBcHBJZEtleSkge1xuICAgICAgICAgIGxvZy5kZWJ1ZyhgV2Ugd2VyZSBub3RpZmllZCB3ZSBtaWdodCBoYXZlIGNvbm5lY3RlZCB0byB0aGUgd3JvbmcgYXBwLiBgICtcbiAgICAgICAgICAgICAgICAgICAgYFVzaW5nIGlkICR7Y29ycmVjdEFwcElkS2V5fSBpbnN0ZWFkIG9mICR7b2xkQXBwSWRLZXl9YCk7XG4gICAgICAgIH1cblxuICAgICAgICByZWplY3QobmV3IEVycm9yKCdOZXcgYXBwbGljYXRpb24gaGFzIGNvbm5lY3RlZCcpKTtcbiAgICAgIH07XG4gICAgICB0aGlzLm1lc3NhZ2VIYW5kbGVyLnByZXBlbmRPbmNlTGlzdGVuZXIoJ19ycGNfYXBwbGljYXRpb25Db25uZWN0ZWQ6Jywgb25BcHBDaGFuZ2UpO1xuXG4gICAgICAvLyBkbyB0aGUgYWN0dWFsIGNvbm5lY3RpbmcgdG8gdGhlIGFwcFxuICAgICAgcmV0dXJuIChhc3luYyAoKSA9PiB7XG4gICAgICAgIGxldCBwYWdlRGljdCwgY29ubmVjdGVkQXBwSWRLZXk7XG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgKFtjb25uZWN0ZWRBcHBJZEtleSwgcGFnZURpY3RdID0gYXdhaXQgdGhpcy5zZW5kKCdjb25uZWN0VG9BcHAnLCB7XG4gICAgICAgICAgICBhcHBJZEtleVxuICAgICAgICAgIH0pKTtcbiAgICAgICAgfSBjYXRjaCAoZXJyKSB7XG4gICAgICAgICAgbG9nLndhcm4oYFVuYWJsZSB0byBjb25uZWN0IHRvIGFwcDogJHtlcnIubWVzc2FnZX1gKTtcbiAgICAgICAgICByZWplY3QoZXJyKTtcbiAgICAgICAgfVxuXG4gICAgICAgIC8vIHNvbWV0aW1lcyB0aGUgY29ubmVjdCBsb2dpYyBoYXBwZW5zLCBidXQgd2l0aCBhbiBlbXB0eSBkaWN0aW9uYXJ5XG4gICAgICAgIC8vIHdoaWNoIGxlYWRzIHRvIHRoZSByZW1vdGUgZGVidWdnZXIgZ2V0dGluZyBkaXNjb25uZWN0ZWQsIGFuZCBpbnRvIGEgbG9vcFxuICAgICAgICBpZiAoXy5pc0VtcHR5KHBhZ2VEaWN0KSkge1xuICAgICAgICAgIGxldCBtc2cgPSAnRW1wdHkgcGFnZSBkaWN0aW9uYXJ5IHJlY2VpdmVkJztcbiAgICAgICAgICBsb2cuZGVidWcobXNnKTtcbiAgICAgICAgICByZWplY3QobmV3IEVycm9yKG1zZykpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIHJlc29sdmUoW2Nvbm5lY3RlZEFwcElkS2V5LCBwYWdlRGljdF0pO1xuICAgICAgICB9XG4gICAgICB9KSgpO1xuICAgIH0pO1xuICB9XG5cbiAgb25FeGVjdXRpb25Db250ZXh0Q3JlYXRlZCAoZXJyLCBjb250ZXh0KSB7XG4gICAgLy8geyBpZDogMiwgaXNQYWdlQ29udGV4dDogdHJ1ZSwgbmFtZTogJycsIGZyYW1lSWQ6ICcwLjEnIH1cbiAgICAvLyByaWdodCBub3cgd2UgaGF2ZSBubyB3YXkgdG8gbWFwIGNvbnRleHRzIHRvIGFwcHMvcGFnZXNcbiAgICAvLyBzbyBqdXN0IHN0b3JlXG4gICAgdGhpcy5jb250ZXh0cy5wdXNoKGNvbnRleHQuaWQpO1xuICB9XG5cbiAgb25HYXJiYWdlQ29sbGVjdGVkICgpIHtcbiAgICAvLyBqdXN0IHdhbnQgdG8gbG9nIHRoYXQgdGhpcyBpcyBoYXBwZW5pbmcsIGFzIGl0IGNhbiBhZmZlY3Qgb3BlcnRpb25cbiAgICBsb2cuZGVidWcoYFdlYiBJbnNwZWN0b3IgZ2FyYmFnZSBjb2xsZWN0ZWRgKTtcbiAgfVxuXG4gIG9uU2NyaXB0UGFyc2VkIChlcnIsIHNjcmlwdEluZm8pIHtcbiAgICAvLyB7IHNjcmlwdElkOiAnMTMnLCB1cmw6ICcnLCBzdGFydExpbmU6IDAsIHN0YXJ0Q29sdW1uOiAwLCBlbmRMaW5lOiA4MiwgZW5kQ29sdW1uOiAzIH1cbiAgICBsb2cuZGVidWcoYFNjcmlwdCBwYXJzZWQ6ICR7SlNPTi5zdHJpbmdpZnkoc2NyaXB0SW5mbyl9YCk7XG4gIH1cbn1cbiJdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7QUFBQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFHQSxNQUFNQSxlQUFlLEdBQUc7RUFBQ0MsTUFBTSxFQUFFO0FBQVQsQ0FBeEI7QUFFQSxNQUFNQyx1QkFBdUIsR0FBRyxLQUFoQztBQUNBLE1BQU1DLHdCQUF3QixHQUFHLElBQWpDO0FBRUEsTUFBTUMsNkJBQTZCLEdBQUcsTUFBdEM7QUFHQSxNQUFNQyw2QkFBNkIsR0FBRyxNQUF0Qzs7QUFFQSxTQUFTQyxhQUFULENBQXdCQyxRQUF4QixFQUFrQ0MsZUFBbEMsRUFBbUQ7RUFJakQsTUFBTUMsYUFBYSxHQUFHQyxhQUFBLENBQUtDLGVBQUwsQ0FBcUJILGVBQXJCLEVBQXNDLElBQXRDLEVBQTRDSiw2QkFBNUMsQ0FBdEI7O0VBQ0FRLGVBQUEsQ0FBSUMsS0FBSixDQUFXLDhDQUE2Q04sUUFBUSxHQUFHLEVBQUgsR0FBUSxNQUFPLCtCQUE4QkMsZUFBZ0IsSUFBN0g7O0VBQ0FJLGVBQUEsQ0FBSUMsS0FBSixDQUFXLDBDQUF5Q1QsNkJBQThCLE1BQUtLLGFBQWMsRUFBckc7O0VBQ0EsT0FBT0EsYUFBUDtBQUNEOztBQUVjLE1BQU1LLFNBQU4sQ0FBZ0I7RUFDN0JDLFdBQVcsQ0FBRUMsSUFBSSxHQUFHLEVBQVQsRUFBYTtJQUN0QixLQUFLQyxRQUFMLEdBQWdCLEVBQWhCO0lBQ0EsS0FBS0MscUJBQUwsR0FBNkIsQ0FBQyxDQUFDRixJQUFJLENBQUNHLG9CQUFwQztJQUVBLE1BQU07TUFDSkMsUUFESTtNQUVKWixlQUFlLEdBQUcsRUFGZDtNQUdKRCxRQUFRLEdBQUcsSUFIUDtNQUlKYyxtQkFBbUIsR0FBRyxLQUpsQjtNQUtKQywwQkFBMEIsR0FBRyxLQUx6QjtN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