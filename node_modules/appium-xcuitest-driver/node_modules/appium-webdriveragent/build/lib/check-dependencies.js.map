{"version":3,"file":"check-dependencies.js","names":["buildWDASim","args","path","join","BOOTSTRAP_PATH","WDA_SCHEME","SDK_SIMULATOR","exec","checkForDependencies","log","debug","bundleWDASim","xcodebuild","opts","_","isFunction","retrieveDerivedDataPath","XcodeBuild","derivedDataPath","wdaBundlePath","WDA_RUNNER_APP","fs","exists"],"sources":["../../lib/check-dependencies.js"],"sourcesContent":["import { fs } from 'appium/support';\nimport _ from 'lodash';\nimport { exec } from 'teen_process';\nimport path from 'path';\nimport XcodeBuild from './xcodebuild';\nimport {\n  WDA_SCHEME, SDK_SIMULATOR, WDA_RUNNER_APP\n} from './constants';\nimport { BOOTSTRAP_PATH } from './utils';\nimport log from './logger';\n\nasync function buildWDASim () {\n  const args = [\n    '-project', path.join(BOOTSTRAP_PATH, 'WebDriverAgent.xcodeproj'),\n    '-scheme', WDA_SCHEME,\n    '-sdk', SDK_SIMULATOR,\n    'CODE_SIGN_IDENTITY=\"\"',\n    'CODE_SIGNING_REQUIRED=\"NO\"',\n    'GCC_TREAT_WARNINGS_AS_ERRORS=0',\n  ];\n  await exec('xcodebuild', args);\n}\n\n// eslint-disable-next-line require-await\nasync function checkForDependencies () {\n  log.debug('Dependencies are up to date');\n  return false;\n}\n\nasync function bundleWDASim (xcodebuild, opts = {}) {\n  if (xcodebuild && !_.isFunction(xcodebuild.retrieveDerivedDataPath)) {\n    xcodebuild = new XcodeBuild();\n    opts = xcodebuild;\n  }\n\n  const derivedDataPath = await xcodebuild.retrieveDerivedDataPath();\n  const wdaBundlePath = path.join(derivedDataPath, 'Build', 'Products', 'Debug-iphonesimulator', WDA_RUNNER_APP);\n  if (await fs.exists(wdaBundlePath)) {\n    return wdaBundlePath;\n  }\n  await buildWDASim(xcodebuild, opts);\n  return wdaBundlePath;\n}\n\nexport { checkForDependencies, bundleWDASim };\n"],"mappings":";;;;;;;;;;;;AAAA;;AACA;;AACA;;AACA;;AACA;;AACA;;AAGA;;AACA;;AAEA,eAAeA,WAAf,GAA8B;EAC5B,MAAMC,IAAI,GAAG,CACX,UADW,EACCC,aAAA,CAAKC,IAAL,CAAUC,qBAAV,EAA0B,0BAA1B,CADD,EAEX,SAFW,EAEAC,qBAFA,EAGX,MAHW,EAGHC,wBAHG,EAIX,uBAJW,EAKX,4BALW,EAMX,gCANW,CAAb;EAQA,MAAM,IAAAC,kBAAA,EAAK,YAAL,EAAmBN,IAAnB,CAAN;AACD;;AAGD,eAAeO,oBAAf,GAAuC;EACrCC,eAAA,CAAIC,KAAJ,CAAU,6BAAV;;EACA,OAAO,KAAP;AACD;;AAED,eAAeC,YAAf,CAA6BC,UAA7B,EAAyCC,IAAI,GAAG,EAAhD,EAAoD;EAClD,IAAID,UAAU,IAAI,CAACE,eAAA,CAAEC,UAAF,CAAaH,UAAU,CAACI,uBAAxB,CAAnB,EAAqE;IACnEJ,UAAU,GAAG,IAAIK,mBAAJ,EAAb;IACAJ,IAAI,GAAGD,UAAP;EACD;;EAED,MAAMM,eAAe,GAAG,MAAMN,UAAU,CAACI,uBAAX,EAA9B;;EACA,MAAMG,aAAa,GAAGjB,aAAA,CAAKC,IAAL,CAAUe,eAAV,EAA2B,OAA3B,EAAoC,UAApC,EAAgD,uBAAhD,EAAyEE,yBAAzE,CAAtB;;EACA,IAAI,MAAMC,WAAA,CAAGC,MAAH,CAAUH,aAAV,CAAV,EAAoC;IAClC,OAAOA,aAAP;EACD;;EACD,MAAMnB,WAAW,CAACY,UAAD,EAAaC,IAAb,CAAjB;EACA,OAAOM,aAAP;AACD"}