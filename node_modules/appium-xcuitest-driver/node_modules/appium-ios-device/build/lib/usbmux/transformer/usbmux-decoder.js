"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = exports.UsbmuxDecoder = void 0;

require("source-map-support/register");

var _stream = _interopRequireDefault(require("stream"));

var _support = require("@appium/support");

const HEADER_LENGTH = 16;

class UsbmuxDecoder extends _stream.default.Transform {
  constructor() {
    super({
      objectMode: true
    });
  }

  _transform(data, encoding, onData) {
    this._decode(data);

    onData();
  }

  _decode(data) {
    const header = {
      length: data.readUInt32LE(0),
      version: data.readUInt32LE(4),
      type: data.readUInt32LE(8),
      tag: data.readUInt32LE(12)
    };
    let payload = data.slice(HEADER_LENGTH, data.length);
    this.push({
      header,
      payload: _support.plist.parsePlist(payload)
    });
  }

}

exports.UsbmuxDecoder = UsbmuxDecoder;
var _default = UsbmuxDecoder;
exports.default = _default;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJIRUFERVJfTEVOR1RIIiwiVXNibXV4RGVjb2RlciIsIlN0cmVhbSIsIlRyYW5zZm9ybSIsImNvbnN0cnVjdG9yIiwib2JqZWN0TW9kZSIsIl90cmFuc2Zvcm0iLCJkYXRhIiwiZW5jb2RpbmciLCJvbkRhdGEiLCJfZGVjb2RlIiwiaGVhZGVyIiwibGVuZ3RoIiwicmVhZFVJbnQzMkxFIiwidmVyc2lvbiIsInR5cGUiLCJ0YWciLCJwYXlsb2FkIiwic2xpY2UiLCJwdXNoIiwicGxpc3QiLCJwYXJzZVBsaXN0Il0sInNvdXJjZXMiOlsiLi4vLi4vLi4vLi4vbGliL3VzYm11eC90cmFuc2Zvcm1lci91c2JtdXgtZGVjb2Rlci5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgU3RyZWFtIGZyb20gJ3N0cmVhbSc7XG5pbXBvcnQgeyBwbGlzdCB9IGZyb20gJ0BhcHBpdW0vc3VwcG9ydCc7XG5cbmNvbnN0IEhFQURFUl9MRU5HVEggPSAxNjtcblxuY2xhc3MgVXNibXV4RGVjb2RlciBleHRlbmRzIFN0cmVhbS5UcmFuc2Zvcm0ge1xuXG4gIGNvbnN0cnVjdG9yICgpIHtcbiAgICBzdXBlcih7IG9iamVjdE1vZGU6IHRydWUgfSk7XG4gIH1cblxuICBfdHJhbnNmb3JtIChkYXRhLCBlbmNvZGluZywgb25EYXRhKSB7XG4gICAgdGhpcy5fZGVjb2RlKGRhdGEpO1xuICAgIG9uRGF0YSgpO1xuICB9XG5cbiAgX2RlY29kZSAoZGF0YSkge1xuICAgIGNvbnN0IGhlYWRlciA9IHtcbiAgICAgIGxlbmd0aDogZGF0YS5yZWFkVUludDMyTEUoMCksXG4gICAgICB2ZXJzaW9uOiBkYXRhLnJlYWRVSW50MzJMRSg0KSxcbiAgICAgIHR5cGU6IGRhdGEucmVhZFVJbnQzMkxFKDgpLFxuICAgICAgdGFnOiBkYXRhLnJlYWRVSW50MzJMRSgxMilcbiAgICB9O1xuXG4gICAgbGV0IHBheWxvYWQgPSBkYXRhLnNsaWNlKEhFQURFUl9MRU5HVEgsIGRhdGEubGVuZ3RoKTtcbiAgICB0aGlzLnB1c2goeyBoZWFkZXIsIHBheWxvYWQ6IHBsaXN0LnBhcnNlUGxpc3QocGF5bG9hZCkgfSk7XG4gIH1cblxufVxuXG5leHBvcnQgeyBVc2JtdXhEZWNvZGVyIH07XG5leHBvcnQgZGVmYXVsdCBVc2JtdXhEZWNvZGVyO1xuIl0sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7OztBQUFBOztBQUNBOztBQUVBLE1BQU1BLGFBQWEsR0FBRyxFQUF0Qjs7QUFFQSxNQUFNQyxhQUFOLFNBQTRCQyxlQUFBLENBQU9DLFNBQW5DLENBQTZDO0VBRTNDQyxXQUFXLEdBQUk7SUFDYixNQUFNO01BQUVDLFVBQVUsRUFBRTtJQUFkLENBQU47RUFDRDs7RUFFREMsVUFBVSxDQUFFQyxJQUFGLEVBQVFDLFFBQVIsRUFBa0JDLE1BQWxCLEVBQTBCO0lBQ2xDLEtBQUtDLE9BQUwsQ0FBYUgsSUFBYjs7SUFDQUUsTUFBTTtFQUNQOztFQUVEQyxPQUFPLENBQUVILElBQUYsRUFBUTtJQUNiLE1BQU1JLE1BQU0sR0FBRztNQUNiQyxNQUFNLEVBQUVMLElBQUksQ0FBQ00sWUFBTCxDQUFrQixDQUFsQixDQURLO01BRWJDLE9BQU8sRUFBRVAsSUFBSSxDQUFDTSxZQUFMLENBQWtCLENBQWxCLENBRkk7TUFHYkUsSUFBSSxFQUFFUixJQUFJLENBQUNNLFlBQUwsQ0FBa0IsQ0FBbEIsQ0FITztNQUliRyxHQUFHLEVBQUVULElBQUksQ0FBQ00sWUFBTCxDQUFrQixFQUFsQjtJQUpRLENBQWY7SUFPQSxJQUFJSSxPQUFPLEdBQUdWLElBQUksQ0FBQ1csS0FBTCxDQUFXbEIsYUFBWCxFQUEwQk8sSUFBSSxDQUFDSyxNQUEvQixDQUFkO0lBQ0EsS0FBS08sSUFBTCxDQUFVO01BQUVSLE1BQUY7TUFBVU0sT0FBTyxFQUFFRyxjQUFBLENBQU1DLFVBQU4sQ0FBaUJKLE9BQWpCO0lBQW5CLENBQVY7RUFDRDs7QUFyQjBDOzs7ZUEwQjlCaEIsYSJ9