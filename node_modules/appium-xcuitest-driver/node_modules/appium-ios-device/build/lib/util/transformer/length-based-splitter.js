"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = exports.LengthBasedSplitter = void 0;

require("source-map-support/register");

var _stream = _interopRequireDefault(require("stream"));

var _logger = _interopRequireDefault(require("../../logger"));

class LengthBasedSplitter extends _stream.default.Transform {
  constructor(opts) {
    super();
    const {
      readableStream,
      littleEndian,
      maxFrameLength,
      lengthFieldOffset,
      lengthFieldLength,
      lengthAdjustment
    } = opts;
    this.readableStream = readableStream;
    this.littleEndian = littleEndian;
    this.maxFrameLength = maxFrameLength;
    this.lengthFieldOffset = lengthFieldOffset;
    this.lengthFieldLength = lengthFieldLength;
    this.lengthAdjustment = lengthAdjustment;
    this.isShutdown = false;
    this._frameBufferIndex = 0;
    this._frameBuffer = Buffer.allocUnsafeSlow(maxFrameLength);
  }

  _transform(data, encoding, onData) {
    for (let i = 0; i < data.length; i = this._decode(data, i)) {
      if (this.isShutdown) {
        return this._pushBack(i, data.length, data);
      }
    }

    onData();
  }

  _decode(data, pos) {
    let bufferMarker = pos;
    let bytesToRead = Math.max(this.lengthFieldOffset + this.lengthFieldLength - this._frameBufferIndex, 0);
    let nBytesRead = bytesToRead === 0 ? 0 : this._readBytes(data, bufferMarker, this._frameBuffer, this._frameBufferIndex, bytesToRead);
    bufferMarker += nBytesRead;
    this._frameBufferIndex += nBytesRead;

    if (this._frameBufferIndex < this.lengthFieldOffset) {
      return bufferMarker;
    }

    const messageLength = this._readLength(this._frameBuffer, this.lengthFieldOffset, this.littleEndian);

    if (messageLength > this.maxFrameLength) {
      throw new Error(`The frame is bigger than expected. Length: ${messageLength}, max: ${this.maxFrameLength}`);
    }

    const completeMessageLength = messageLength + this.lengthAdjustment + this.lengthFieldOffset;
    bytesToRead = completeMessageLength - this._frameBufferIndex;
    nBytesRead = bytesToRead === 0 ? 0 : this._readBytes(data, bufferMarker, this._frameBuffer, this._frameBufferIndex, bytesToRead);
    bufferMarker += nBytesRead;
    this._frameBufferIndex += nBytesRead;

    if (this._frameBufferIndex < completeMessageLength) {
      return bufferMarker;
    }

    const message = Buffer.allocUnsafe(this._frameBufferIndex);

    this._frameBuffer.copy(message, 0, 0, this._frameBufferIndex);

    this.push(message);

    this._resetBuffers();

    return bufferMarker;
  }

  _readBytes(src, srcIndex, target, targetIndex, nBytesToBeRead) {
    let availableBytes = Math.min(nBytesToBeRead, src.length - srcIndex);
    src.copy(target, targetIndex, srcIndex, srcIndex + availableBytes);
    return availableBytes;
  }

  _resetBuffers() {
    this._frameBufferIndex = 0;
  }

  _pushBack(start, end, data) {
    if (start > end) {
      _logger.default.error('More data was read than the buffer size. This should not happen');
    }

    if (start === end) {
      return;
    }

    const leftover = Buffer.allocUnsafe(end - start);
    data.copy(leftover, 0, start, end);
    process.nextTick(() => this.readableStream.unshift(leftover));
  }

  shutdown() {
    this.isShutdown = true;
  }

  _readLength(data, index, littleEndian) {
    switch (this.lengthFieldLength) {
      case 4:
        return littleEndian ? data.readUInt32LE(index) : data.readUInt32BE(index);

      case 8:
        return littleEndian ? data.readUInt32LE(index) : data.readUInt32BE(index + 4);

      default:
        throw new Error(`${this.lengthFieldLength} is not supported. Only 4 and 8 are supported at the moment`);
    }
  }

}

exports.LengthBasedSplitter = LengthBasedSplitter;
var _default = LengthBasedSplitter;
exports.default = _default;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJMZW5ndGhCYXNlZFNwbGl0dGVyIiwiU3RyZWFtIiwiVHJhbnNmb3JtIiwiY29uc3RydWN0b3IiLCJvcHRzIiwicmVhZGFibGVTdHJlYW0iLCJsaXR0bGVFbmRpYW4iLCJtYXhGcmFtZUxlbmd0aCIsImxlbmd0aEZpZWxkT2Zmc2V0IiwibGVuZ3RoRmllbGRMZW5ndGgiLCJsZW5ndGhBZGp1c3RtZW50IiwiaXNTaHV0ZG93biIsIl9mcmFtZUJ1ZmZlckluZGV4IiwiX2ZyYW1lQnVmZmVyIiwiQnVmZmVyIiwiYWxsb2NVbnNhZmVTbG93IiwiX3RyYW5zZm9ybSIsImRhdGEiLCJlbmNvZGluZyIsIm9uRGF0YSIsImkiLCJsZW5ndGgiLCJfZGVjb2RlIiwiX3B1c2hCYWNrIiwicG9zIiwiYnVmZmVyTWFya2VyIiwiYnl0ZXNUb1JlYWQiLCJNYXRoIiwibWF4IiwibkJ5dGVzUmVhZCIsIl9yZWFkQnl0ZXMiLCJtZXNzYWdlTGVuZ3RoIiwiX3JlYWRMZW5ndGgiLCJFcnJvciIsImNvbXBsZXRlTWVzc2FnZUxlbmd0aCIsIm1lc3NhZ2UiLCJhbGxvY1Vuc2FmZSIsImNvcHkiLCJwdXNoIiwiX3Jlc2V0QnVmZmVycyIsInNyYyIsInNyY0luZGV4IiwidGFyZ2V0IiwidGFyZ2V0SW5kZXgiLCJuQnl0ZXNUb0JlUmVhZCIsImF2YWlsYWJsZUJ5dGVzIiwibWluIiwic3RhcnQiLCJlbmQiLCJsb2ciLCJlcnJvciIsImxlZnRvdmVyIiwicHJvY2VzcyIsIm5leHRUaWNrIiwidW5zaGlmdCIsInNodXRkb3duIiwiaW5kZXgiLCJyZWFkVUludDMyTEUiLCJyZWFkVUludDMyQkUiXSwic291cmNlcyI6WyIuLi8uLi8uLi8uLi9saWIvdXRpbC90cmFuc2Zvcm1lci9sZW5ndGgtYmFzZWQtc3BsaXR0ZXIuanMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IFN0cmVhbSBmcm9tICdzdHJlYW0nO1xuaW1wb3J0IGxvZyBmcm9tICcuLi8uLi9sb2dnZXInO1xuXG5jbGFzcyBMZW5ndGhCYXNlZFNwbGl0dGVyIGV4dGVuZHMgU3RyZWFtLlRyYW5zZm9ybSB7XG4gIGNvbnN0cnVjdG9yIChvcHRzKSB7XG4gICAgc3VwZXIoKTtcblxuICAgIGNvbnN0IHtcbiAgICAgIHJlYWRhYmxlU3RyZWFtLFxuICAgICAgbGl0dGxlRW5kaWFuLFxuICAgICAgbWF4RnJhbWVMZW5ndGgsXG4gICAgICBsZW5ndGhGaWVsZE9mZnNldCxcbiAgICAgIGxlbmd0aEZpZWxkTGVuZ3RoLFxuICAgICAgbGVuZ3RoQWRqdXN0bWVudCxcbiAgICB9ID0gb3B0cztcblxuICAgIHRoaXMucmVhZGFibGVTdHJlYW0gPSByZWFkYWJsZVN0cmVhbTtcbiAgICB0aGlzLmxpdHRsZUVuZGlhbiA9IGxpdHRsZUVuZGlhbjtcbiAgICB0aGlzLm1heEZyYW1lTGVuZ3RoID0gbWF4RnJhbWVMZW5ndGg7XG4gICAgdGhpcy5sZW5ndGhGaWVsZE9mZnNldCA9IGxlbmd0aEZpZWxkT2Zmc2V0O1xuICAgIHRoaXMubGVuZ3RoRmllbGRMZW5ndGggPSBsZW5ndGhGaWVsZExlbmd0aDtcbiAgICB0aGlzLmxlbmd0aEFkanVzdG1lbnQgPSBsZW5ndGhBZGp1c3RtZW50O1xuXG4gICAgdGhpcy5pc1NodXRkb3duID0gZmFsc2U7XG4gICAgdGhpcy5fZnJhbWVCdWZmZXJJbmRleCA9IDA7XG4gICAgdGhpcy5fZnJhbWVCdWZmZXIgPSBCdWZmZXIuYWxsb2NVbnNhZmVTbG93KG1heEZyYW1lTGVuZ3RoKTtcbiAgfVxuXG4gIF90cmFuc2Zvcm0gKGRhdGEsIGVuY29kaW5nLCBvbkRhdGEpIHtcbiAgICBmb3IgKGxldCBpID0gMDsgaSA8IGRhdGEubGVuZ3RoOyBpID0gdGhpcy5fZGVjb2RlKGRhdGEsIGkpKSB7XG4gICAgICBpZiAodGhpcy5pc1NodXRkb3duKSB7XG4gICAgICAgIHJldHVybiB0aGlzLl9wdXNoQmFjayhpLCBkYXRhLmxlbmd0aCwgZGF0YSk7XG4gICAgICB9XG4gICAgfVxuICAgIG9uRGF0YSgpO1xuICB9XG5cbiAgX2RlY29kZSAoZGF0YSwgcG9zKSB7XG4gICAgbGV0IGJ1ZmZlck1hcmtlciA9IHBvcztcblxuICAgIGxldCBieXRlc1RvUmVhZCA9IE1hdGgubWF4KCh0aGlzLmxlbmd0aEZpZWxkT2Zmc2V0ICsgdGhpcy5sZW5ndGhGaWVsZExlbmd0aCkgLSB0aGlzLl9mcmFtZUJ1ZmZlckluZGV4LCAwKTtcbiAgICBsZXQgbkJ5dGVzUmVhZCA9IGJ5dGVzVG9SZWFkID09PSAwID8gMCA6IHRoaXMuX3JlYWRCeXRlcyhkYXRhLCBidWZmZXJNYXJrZXIsIHRoaXMuX2ZyYW1lQnVmZmVyLCB0aGlzLl9mcmFtZUJ1ZmZlckluZGV4LCBieXRlc1RvUmVhZCk7XG4gICAgYnVmZmVyTWFya2VyICs9IG5CeXRlc1JlYWQ7XG4gICAgdGhpcy5fZnJhbWVCdWZmZXJJbmRleCArPSBuQnl0ZXNSZWFkO1xuXG4gICAgaWYgKHRoaXMuX2ZyYW1lQnVmZmVySW5kZXggPCB0aGlzLmxlbmd0aEZpZWxkT2Zmc2V0KSB7XG4gICAgICByZXR1cm4gYnVmZmVyTWFya2VyO1xuICAgIH1cblxuICAgIGNvbnN0IG1lc3NhZ2VMZW5ndGggPSB0aGlzLl9yZWFkTGVuZ3RoKHRoaXMuX2ZyYW1lQnVmZmVyLCB0aGlzLmxlbmd0aEZpZWxkT2Zmc2V0LCB0aGlzLmxpdHRsZUVuZGlhbik7XG4gICAgaWYgKG1lc3NhZ2VMZW5ndGggPiB0aGlzLm1heEZyYW1lTGVuZ3RoKSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoYFRoZSBmcmFtZSBpcyBiaWdnZXIgdGhhbiBleHBlY3RlZC4gTGVuZ3RoOiAke21lc3NhZ2VMZW5ndGh9LCBtYXg6ICR7dGhpcy5tYXhGcmFtZUxlbmd0aH1gKTtcbiAgICB9XG5cbiAgICBjb25zdCBjb21wbGV0ZU1lc3NhZ2VMZW5ndGggPSBtZXNzYWdlTGVuZ3RoICsgdGhpcy5sZW5ndGhBZGp1c3RtZW50ICsgdGhpcy5sZW5ndGhGaWVsZE9mZnNldDtcblxuICAgIGJ5dGVzVG9SZWFkID0gY29tcGxldGVNZXNzYWdlTGVuZ3RoIC0gdGhpcy5fZnJhbWVCdWZmZXJJbmRleDtcbiAgICBuQnl0ZXNSZWFkID0gYnl0ZXNUb1JlYWQgPT09IDAgPyAwIDogdGhpcy5fcmVhZEJ5dGVzKGRhdGEsIGJ1ZmZlck1hcmtlciwgdGhpcy5fZnJhbWVCdWZmZXIsIHRoaXMuX2ZyYW1lQnVmZmVySW5kZXgsIGJ5dGVzVG9SZWFkKTtcbiAgICBidWZmZXJNYXJrZXIgKz0gbkJ5dGVzUmVhZDtcbiAgICB0aGlzLl9mcmFtZUJ1ZmZlckluZGV4ICs9IG5CeXRlc1JlYWQ7XG5cbiAgICBpZiAodGhpcy5fZnJhbWVCdWZmZXJJbmRleCA8IGNvbXBsZXRlTWVzc2FnZUxlbmd0aCkge1xuICAgICAgcmV0dXJuIGJ1ZmZlck1hcmtlcjtcbiAgICB9XG5cbiAgICBjb25zdCBtZXNzYWdlID0gQnVmZmVyLmFsbG9jVW5zYWZlKHRoaXMuX2ZyYW1lQnVmZmVySW5kZXgpO1xuICAgIHRoaXMuX2ZyYW1lQnVmZmVyLmNvcHkobWVzc2FnZSwgMCwgMCwgdGhpcy5fZnJhbWVCdWZmZXJJbmRleCk7XG5cbiAgICB0aGlzLnB1c2gobWVzc2FnZSk7XG4gICAgdGhpcy5fcmVzZXRCdWZmZXJzKCk7XG4gICAgcmV0dXJuIGJ1ZmZlck1hcmtlcjtcbiAgfVxuXG4gIF9yZWFkQnl0ZXMgKHNyYywgc3JjSW5kZXgsIHRhcmdldCwgdGFyZ2V0SW5kZXgsIG5CeXRlc1RvQmVSZWFkKSB7XG4gICAgbGV0IGF2YWlsYWJsZUJ5dGVzID0gTWF0aC5taW4obkJ5dGVzVG9CZVJlYWQsIHNyYy5sZW5ndGggLSBzcmNJbmRleCk7XG4gICAgc3JjLmNvcHkodGFyZ2V0LCB0YXJnZXRJbmRleCwgc3JjSW5kZXgsIHNyY0luZGV4ICsgYXZhaWxhYmxlQnl0ZXMpO1xuICAgIHJldHVybiBhdmFpbGFibGVCeXRlcztcbiAgfVxuICBfcmVzZXRCdWZmZXJzICgpIHtcbiAgICB0aGlzLl9mcmFtZUJ1ZmZlckluZGV4ID0gMDtcbiAgfVxuXG4gIF9wdXNoQmFjayAoc3RhcnQsIGVuZCwgZGF0YSkge1xuICAgIGlmIChzdGFydCA+IGVuZCkge1xuICAgICAgbG9nLmVycm9yKCdNb3JlIGRhdGEgd2FzIHJlYWQgdGhhbiB0aGUgYnVmZmVyIHNpemUuIFRoaXMgc2hvdWxkIG5vdCBoYXBwZW4nKTtcbiAgICB9XG4gICAgaWYgKHN0YXJ0ID09PSBlbmQpIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG4gICAgY29uc3QgbGVmdG92ZXIgPSBCdWZmZXIuYWxsb2NVbnNhZmUoZW5kIC0gc3RhcnQpO1xuICAgIGRhdGEuY29weShsZWZ0b3ZlciwgMCwgc3RhcnQsIGVuZCk7XG4gICAgcHJvY2Vzcy5uZXh0VGljaygoKSA9PiB0aGlzLnJlYWRhYmxlU3RyZWFtLnVuc2hpZnQobGVmdG92ZXIpKTtcbiAgfVxuXG4gIHNodXRkb3duICgpIHtcbiAgICB0aGlzLmlzU2h1dGRvd24gPSB0cnVlO1xuICB9XG5cbiAgX3JlYWRMZW5ndGggKGRhdGEsIGluZGV4LCBsaXR0bGVFbmRpYW4pIHtcbiAgICBzd2l0Y2ggKHRoaXMubGVuZ3RoRmllbGRMZW5ndGgpIHtcbiAgICAgIGNhc2UgNDpcbiAgICAgICAgcmV0dXJuIGxpdHRsZUVuZGlhbiA/IGRhdGEucmVhZFVJbnQzMkxFKGluZGV4KSA6IGRhdGEucmVhZFVJbnQzMkJFKGluZGV4KTtcbiAgICAgIGNhc2UgODpcbiAgICAgICAgcmV0dXJuIGxpdHRsZUVuZGlhbiA/IGRhdGEucmVhZFVJbnQzMkxFKGluZGV4KSA6IGRhdGEucmVhZFVJbnQzMkJFKGluZGV4ICsgNCk7XG4gICAgICBkZWZhdWx0OlxuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoYCR7dGhpcy5sZW5ndGhGaWVsZExlbmd0aH0gaXMgbm90IHN1cHBvcnRlZC4gT25seSA0IGFuZCA4IGFyZSBzdXBwb3J0ZWQgYXQgdGhlIG1vbWVudGApO1xuICAgIH1cbiAgfVxufVxuXG5leHBvcnQgeyBMZW5ndGhCYXNlZFNwbGl0dGVyfTtcbmV4cG9ydCBkZWZhdWx0IExlbmd0aEJhc2VkU3BsaXR0ZXI7XG4iXSwibWFwcGlu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