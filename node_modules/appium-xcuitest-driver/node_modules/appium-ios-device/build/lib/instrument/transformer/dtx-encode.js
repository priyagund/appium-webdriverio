"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.DTXEncoder = void 0;

require("source-map-support/register");

var _stream = _interopRequireDefault(require("stream"));

var _headers = require("../headers");

class DTXEncoder extends _stream.default.Transform {
  constructor() {
    super({
      objectMode: true
    });
  }

  _transform(data, encoding, onData) {
    this.push(this._encode(data), 'buffer');
    onData();
  }

  _encode(data) {
    const {
      sync,
      channelCode,
      selector,
      auxiliaries,
      identifier
    } = data;
    const dtx = new _headers.DTXMessage({
      identifier,
      channelCode,
      selector,
      expectsReply: sync
    });

    if (auxiliaries instanceof _headers.DTXMessageAuxBuffer) {
      dtx.auxiliaries = auxiliaries;
    } else {
      dtx.auxiliaries.data = auxiliaries;
    }

    return dtx.build();
  }

}

exports.DTXEncoder = DTXEncoder;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJEVFhFbmNvZGVyIiwiU3RyZWFtIiwiVHJhbnNmb3JtIiwiY29uc3RydWN0b3IiLCJvYmplY3RNb2RlIiwiX3RyYW5zZm9ybSIsImRhdGEiLCJlbmNvZGluZyIsIm9uRGF0YSIsInB1c2giLCJfZW5jb2RlIiwic3luYyIsImNoYW5uZWxDb2RlIiwic2VsZWN0b3IiLCJhdXhpbGlhcmllcyIsImlkZW50aWZpZXIiLCJkdHgiLCJEVFhNZXNzYWdlIiwiZXhwZWN0c1JlcGx5IiwiRFRYTWVzc2FnZUF1eEJ1ZmZlciIsImJ1aWxkIl0sInNvdXJjZXMiOlsiLi4vLi4vLi4vLi4vbGliL2luc3RydW1lbnQvdHJhbnNmb3JtZXIvZHR4LWVuY29kZS5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgU3RyZWFtIGZyb20gJ3N0cmVhbSc7XG5pbXBvcnQge0RUWE1lc3NhZ2UsIERUWE1lc3NhZ2VBdXhCdWZmZXJ9IGZyb20gJy4uL2hlYWRlcnMnO1xuXG5cbmNsYXNzIERUWEVuY29kZXIgZXh0ZW5kcyBTdHJlYW0uVHJhbnNmb3JtIHtcblxuICBjb25zdHJ1Y3RvciAoKSB7XG4gICAgc3VwZXIoeyBvYmplY3RNb2RlOiB0cnVlIH0pO1xuICB9XG5cbiAgX3RyYW5zZm9ybSAoZGF0YSwgZW5jb2RpbmcsIG9uRGF0YSkge1xuICAgIHRoaXMucHVzaCh0aGlzLl9lbmNvZGUoZGF0YSksICdidWZmZXInKTtcbiAgICBvbkRhdGEoKTtcbiAgfVxuXG4gIF9lbmNvZGUgKGRhdGEpIHtcbiAgICBjb25zdCB7c3luYywgY2hhbm5lbENvZGUsIHNlbGVjdG9yLCBhdXhpbGlhcmllcywgaWRlbnRpZmllcn0gPSBkYXRhO1xuICAgIGNvbnN0IGR0eCA9IG5ldyBEVFhNZXNzYWdlKHtcbiAgICAgIGlkZW50aWZpZXIsXG4gICAgICBjaGFubmVsQ29kZSxcbiAgICAgIHNlbGVjdG9yLFxuICAgICAgZXhwZWN0c1JlcGx5OiBzeW5jXG4gICAgfSk7XG4gICAgaWYgKGF1eGlsaWFyaWVzIGluc3RhbmNlb2YgRFRYTWVzc2FnZUF1eEJ1ZmZlcikge1xuICAgICAgZHR4LmF1eGlsaWFyaWVzID0gYXV4aWxpYXJpZXM7XG4gICAgfSBlbHNlIHtcbiAgICAgIGR0eC5hdXhpbGlhcmllcy5kYXRhID0gYXV4aWxpYXJpZXM7XG4gICAgfVxuICAgIHJldHVybiBkdHguYnVpbGQoKTtcbiAgfVxufVxuXG5leHBvcnQgeyBEVFhFbmNvZGVyIH07XG4iXSwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7O0FBQUE7O0FBQ0E7O0FBR0EsTUFBTUEsVUFBTixTQUF5QkMsZUFBQSxDQUFPQyxTQUFoQyxDQUEwQztFQUV4Q0MsV0FBVyxHQUFJO0lBQ2IsTUFBTTtNQUFFQyxVQUFVLEVBQUU7SUFBZCxDQUFOO0VBQ0Q7O0VBRURDLFVBQVUsQ0FBRUMsSUFBRixFQUFRQyxRQUFSLEVBQWtCQyxNQUFsQixFQUEwQjtJQUNsQyxLQUFLQyxJQUFMLENBQVUsS0FBS0MsT0FBTCxDQUFhSixJQUFiLENBQVYsRUFBOEIsUUFBOUI7SUFDQUUsTUFBTTtFQUNQOztFQUVERSxPQUFPLENBQUVKLElBQUYsRUFBUTtJQUNiLE1BQU07TUFBQ0ssSUFBRDtNQUFPQyxXQUFQO01BQW9CQyxRQUFwQjtNQUE4QkMsV0FBOUI7TUFBMkNDO0lBQTNDLElBQXlEVCxJQUEvRDtJQUNBLE1BQU1VLEdBQUcsR0FBRyxJQUFJQyxtQkFBSixDQUFlO01BQ3pCRixVQUR5QjtNQUV6QkgsV0FGeUI7TUFHekJDLFFBSHlCO01BSXpCSyxZQUFZLEVBQUVQO0lBSlcsQ0FBZixDQUFaOztJQU1BLElBQUlHLFdBQVcsWUFBWUssNEJBQTNCLEVBQWdEO01BQzlDSCxHQUFHLENBQUNGLFdBQUosR0FBa0JBLFdBQWxCO0lBQ0QsQ0FGRCxNQUVPO01BQ0xFLEdBQUcsQ0FBQ0YsV0FBSixDQUFnQlIsSUFBaEIsR0FBdUJRLFdBQXZCO0lBQ0Q7O0lBQ0QsT0FBT0UsR0FBRyxDQUFDSSxLQUFKLEVBQVA7RUFDRDs7QUF6QnVDIn0=