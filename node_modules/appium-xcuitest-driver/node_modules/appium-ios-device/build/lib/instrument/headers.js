"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.FLAG_TYPES = exports.DTX_MESSAGE_PAYLOAD_HEADER_LENGTH = exports.DTX_MESSAGE_HEADER_MAGIC_LEN = exports.DTX_MESSAGE_HEADER_MAGIC = exports.DTX_MESSAGE_HEADER_LENGTH = exports.DTXMessagePayloadHeader = exports.DTXMessageHeader = exports.DTXMessageAuxBuffer = exports.DTXMessageAux = exports.DTXMessage = void 0;

require("source-map-support/register");

var _nskeyed = require("./transformer/nskeyed");

var _bplistParser = _interopRequireDefault(require("bplist-parser"));

var _lodash = _interopRequireDefault(require("lodash"));

const DTX_MESSAGE_PAYLOAD_HEADER_LENGTH = 16;
exports.DTX_MESSAGE_PAYLOAD_HEADER_LENGTH = DTX_MESSAGE_PAYLOAD_HEADER_LENGTH;
const DTX_MESSAGE_HEADER_LENGTH = 32;
exports.DTX_MESSAGE_HEADER_LENGTH = DTX_MESSAGE_HEADER_LENGTH;
const DTX_MESSAGE_HEADER_MAGIC = 0x1F3D5B79;
exports.DTX_MESSAGE_HEADER_MAGIC = DTX_MESSAGE_HEADER_MAGIC;
const DTX_MESSAGE_HEADER_MAGIC_LEN = 4;
exports.DTX_MESSAGE_HEADER_MAGIC_LEN = DTX_MESSAGE_HEADER_MAGIC_LEN;
const DTX_MESSAGE_AUX_HEADER = 0x01F0;
const DTX_AUXILIARY_MAGIC = 0xa;
const FLAG_TYPES = Object.freeze({
  push: 0,
  recv: 1,
  send: 2,
  reply: 3
});
exports.FLAG_TYPES = FLAG_TYPES;
const AUX_TYPES = Object.freeze({
  Text: 1,
  NSKeyed: 2,
  UInt32LE: 3,
  BigUInt64LE: 4,
  BigInt64LE: 6
});

class DTXMessageHeader {
  static build(data) {
    const messageHeader = Buffer.alloc(DTX_MESSAGE_HEADER_LENGTH);
    messageHeader.writeUInt32LE(DTX_MESSAGE_HEADER_MAGIC, 0);
    messageHeader.writeUInt32LE(DTX_MESSAGE_HEADER_LENGTH, 4);
    messageHeader.writeUInt16LE(0, 8);
    messageHeader.writeUInt16LE(1, 10);
    messageHeader.writeUInt32LE(data.payloadLength, 12);
    messageHeader.writeUInt32LE(data.identifier, 16);
    messageHeader.writeUInt32LE(data.conversationIndex, 20);
    messageHeader.writeUInt32LE(data.channelCode, 24);
    messageHeader.writeUInt32LE(data.expectsReply, 28);
    return messageHeader;
  }

  static parse(headerBuffer) {
    return {
      magic: headerBuffer.readUInt32LE(0),
      headerLength: headerBuffer.readUInt32LE(4),
      fragmentId: headerBuffer.readUInt16LE(8),
      fragmentCount: headerBuffer.readUInt16LE(10),
      payloadLength: headerBuffer.readUInt32LE(12),
      identifier: headerBuffer.readUInt32LE(16),
      conversationIndex: headerBuffer.readUInt32LE(20),
      channel: headerBuffer.readUInt32LE(24),
      expectsReply: headerBuffer.readUInt32LE(28)
    };
  }

}

exports.DTXMessageHeader = DTXMessageHeader;

class DTXMessagePayloadHeader {
  static build(data) {
    const messageHeader = Buffer.alloc(DTX_MESSAGE_PAYLOAD_HEADER_LENGTH);
    messageHeader.writeUInt32LE(data.flags, 0);
    messageHeader.writeUInt32LE(data.auxLength, 4);
    messageHeader.writeBigUInt64LE(data.totalLength, 8);
    return messageHeader;
  }

  static parse(headerBuffer) {
    return {
      flags: headerBuffer.readUInt32LE(0),
      auxLength: headerBuffer.readUInt32LE(4),
      totalLength: headerBuffer.readBigInt64LE(8)
    };
  }

}

exports.DTXMessagePayloadHeader = DTXMessagePayloadHeader;

class DTXMessageAux {
  constructor(data = []) {
    this.data = data;
  }

  build() {
    const messageAux = new DTXMessageAuxBuffer();
    let buf = Buffer.alloc(0);

    if (this.data.length === 0) {
      return buf;
    }

    for (const arg of this.data) {
      if (arg instanceof DTXMessageAuxBuffer) {
        buf = Buffer.concat([buf, arg.getBytes()]);
      } else if (_lodash.default.isNumber(arg)) {
        messageAux.appendInt(arg);
      } else if (typeof arg == 'bigint') {
        messageAux.appendLong(arg);
      } else {
        messageAux.appendObject(arg);
      }
    }

    return Buffer.concat([buf, messageAux.getBytes()]);
  }

  static parse(headerBuffer, payloadHeader) {
    let cursor = 0;
    const data = [];
    const length = headerBuffer.readBigInt64LE(8);
    cursor += 16;

    while (cursor <= length) {
      if (payloadHeader.flags !== FLAG_TYPES.push) {
        const m = headerBuffer.readUInt32LE(cursor);
        cursor += 4;

        if (m !== DTX_AUXILIARY_MAGIC) {
          throw new Error(`incorrect auxiliary magic: ${m}`);
        }
      }

      const type = headerBuffer.readUInt32LE(cursor);
      cursor += 4;

      switch (type) {
        case AUX_TYPES.Text:
          {
            const strLen = headerBuffer.readUInt32LE(cursor);
            cursor += 4;
            data.push(headerBuffer.slice(cursor, cursor + strLen));
            cursor += strLen;
            break;
          }

        case AUX_TYPES.NSKeyed:
          {
            const strLen = headerBuffer.readUInt32LE(cursor);
            cursor += 4;
            const archived_data = headerBuffer.slice(cursor, cursor + strLen);
            data.push((0, _nskeyed.unarchive)(archived_data));
            cursor += strLen;
            break;
          }

        case AUX_TYPES.UInt32LE:
          data.push(headerBuffer.readUInt32LE(cursor));
          cursor += 4;
          break;

        case AUX_TYPES.BigUInt64LE:
          data.push(headerBuffer.readBigUInt64LE(cursor));
          cursor += 8;
          break;

        case AUX_TYPES.BigInt64LE:
          data.push(headerBuffer.readBigInt64LE(cursor));
          cursor += 8;
          break;

        default:
          throw new Error(`Unknown type ${type}`);
      }
    }

    return data;
  }

}

exports.DTXMessageAux = DTXMessageAux;

class InstrumentRPCParseError {
  constructor(data) {
    this.data = data;
  }

}

class DTXMessageAuxBuffer {
  constructor() {
    this._buf = Buffer.alloc(0);
  }

  appendInt(value) {
    const buf = Buffer.alloc(12);
    buf.writeUInt32LE(DTX_AUXILIARY_MAGIC, 0);
    buf.writeUInt32LE(3, 4);
    buf.writeUInt32LE(value, 8);
    this._buf = Buffer.concat([this._buf, buf]);
  }

  appendLong(value) {
    const buf = Buffer.alloc(16);
    buf.writeUInt32LE(DTX_AUXILIARY_MAGIC, 0);
    buf.writeUInt32LE(4, 4);
    buf.writeBigUInt64LE(value, 8);
    this._buf = Buffer.concat([this._buf, buf]);
  }

  appendSignedInt(value) {
    const buf = Buffer.alloc(12);
    buf.writeUInt32LE(DTX_AUXILIARY_MAGIC, 0);
    buf.writeUInt32LE(3, 4);
    buf.writeInt32LE(value, 8);
    this._buf = Buffer.concat([this._buf, buf]);
  }

  appendSignedLong(value) {
    const buf = Buffer.alloc(16);
    buf.writeUInt32LE(DTX_AUXILIARY_MAGIC, 0);
    buf.writeUInt32LE(6, 4);
    buf.writeBigInt64LE(value, 8);
    this._buf = Buffer.concat([this._buf, buf]);
  }

  appendObject(value) {
    const buf = (0, _nskeyed.archive)(value);
    const buf2 = Buffer.alloc(12);
    buf2.writeUInt32LE(DTX_AUXILIARY_MAGIC, 0);
    buf2.writeUInt32LE(2, 4);
    buf2.writeUInt32LE(buf.length, 8);
    this._buf = Buffer.concat([this._buf, buf2, buf]);
  }

  getBytes() {
    const out = Buffer.alloc(16);
    out.writeUInt32LE(DTX_MESSAGE_AUX_HEADER, 0);
    out.writeUInt32LE(this._buf.length, 8);
    return Buffer.concat([out, this._buf]);
  }

}

exports.DTXMessageAuxBuffer = DTXMessageAuxBuffer;

class DTXMessage {
  constructor(opts = {}) {
    const {
      identifier,
      channelCode,
      selector,
      expectsReply,
      conversationIndex = 0,
      flags = FLAG_TYPES.send
    } = opts;
    this._messageHeader = undefined;
    this._payloadHeader = undefined;
    this._identifier = identifier;
    this._channelCode = channelCode;
    this._expectsReply = expectsReply;
    this._selector = selector;
    this._conversationIndex = conversationIndex;
    this._flags = flags;
    this.auxiliaries = new DTXMessageAux();
  }

  get identifier() {
    var _this$_messageHeader;

    return (_this$_messageHeader = this._messageHeader) === null || _this$_messageHeader === void 0 ? void 0 : _this$_messageHeader.identifier;
  }

  get channelCode() {
    var _this$_messageHeader2;

    return (_this$_messageHeader2 = this._messageHeader) === null || _this$_messageHeader2 === void 0 ? void 0 : _this$_messageHeader2.channel;
  }

  get expectsReply() {
    var _this$_messageHeader3;

    return (_this$_messageHeader3 = this._messageHeader) === null || _this$_messageHeader3 === void 0 ? void 0 : _this$_messageHeader3.expectsReply;
  }

  get selector() {
    return this._selector;
  }

  set selector(data) {
    this._selector = data;
  }

  get conversationIndex() {
    var _this$_messageHeader4;

    return (_this$_messageHeader4 = this._messageHeader) === null || _this$_messageHeader4 === void 0 ? void 0 : _this$_messageHeader4.conversationIndex;
  }

  build() {
    const sel = this._selector ? (0, _nskeyed.archive)(this._selector) : Buffer.alloc(0);
    const aux = this.auxiliaries.build();
    const payloadHeader = DTXMessagePayloadHeader.build({
      flags: this._flags,
      auxLength: aux.length,
      totalLength: BigInt(aux.length + sel.length)
    });
    const messageHeader = DTXMessageHeader.build({
      payloadLength: DTX_MESSAGE_PAYLOAD_HEADER_LENGTH + aux.length + sel.length,
      identifier: this._identifier,
      conversationIndex: this._conversationIndex,
      channelCode: this._channelCode,
      expectsReply: this._expectsReply
    });
    return Buffer.concat([messageHeader, payloadHeader, aux, sel]);
  }

  static parse(headerBuf, payloadBuf) {
    let cursor = 0;
    const ret = new DTXMessage();
    ret._messageHeader = DTXMessageHeader.parse(headerBuf);

    if (ret._messageHeader.payloadLength === 0) {
      return ret;
    }

    ret._payloadHeader = DTXMessagePayloadHeader.parse(payloadBuf.slice(cursor, DTX_MESSAGE_PAYLOAD_HEADER_LENGTH));
    cursor += DTX_MESSAGE_PAYLOAD_HEADER_LENGTH;

    if (ret._payloadHeader.totalLength === 0n) {
      return ret;
    }

    if (ret._payloadHeader.auxLength > 0) {
      ret.auxiliaries = DTXMessageAux.parse(payloadBuf.slice(cursor, cursor + ret._payloadHeader.auxLength), ret._payloadHeader);
      cursor += ret._payloadHeader.auxLength;
    }

    const data = payloadBuf.slice(cursor, cursor + payloadBuf.length);
    ret.selector = data;

    if (data.length > 0) {
      for (const fun of [_nskeyed.unarchive, _bplistParser.default.parseBuffer]) {
        try {
          ret.selector = fun(data);
          break;
        } catch (e) {
          ret.selector = new InstrumentRPCParseError(data);
        }
      }
    }

    return ret;
  }

}

exports.DTXMessage = DTXMessage;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJEVFhfTUVTU0FHRV9QQVlMT0FEX0hFQURFUl9MRU5HVEgiLCJEVFhfTUVTU0FHRV9IRUFERVJfTEVOR1RIIiwiRFRYX01FU1NBR0VfSEVBREVSX01BR0lDIiwiRFRYX01FU1NBR0VfSEVBREVSX01BR0lDX0xFTiIsIkRUWF9NRVNTQUdFX0FVWF9IRUFERVIiLCJEVFhfQVVYSUxJQVJZX01BR0lDIiwiRkxBR19UWVBFUyIsIk9iamVjdCIsImZyZWV6ZSIsInB1c2giLCJyZWN2Iiwic2VuZCIsInJlcGx5IiwiQVVYX1RZUEVTIiwiVGV4dCIsIk5TS2V5ZWQiLCJVSW50MzJMRSIsIkJpZ1VJbnQ2NExFIiwiQmlnSW50NjRMRSIsIkRUWE1lc3NhZ2VIZWFkZXIiLCJidWlsZCIsImRhdGEiLCJtZXNzYWdlSGVhZGVyIiwiQnVmZmVyIiwiYWxsb2MiLCJ3cml0ZVVJbnQzMkxFIiwid3JpdGVVSW50MTZMRSIsInBheWxvYWRMZW5ndGgiLCJpZGVudGlmaWVyIiwiY29udmVyc2F0aW9uSW5kZXgiLCJjaGFubmVsQ29kZSIsImV4cGVjdHNSZXBseSIsInBhcnNlIiwiaGVhZGVyQnVmZmVyIiwibWFnaWMiLCJyZWFkVUludDMyTEUiLCJoZWFkZXJMZW5ndGgiLCJmcmFnbWVudElkIiwicmVhZFVJbnQxNkxFIiwiZnJhZ21lbnRDb3VudCIsImNoYW5uZWwiLCJEVFhNZXNzYWdlUGF5bG9hZEhlYWRlciIsImZsYWdzIiwiYXV4TGVuZ3RoIiwid3JpdGVCaWdVSW50NjRMRSIsInRvdGFsTGVuZ3RoIiwicmVhZEJpZ0ludDY0TEUiLCJEVFhNZXNzYWdlQXV4IiwiY29uc3RydWN0b3IiLCJtZXNzYWdlQXV4IiwiRFRYTWVzc2FnZUF1eEJ1ZmZlciIsImJ1ZiIsImxlbmd0aCIsImFyZyIsImNvbmNhdCIsImdldEJ5dGVzIiwiXyIsImlzTnVtYmVyIiwiYXBwZW5kSW50IiwiYXBwZW5kTG9uZyIsImFwcGVuZE9iamVjdCIsInBheWxvYWRIZWFkZXIiLCJjdXJzb3IiLCJtIiwiRXJyb3IiLCJ0eXBlIiwic3RyTGVuIiwic2xpY2UiLCJhcmNoaXZlZF9kYXRhIiwidW5hcmNoaXZlIiwicmVhZEJpZ1VJbnQ2NExFIiwiSW5zdHJ1bWVudFJQQ1BhcnNlRXJyb3IiLCJfYnVmIiwidmFsdWUiLCJhcHBlbmRTaWduZWRJbnQiLCJ3cml0ZUludDMyTEUiLCJhcHBlbmRTaWduZWRMb25nIiwid3JpdGVCaWdJbnQ2NExFIiwiYXJjaGl2ZSIsImJ1ZjIiLCJvdXQiLCJEVFhNZXNzYWdlIiwib3B0cyIsInNlbGVjdG9yIiwiX21lc3NhZ2VIZWFkZXIiLCJ1bmRlZmluZWQiLCJfcGF5bG9hZEhlYWRlciIsIl9pZGVudGlmaWVyIiwiX2NoYW5uZWxDb2RlIiwiX2V4cGVjdHNSZXBseSIsIl9zZWxlY3RvciIsIl9jb252ZXJzYXRpb25JbmRleCIsIl9mbGFncyIsImF1eGlsaWFyaWVzIiwic2VsIiwiYXV4IiwiQmlnSW50IiwiaGVhZGVyQnVmIiwicGF5bG9hZEJ1ZiIsInJldCIsImZ1biIsInBsaXN0bGliIiwicGFyc2VCdWZmZXIiLCJlIl0sInNvdXJjZXMiOlsiLi4vLi4vLi4vbGliL2luc3RydW1lbnQvaGVhZGVycy5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQge2FyY2hpdmUsIHVuYXJjaGl2ZX0gZnJvbSAnLi90cmFuc2Zvcm1lci9uc2tleWVkJztcbmltcG9ydCBwbGlzdGxpYiBmcm9tICdicGxpc3QtcGFyc2VyJztcbmltcG9ydCBfIGZyb20gJ2xvZGFzaCc7XG5cbmNvbnN0IERUWF9NRVNTQUdFX1BBWUxPQURfSEVBREVSX0xFTkdUSCA9IDE2O1xuY29uc3QgRFRYX01FU1NBR0VfSEVBREVSX0xFTkdUSCA9IDMyO1xuY29uc3QgRFRYX01FU1NBR0VfSEVBREVSX01BR0lDID0gMHgxRjNENUI3OTtcbmNvbnN0IERUWF9NRVNTQUdFX0hFQURFUl9NQUdJQ19MRU4gPSA0O1xuY29uc3QgRFRYX01FU1NBR0VfQVVYX0hFQURFUiA9IDB4MDFGMDtcbmNvbnN0IERUWF9BVVhJTElBUllfTUFHSUMgPSAweGE7XG5cbmNvbnN0IEZMQUdfVFlQRVMgPSBPYmplY3QuZnJlZXplKHtcbiAgcHVzaDogMCxcbiAgcmVjdjogMSxcbiAgc2VuZDogMixcbiAgcmVwbHk6IDNcbn0pO1xuXG5jb25zdCBBVVhfVFlQRVMgPSBPYmplY3QuZnJlZXplKHtcbiAgVGV4dDogMSxcbiAgTlNLZXllZDogMixcbiAgVUludDMyTEU6IDMsXG4gIEJpZ1VJbnQ2NExFOiA0LFxuICBCaWdJbnQ2NExFOiA2XG59KTtcblxuLyoqXG4gKiBEVFhNZXNzYWdlSGVhZGVyIGxlbmd0aCAzMlxuICogc3RydWN0IERUWE1lc3NhZ2VIZWFkZXIge1xuICogICAgIHUzMiBtYWdpYyBEVFhfTUVTU0FHRV9IRUFERVJfTUFHSUNcbiAqICAgICB1MzIgaGVhZGVyTGVuZ3RoXG4gKiAgICAgdTE2IGZyYWdtZW50SWQgICBwYWNrZXQgbnVtYmVyXG4gKiAgICAgdTE2IGZyYWdtZW50Q291bnQgIHBhY2tldHMgdG90YWwgbnVtYmVyXG4gKiAgICAgdTMyIHBheWxvYWRMZW5ndGhcbiAqICAgICB1MzIgaWRlbnRpZmllclxuICogICAgIHUzMiBjb252ZXJzYXRpb25JbmRleFxuICogICAgIHUzMiBjaGFubmVsXG4gKiAgICAgdTMyIGV4cGVjdHNSZXBseVxuICogICAgIH1cbiAqL1xuXG4vKipcbiAqIEB0eXBlZGVmIHtPYmplY3R9IERUWE1lc3NhZ2VPcHRpb25zXG4gKiBAcHJvcGVydHkge251bWJlcn0gaWRlbnRpZmllciBwYWNrZXQgdHJhbnNtaXNzaW9uIHNlcXVlbmNlLCB0aGlzIHZhbHVlIGlzIGluY3JlbWVudGVkIGZvciBlYWNoIHJlcXVlc3RcbiAqIEBwcm9wZXJ0eSB7bnVtYmVyfSBjaGFubmVsQ29kZSB0aGUgZGF0YSB0cmFuc21pc3Npb24gb2YgdGhlIHNlcnZpY2Ugd2lsbCB1c2UgdGhpcyBjaGFubmVsIGNvZGUuXG4gKiBFYWNoIHNlcnZpY2UgaGFzIGEgc2VwYXJhdGUgY2hhbm5lbFxuICogQHByb3BlcnR5IHs/bnVtYmVyfSBwYXlsb2FkTGVuZ3RoIERUWE1lc3NhZ2VBdXhCdWZmZXIubGVuZ3RoKG51bGxhYmxlKSArIHNlbGVjdG9yQnVmZmVyLmxlbmd0aChudWxsYWJsZSlcbiAqIEBwcm9wZXJ0eSB7Ym9vbGVhbn0gZXhwZWN0c1JlcGx5IGlmIHRydWUgcmVwbHkgYSBhY2sgbWVzc2FnZVxuICogQHByb3BlcnR5IHtudW1iZXJ9IGNvbnZlcnNhdGlvbkluZGV4ICByYXcgZGF0YSArMSBpbmRpY2F0ZSBhIHJlcGx5IG1lc3NhZ2VcbiAqIEBwcm9wZXJ0eSB7bnVtYmVyfSBmbGFncyBtZXNzYWdlIHN0YXR1c1xuICovXG5cbmNsYXNzIERUWE1lc3NhZ2VIZWFkZXIge1xuICAvKipcbiAgICogQHBhcmFtIHtEVFhNZXNzYWdlT3B0aW9uc30gZGF0YVxuICAgKiBAcmV0dXJucyB7QnVmZmVyfSBEVFhNZXNzYWdlSGVhZGVyQnVmZmVyXG4gICAqL1xuICBzdGF0aWMgYnVpbGQgKGRhdGEpIHtcbiAgICBjb25zdCBtZXNzYWdlSGVhZGVyID0gQnVmZmVyLmFsbG9jKERUWF9NRVNTQUdFX0hFQURFUl9MRU5HVEgpO1xuICAgIG1lc3NhZ2VIZWFkZXIud3JpdGVVSW50MzJMRShEVFhfTUVTU0FHRV9IRUFERVJfTUFHSUMsIDApO1xuICAgIG1lc3NhZ2VIZWFkZXIud3JpdGVVSW50MzJMRShEVFhfTUVTU0FHRV9IRUFERVJfTEVOR1RILCA0KTtcbiAgICBtZXNzYWdlSGVhZGVyLndyaXRlVUludDE2TEUoMCwgOCk7XG4gICAgbWVzc2FnZUhlYWRlci53cml0ZVVJbnQxNkxFKDEsIDEwKTtcbiAgICBtZXNzYWdlSGVhZGVyLndyaXRlVUludDMyTEUoZGF0YS5wYXlsb2FkTGVuZ3RoLCAxMik7XG4gICAgbWVzc2FnZUhlYWRlci53cml0ZVVJbnQzMkxFKGRhdGEuaWRlbnRpZmllciwgMTYpO1xuICAgIG1lc3NhZ2VIZWFkZXIud3JpdGVVSW50MzJMRShkYXRhLmNvbnZlcnNhdGlvbkluZGV4LCAyMCk7XG4gICAgbWVzc2FnZUhlYWRlci53cml0ZVVJbnQzMkxFKGRhdGEuY2hhbm5lbENvZGUsIDI0KTtcbiAgICBtZXNzYWdlSGVhZGVyLndyaXRlVUludDMyTEUoZGF0YS5leHBlY3RzUmVwbHksIDI4KTtcbiAgICByZXR1cm4gbWVzc2FnZUhlYWRlcjtcbiAgfVxuXG4gIC8qKlxuICAgKiBAcGFyYW0gaGVhZGVyQnVmZmVyIERUWE1lc3NhZ2VIZWFkZXJCdWZmZXJcbiAgICogQHJldHVybnMge09iamVjdH1cbiAgICovXG4gIHN0YXRpYyBwYXJzZSAoaGVhZGVyQnVmZmVyKSB7XG4gICAgcmV0dXJuIHtcbiAgICAgIG1hZ2ljOiBoZWFkZXJCdWZmZXIucmVhZFVJbnQzMkxFKDApLFxuICAgICAgaGVhZGVyTGVuZ3RoOiBoZWFkZXJCdWZmZXIucmVhZFVJbnQzMkxFKDQpLFxuICAgICAgZnJhZ21lbnRJZDogaGVhZGVyQnVmZmVyLnJlYWRVSW50MTZMRSg4KSxcbiAgICAgIGZyYWdtZW50Q291bnQ6IGhlYWRlckJ1ZmZlci5yZWFkVUludDE2TEUoMTApLFxuICAgICAgcGF5bG9hZExlbmd0aDogaGVhZGVyQnVmZmVyLnJlYWRVSW50MzJMRSgxMiksXG4gICAgICBpZGVudGlmaWVyOiBoZWFkZXJCdWZmZXIucmVhZFVJbnQzMkxFKDE2KSxcbiAgICAgIGNvbnZlcnNhdGlvbkluZGV4OiBoZWFkZXJCdWZmZXIucmVhZFVJbnQzMkxFKDIwKSxcbiAgICAgIGNoYW5uZWw6IGhlYWRlckJ1ZmZlci5yZWFkVUludDMyTEUoMjQpLFxuICAgICAgZXhwZWN0c1JlcGx5OiBoZWFkZXJCdWZmZXIucmVhZFVJbnQzMkxFKDI4KSxcbiAgICB9O1xuICB9XG59XG5cbi8qKlxuICogRFRYTWVzc2FnZVBheWxvYWRIZWFkZXIgbGVuZ3RoIDE2XG4gKiBzdHJ1Y3QgRFRYTWVzc2FnZUhlYWRlciB7XG4gKiAgICAgdTMyIGZsYWdzIEZMQUdfVFlQRVNcbiAqICAgICB1MzIgYXV4TGVuZ3RoXG4gKiAgICAgdTY0IHRvdGFsTGVuZ3RoXG4gKiAgICAgfVxuICovXG5cbi8qKlxuICogQHR5cGVkZWYge09iamVjdH0gRFRYTWVzc2FnZVBheWxvYWRIZWFkZXJPYmplY3RcbiAqIEBwcm9wZXJ0eSB7bnVtYmVyfSBmbGFncyBtZXNzYWdlIHN0YXR1c1xuICogQHByb3BlcnR5IHtudW1iZXJ9IGF1eExlbmd0aCBEVFhNZXNzYWdlQXV4QnVmZmVyLmxlbmd0aChudWxsYWJsZSlcbiAqIEBwcm9wZXJ0eSB7YmlnaW50fSB0b3RhbExlbmd0aCBEVFhNZXNzYWdlQXV4QnVmZmVyLmxlbmd0aChudWxsYWJsZSkgKyBzZWxlY3RvckJ1ZmZlci5sZW5ndGhcbiAqL1xuY2xhc3MgRFRYTWVzc2FnZVBheWxvYWRIZWFkZXIge1xuICAvKipcbiAgICogQHBhcmFtIGRhdGEge0RUWE1lc3NhZ2VQYXlsb2FkSGVhZGVyT2JqZWN0fVxuICAgKiBAcmV0dXJucyB7QnVmZmVyfSBEVFhNZXNzYWdlUGF5bG9hZEhlYWRlckJ1ZmZlclxuICAgKi9cbiAgc3RhdGljIGJ1aWxkIChkYXRhKSB7XG4gICAgY29uc3QgbWVzc2FnZUhlYWRlciA9IEJ1ZmZlci5hbGxvYyhEVFhfTUVTU0FHRV9QQVlMT0FEX0hFQURFUl9MRU5HVEgpO1xuICAgIG1lc3NhZ2VIZWFkZXIud3JpdGVVSW50MzJMRShkYXRhLmZsYWdzLCAwKTtcbiAgICBtZXNzYWdlSGVhZGVyLndyaXRlVUludDMyTEUoZGF0YS5hdXhMZW5ndGgsIDQpO1xuICAgIG1lc3NhZ2VIZWFkZXIud3JpdGVCaWdVSW50NjRMRShkYXRhLnRvdGFsTGVuZ3RoLCA4KTtcbiAgICByZXR1cm4gbWVzc2FnZUhlYWRlcjtcbiAgfVxuXG4gIC8qKlxuICAgKiBAcGFyYW0gaGVhZGVyQnVmZmVyXG4gICAqIEByZXR1cm5zIHtEVFhNZXNzYWdlUGF5bG9hZEhlYWRlck9iamVjdH1cbiAgICovXG4gIHN0YXRpYyBwYXJzZSAoaGVhZGVyQnVmZmVyKSB7XG4gICAgcmV0dXJuIHtcbiAgICAgIGZsYWdzOiBoZWFkZXJCdWZmZXIucmVhZFVJbnQzMkxFKDApLFxuICAgICAgYXV4TGVuZ3RoOiBoZWFkZXJCdWZmZXIucmVhZFVJbnQzMkxFKDQpLFxuICAgICAgdG90YWxMZW5ndGg6IGhlYWRlckJ1ZmZlci5yZWFkQmlnSW50NjRMRSg4KVxuICAgIH07XG4gIH1cbn1cblxuXG5jbGFzcyBEVFhNZXNzYWdlQXV4IHtcbiAgY29uc3RydWN0b3IgKGRhdGEgPSBbXSkge1xuICAgIHRoaXMuZGF0YSA9IGRhdGE7XG4gIH1cblxuICAvKipcbiAgICogSlMgQXJyYXkgdG8gQXBwbGUgTlNLZXllZCBCdWZmZXJcbiAgICogQHJldHVybnMge0J1ZmZlcn1cbiAgICovXG4gIGJ1aWxkICgpIHtcbiAgICBjb25zdCBtZXNzYWdlQXV4ID0gbmV3IERUWE1lc3NhZ2VBdXhCdWZmZXIoKTtcbiAgICBsZXQgYnVmID0gQnVmZmVyLmFsbG9jKDApO1xuICAgIGlmICh0aGlzLmRhdGEubGVuZ3RoID09PSAwKSB7XG4gICAgICByZXR1cm4gYnVmO1xuICAgIH1cbiAgICBmb3IgKGNvbnN0IGFyZyBvZiB0aGlzLmRhdGEpIHtcbiAgICAgIGlmIChhcmcgaW5zdGFuY2VvZiBEVFhNZXNzYWdlQXV4QnVmZmVyKSB7XG4gICAgICAgIGJ1ZiA9IEJ1ZmZlci5jb25jYXQoW2J1ZiwgYXJnLmdldEJ5dGVzKCldKTtcbiAgICAgIH0gZWxzZSBpZiAoXy5pc051bWJlcihhcmcpKSB7XG4gICAgICAgIG1lc3NhZ2VBdXguYXBwZW5kSW50KGFyZyk7XG4gICAgICB9IGVsc2UgaWYgKHR5cGVvZiBhcmcgPT0gJ2JpZ2ludCcpIHtcbiAgICAgICAgbWVzc2FnZUF1eC5hcHBlbmRMb25nKGFyZyk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBtZXNzYWdlQXV4LmFwcGVuZE9iamVjdChhcmcpO1xuICAgICAgfVxuICAgIH1cbiAgICByZXR1cm4gQnVmZmVyLmNvbmNhdChbYnVmLCBtZXNzYWdlQXV4LmdldEJ5dGVzKCldKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBQYXJzZXMgbnNrZXllZCBCdWZmZXIgaW50byBqcyBhcnJheVxuICAgKiBAcGFyYW0ge0J1ZmZlcn0gaGVhZGVyQnVmZmVyXG4gICAqIEBwYXJhbSB7RFRYTWVzc2FnZVBheWxvYWRIZWFkZXJPYmplY3R9IHBheWxvYWRIZWFkZXJcbiAgICogQHJldHVybnMge0FycmF5fVxuICAgKi9cbiAgc3RhdGljIHBhcnNlIChoZWFkZXJCdWZmZXIsIHBheWxvYWRIZWFkZXIpIHtcbiAgICBsZXQgY3Vyc29yID0gMDtcbiAgICBjb25zdCBkYXRhID0gW107XG4gICAgY29uc3QgbGVuZ3RoID0gaGVhZGVyQnVmZmVyLnJlYWRCaWdJbnQ2NExFKDgpO1xuICAgIGN1cnNvciArPSAxNjtcbiAgICB3aGlsZSAoY3Vyc29yIDw9IGxlbmd0aCkge1xuICAgICAgaWYgKHBheWxvYWRIZWFkZXIuZmxhZ3MgIT09IEZMQUdfVFlQRVMucHVzaCkge1xuICAgICAgICBjb25zdCBtID0gaGVhZGVyQnVmZmVyLnJlYWRVSW50MzJMRShjdXJzb3IpO1xuICAgICAgICBjdXJzb3IgKz0gNDtcbiAgICAgICAgaWYgKG0gIT09IERUWF9BVVhJTElBUllfTUFHSUMpIHtcbiAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoYGluY29ycmVjdCBhdXhpbGlhcnkgbWFnaWM6ICR7bX1gKTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgICAgY29uc3QgdHlwZSA9IGhlYWRlckJ1ZmZlci5yZWFkVUludDMyTEUoY3Vyc29yKTtcbiAgICAgIGN1cnNvciArPSA0O1xuICAgICAgc3dpdGNoICh0eXBlKSB7XG4gICAgICAgIGNhc2UgQVVYX1RZUEVTLlRleHQ6IHtcbiAgICAgICAgICBjb25zdCBzdHJMZW4gPSBoZWFkZXJCdWZmZXIucmVhZFVJbnQzMkxFKGN1cnNvcik7XG4gICAgICAgICAgY3Vyc29yICs9IDQ7XG4gICAgICAgICAgZGF0YS5wdXNoKGhlYWRlckJ1ZmZlci5zbGljZShjdXJzb3IsIGN1cnNvciArIHN0ckxlbikpO1xuICAgICAgICAgIGN1cnNvciArPSBzdHJMZW47XG4gICAgICAgICAgYnJlYWs7XG4gICAgICAgIH1cbiAgICAgICAgY2FzZSBBVVhfVFlQRVMuTlNLZXllZDoge1xuICAgICAgICAgIGNvbnN0IHN0ckxlbiA9IGhlYWRlckJ1ZmZlci5yZWFkVUludDMyTEUoY3Vyc29yKTtcbiAgICAgICAgICBjdXJzb3IgKz0gNDtcbiAgICAgICAgICBjb25zdCBhcmNoaXZlZF9kYXRhID0gaGVhZGVyQnVmZmVyLnNsaWNlKGN1cnNvciwgY3Vyc29yICsgc3RyTGVuKTtcbiAgICAgICAgICBkYXRhLnB1c2godW5hcmNoaXZlKGFyY2hpdmVkX2RhdGEpKTtcbiAgICAgICAgICBjdXJzb3IgKz0gc3RyTGVuO1xuICAgICAgICAgIGJyZWFrO1xuICAgICAgICB9XG4gICAgICAgIGNhc2UgQVVYX1RZUEVTLlVJbnQzMkxFOlxuICAgICAgICAgIGRhdGEucHVzaChoZWFkZXJCdWZmZXIucmVhZFVJbnQzMkxFKGN1cnNvcikpO1xuICAgICAgICAgIGN1cnNvciArPSA0O1xuICAgICAgICAgIGJyZWFrO1xuICAgICAgICBjYXNlIEFVWF9UWVBFUy5CaWdVSW50NjRMRTpcbiAgICAgICAgICBkYXRhLnB1c2goaGVhZGVyQnVmZmVyLnJlYWRCaWdVSW50NjRMRShjdXJzb3IpKTtcbiAgICAgICAgICBjdXJzb3IgKz0gODtcbiAgICAgICAgICBicmVhaztcbiAgICAgICAgY2FzZSBBVVhfVFlQRVMuQmlnSW50NjRMRTpcbiAgICAgICAgICBkYXRhLnB1c2goaGVhZGVyQnVmZmVyLnJlYWRCaWdJbnQ2NExFKGN1cnNvcikpO1xuICAgICAgICAgIGN1cnNvciArPSA4O1xuICAgICAgICAgIGJyZWFrO1xuICAgICAgICBkZWZhdWx0OlxuICAgICAgICAgIHRocm93IG5ldyBFcnJvcihgVW5rbm93biB0eXBlICR7dHlwZX1gKTtcbiAgICAgIH1cbiAgICB9XG4gICAgcmV0dXJuIGRhdGE7XG4gIH1cbn1cblxuY2xhc3MgSW5zdHJ1bWVudFJQQ1BhcnNlRXJyb3Ige1xuICBjb25zdHJ1Y3RvciAoZGF0YSkge1xuICAgIHRoaXMuZGF0YSA9IGRhdGE7XG4gIH1cbn1cblxuY2xhc3MgRFRYTWVzc2FnZUF1eEJ1ZmZlciB7XG4gIGNvbnN0cnVjdG9yICgpIHtcbiAgICB0aGlzLl9idWYgPSBCdWZmZXIuYWxsb2MoMCk7XG4gIH1cblxuICAvKipcbiAgICogQHBhcmFtIHtudW1iZXJ9IHZhbHVlXG4gICAqL1xuICBhcHBlbmRJbnQgKHZhbHVlKSB7XG4gICAgY29uc3QgYnVmID0gQnVmZmVyLmFsbG9jKDEyKTtcbiAgICBidWYud3JpdGVVSW50MzJMRShEVFhfQVVYSUxJQVJZX01BR0lDLCAwKTtcbiAgICBidWYud3JpdGVVSW50MzJMRSgzLCA0KTtcbiAgICBidWYud3JpdGVVSW50MzJMRSh2YWx1ZSwgOCk7XG4gICAgdGhpcy5fYnVmID0gQnVmZmVyLmNvbmNhdChbdGhpcy5fYnVmLCBidWZdKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBAcGFyYW0ge2JpZ2ludH0gdmFsdWVcbiAgICovXG4gIGFwcGVuZExvbmcgKHZhbHVlKSB7XG4gICAgY29uc3QgYnVmID0gQnVmZmVyLmFsbG9jKDE2KTtcbiAgICBidWYud3JpdGVVSW50MzJMRShEVFhfQVVYSUxJQVJZX01BR0lDLCAwKTtcbiAgICBidWYud3JpdGVVSW50MzJMRSg0LCA0KTtcbiAgICBidWYud3JpdGVCaWdVSW50NjRMRSh2YWx1ZSwgOCk7XG4gICAgdGhpcy5fYnVmID0gQnVmZmVyLmNvbmNhdChbdGhpcy5fYnVmLCBidWZdKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBAcGFyYW0ge251bWJlcn0gdmFsdWVcbiAgICovXG4gIGFwcGVuZFNpZ25lZEludCAodmFsdWUpIHtcbiAgICBjb25zdCBidWYgPSBCdWZmZXIuYWxsb2MoMTIpO1xuICAgIGJ1Zi53cml0ZVVJbnQzMkxFKERUWF9BVVhJTElBUllfTUFHSUMsIDApO1xuICAgIGJ1Zi53cml0ZVVJbnQzMkxFKDMsIDQpO1xuICAgIGJ1Zi53cml0ZUludDMyTEUodmFsdWUsIDgpO1xuICAgIHRoaXMuX2J1ZiA9IEJ1ZmZlci5jb25jYXQoW3RoaXMuX2J1ZiwgYnVmXSk7XG4gIH1cblxuICAvKipcbiAgICogQHBhcmFtIHtiaWdpbnR9IHZhbHVlXG4gICAqL1xuICBhcHBlbmRTaWduZWRMb25nICh2YWx1ZSkge1xuICAgIGNvbnN0IGJ1ZiA9IEJ1ZmZlci5hbGxvYygxNik7XG4gICAgYnVmLndyaXRlVUludDMyTEUoRFRYX0FVWElMSUFSWV9NQUdJQywgMCk7XG4gICAgYnVmLndyaXRlVUludDMyTEUoNiwgNCk7XG4gICAgYnVmLndyaXRlQmlnSW50NjRMRSh2YWx1ZSwgOCk7XG4gICAgdGhpcy5fYnVmID0gQnVmZmVyLmNvbmNhdChbdGhpcy5fYnVmLCBidWZdKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBAcGFyYW0ge09iamVjdH0gdmFsdWVcbiAgICovXG4gIGFwcGVuZE9iamVjdCAodmFsdWUpIHtcbiAgICBjb25zdCBidWYgPSBhcmNoaXZlKHZhbHVlKTtcbiAgICBjb25zdCBidWYyID0gQnVmZmVyLmFsbG9jKDEyKTtcbiAgICBidWYyLndyaXRlVUludDMyTEUoRFRYX0FVWElMSUFSWV9NQUdJQywgMCk7XG4gICAgYnVmMi53cml0ZVVJbnQzMkxFKDIsIDQpO1xuICAgIGJ1ZjIud3JpdGVVSW50MzJMRShidWYubGVuZ3RoLCA4KTtcbiAgICB0aGlzLl9idWYgPSBCdWZmZXIuY29uY2F0KFt0aGlzLl9idWYsIGJ1ZjIsIGJ1Zl0pO1xuICB9XG5cbiAgZ2V0Qnl0ZXMgKCkge1xuICAgIGNvbnN0IG91dCA9IEJ1ZmZlci5hbGxvYygxNik7XG4gICAgb3V0LndyaXRlVUludDMyTEUoRFRYX01FU1NBR0VfQVVYX0hFQURFUiwgMCk7XG4gICAgb3V0LndyaXRlVUludDMyTEUodGhpcy5fYnVmLmxlbmd0aCwgOCk7XG4gICAgcmV0dXJuIEJ1ZmZlci5jb25jYXQoW291dCwgdGhpcy5fYnVmXSk7XG4gIH1cbn1cblxuXG5cbmNsYXNzIERUWE1lc3NhZ2Uge1xuICAvKipcbiAgICogQHBhcmFtIHtEVFhNZXNzYWdlT3B0aW9uc30gb3B0c1xuICAgKi9cbiAgY29uc3RydWN0b3IgKG9wdHMgPSB7fSkge1xuICAgIGNvbnN0IHtcbiAgICAgIGlkZW50aWZpZXIsXG4gICAgICBjaGFubmVsQ29kZSxcbiAgICAgIHNlbGVjdG9yLFxuICAgICAgZXhwZWN0c1JlcGx5LFxuICAgICAgY29udmVyc2F0aW9uSW5kZXggPSAwLFxuICAgICAgZmxhZ3MgPSBGTEFHX1RZUEVTLnNlbmRcbiAgICB9ID0gb3B0cztcbiAgICB0aGlzLl9tZXNzYWdlSGVhZGVyID0gdW5kZWZpbmVkO1xuICAgIHRoaXMuX3BheWxvYWRIZWFkZXIgPSB1bmRlZmluZWQ7XG4gICAgdGhpcy5faWRlbnRpZmllciA9IGlkZW50aWZpZXI7XG4gICAgdGhpcy5fY2hhbm5lbENvZGUgPSBjaGFubmVsQ29kZTtcbiAgICB0aGlzLl9leHBlY3RzUmVwbHkgPSBleHBlY3RzUmVwbHk7XG4gICAgdGhpcy5fc2VsZWN0b3IgPSBzZWxlY3RvcjtcbiAgICB0aGlzLl9jb252ZXJzYXRpb25JbmRleCA9IGNvbnZlcnNhdGlvbkluZGV4O1xuICAgIHRoaXMuX2ZsYWdzID0gZmxhZ3M7XG4gICAgdGhpcy5hdXhpbGlhcmllcyA9IG5ldyBEVFhNZXNzYWdlQXV4KCk7XG4gIH1cblxuICAvKipcbiAgICogZ2V0IERUWE1lc3NhZ2VIZWFkZXIgaWRlbnRpZmllci4gUGFja2V0IHRyYW5zbWlzc2lvbiBzZXF1ZW5jZVxuICAgKiBAcmV0dXJucyB7bnVtYmVyfVxuICAgKi9cbiAgZ2V0IGlkZW50aWZpZXIgKCkge1xuICAgIHJldHVybiB0aGlzLl9tZXNzYWdlSGVhZGVyPy5pZGVudGlmaWVyO1xuICB9XG5cbiAgLyoqXG4gICAqIGdldCBEVFhNZXNzYWdlSGVhZGVyIGNoYW5uZWxDb2RlLlxuICAgKiBQYWNrZXQgdHJhbnNtaXNzaW9uIGNoYW5uZWxDb2RlLiBVc2UgdGhpcyB2YWx1ZSB0byBkaXN0aW5ndWlzaCB3aGVuIHRoZXJlIGFyZSBtdWx0aXBsZSBjaGFubmVsc1xuICAgKiBjYWxsIHRoaXMgbWV0aG9kIGBJbnN0cnVtZW50U2VydmljZS5yZWdpc3RlckNoYW5uZWxDYWxsYmFja2AgZ2V0IHRoZSBjaGFubmVsIG1lc3NhZ2VcbiAgICogQHJldHVybnMge251bWJlcn1cbiAgICovXG4gIGdldCBjaGFubmVsQ29kZSAoKSB7XG4gICAgcmV0dXJuIHRoaXMuX21lc3NhZ2VIZWFkZXI/LmNoYW5uZWw7XG4gIH1cblxuICAvKipcbiAgICogZ2V0IERUWE1lc3NhZ2VIZWFkZXIgZXhwZWN0c1JlcGx5LiBXaGV0aGVyIHRvIG5lZWQgYWNrIG1lc3NhZ2VcbiAgICogaWYgZXhwZWN0c1JlcGx5IGlzIHRydWUgbXVzdCByZXBseSBhY2sgbWVzc2FnZVxuICAgKiBAcmV0dXJucyB7Ym9vbGVhbn1cbiAgICovXG4gIGdldCBleHBlY3RzUmVwbHkgKCkge1xuICAgIHJldHVybiB0aGlzLl9tZXNzYWdlSGVhZGVyPy5leHBlY3RzUmVwbHk7XG4gIH1cblxuICAvKipcbiAgICogY2FsbCB0aGlzIG1ldGhvZCBgSW5zdHJ1bWVudFNlcnZpY2UucmVnaXN0ZXJTZWxlY3RvckNhbGxiYWNrYCBnZXQgdGhlIHNlbGVjdG9yIG1lc3NhZ2VcbiAgICogQHJldHVybnMgeyp9IFVua25vd24gZGF0YVxuICAgKi9cbiAgZ2V0IHNlbGVjdG9yICgpIHtcbiAgICByZXR1cm4gdGhpcy5fc2VsZWN0b3I7XG4gIH1cblxuICAvKipcbiAgICogQHBhcmFtIGRhdGFcbiAgICovXG4gIHNldCBzZWxlY3RvciAoZGF0YSkge1xuICAgIHRoaXMuX3NlbGVjdG9yID0gZGF0YTtcbiAgfVxuXG4gIC8qKlxuICAgKiBnZXQgRFRYTWVzc2FnZUhlYWRlciBjb252ZXJzYXRpb25JbmRleFxuICAgKiBAcmV0dXJucyB7bnVtYmVyfVxuICAgKi9cbiAgZ2V0IGNvbnZlcnNhdGlvbkluZGV4ICgpIHtcbiAgICByZXR1cm4gdGhpcy5fbWVzc2FnZUhlYWRlcj8uY29udmVyc2F0aW9uSW5kZXg7XG4gIH1cblxuICAvKipcbiAgICogRFRYTWVzc2FnZSBCdWZmZXI6IERUWE1lc3NhZ2VIZWFkZXIgKyBQYXlsb2FkSGVhZGVyICsgRFRYTWVzc2FnZUF1eEJ1ZmZlcihudWxsYWJsZSkgKyBzZWxlY3RvcihudWxsYWJsZSlcbiAgICogQHJldHVybnMge0J1ZmZlcn1cbiAgICovXG4gIGJ1aWxkICgpIHtcbiAgICBjb25zdCBzZWwgPSB0aGlzLl9zZWxlY3RvciA/IGFyY2hpdmUodGhpcy5fc2VsZWN0b3IpIDogQnVmZmVyLmFsbG9jKDApO1xuICAgIGNvbnN0IGF1eCA9IHRoaXMuYXV4aWxpYXJpZXMuYnVpbGQoKTtcbiAgICBjb25zdCBwYXlsb2FkSGVhZGVyID0gRFRYTWVzc2FnZVBheWxvYWRIZWFkZXIuYnVpbGQoe1xuICAgICAgZmxhZ3M6IHRoaXMuX2ZsYWdzLFxuICAgICAgYXV4TGVuZ3RoOiBhdXgubGVuZ3RoLFxuICAgICAgLy8gbmVlZCB0byBjb252ZXJ0IHRvIGJpZ2ludCBpbiBhbnkgY2FzZVxuICAgICAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIG5vLXVuZGVmXG4gICAgICB0b3RhbExlbmd0aDogQmlnSW50KGF1eC5sZW5ndGggKyBzZWwubGVuZ3RoKSxcbiAgICB9KTtcblxuICAgIGNvbnN0IG1lc3NhZ2VIZWFkZXIgPSBEVFhNZXNzYWdlSGVhZGVyLmJ1aWxkKHtcbiAgICAgIHBheWxvYWRMZW5ndGg6IERUWF9NRVNTQUdFX1BBWUxPQURfSEVBREVSX0xFTkdUSCArIGF1eC5sZW5ndGggKyBzZWwubGVuZ3RoLFxuICAgICAgaWRlbnRpZmllcjogdGhpcy5faWRlbnRpZmllcixcbiAgICAgIGNvbnZlcnNhdGlvbkluZGV4OiB0aGlzLl9jb252ZXJzYXRpb25JbmRleCxcbiAgICAgIGNoYW5uZWxDb2RlOiB0aGlzLl9jaGFubmVsQ29kZSxcbiAgICAgIGV4cGVjdHNSZXBseTogdGhpcy5fZXhwZWN0c1JlcGx5XG4gICAgfSk7XG4gICAgcmV0dXJuIEJ1ZmZlci5jb25jYXQoW21lc3NhZ2VIZWFkZXIsIHBheWxvYWRIZWFkZXIsIGF1eCwgc2VsXSk7XG4gIH1cblxuICAvKipcbiAgICogUGFyc2VzIERUWCBidWZmZXIgaW50byBhbiBqcyBvYmplY3QuIFJldHVybmVkIGluIERUWERlY29kZXIgU3RyZWFtLlRyYW5zZm9ybVxuICAgKiBAcGFyYW0ge0J1ZmZlcn0gaGVhZGVyQnVmICBEVFhNZXNzYWdlSGVhZGVyIGJ1ZmZlclxuICAgKiBAcGFyYW0ge0J1ZmZlcn0gcGF5bG9hZEJ1ZiAgUGF5bG9hZEhlYWRlckJ1ZmZlciArIERUWE1lc3NhZ2VBdXhCdWZmZXIobnVsbGFibGUpICsgc2VsZWN0b3JCdWZmZXIobnVsbGFibGUpXG4gICAqIEByZXR1cm5zIHtEVFhNZXNzYWdlfVxuICAgKi9cbiAgc3RhdGljIHBhcnNlIChoZWFkZXJCdWYsIHBheWxvYWRCdWYpIHtcbiAgICBsZXQgY3Vyc29yID0gMDtcbiAgICBjb25zdCByZXQgPSBuZXcgRFRYTWVzc2FnZSgpO1xuICAgIHJldC5fbWVzc2FnZUhlYWRlciA9IERUWE1lc3NhZ2VIZWFkZXIucGFyc2UoaGVhZGVyQnVmKTtcbiAgICBpZiAocmV0Ll9tZXNzYWdlSGVhZGVyLnBheWxvYWRMZW5ndGggPT09IDApIHtcbiAgICAgIHJldHVybiByZXQ7XG4gICAgfVxuICAgIHJldC5fcGF5bG9hZEhlYWRlciA9IERUWE1lc3NhZ2VQYXlsb2FkSGVhZGVyLnBhcnNlKHBheWxvYWRCdWYuc2xpY2UoY3Vyc29yLCBEVFhfTUVTU0FHRV9QQVlMT0FEX0hFQURFUl9MRU5HVEgpKTtcbiAgICBjdXJzb3IgKz0gRFRYX01FU1NBR0VfUEFZTE9BRF9IRUFERVJfTEVOR1RIO1xuICAgIC8vIHRvdGFsTGVuZ3RoIGlzIGJpZ2ludCB1c2UgMG5cbiAgICBpZiAocmV0Ll9wYXlsb2FkSGVhZGVyLnRvdGFsTGVuZ3RoID09PSAwbikge1xuICAgICAgcmV0dXJuIHJldDtcbiAgICB9XG4gICAgaWYgKHJldC5fcGF5bG9hZEhlYWRlci5hdXhMZW5ndGggPiAwKSB7XG4gICAgICByZXQuYXV4aWxpYXJpZXMgPSBEVFhNZXNzYWdlQXV4LnBhcnNlKHBheWxvYWRCdWYuc2xpY2UoY3Vyc29yLCBjdXJzb3IgKyByZXQuX3BheWxvYWRIZWFkZXIuYXV4TGVuZ3RoKSwgcmV0Ll9wYXlsb2FkSGVhZGVyKTtcbiAgICAgIGN1cnNvciArPSByZXQuX3BheWxvYWRIZWFkZXIuYXV4TGVuZ3RoO1xuICAgIH1cblxuICAgIGNvbnN0IGRhdGEgPSBwYXlsb2FkQnVmLnNsaWNlKGN1cnNvciwgY3Vyc29yICsgcGF5bG9hZEJ1Zi5sZW5ndGgpO1xuICAgIHJldC5zZWxlY3RvciA9IGRhdGE7XG4gICAgaWYgKGRhdGEubGVuZ3RoID4gMCkge1xuICAgICAgZm9yIChjb25zdCBmdW4gb2YgW3VuYXJjaGl2ZSwgcGxpc3RsaWIucGFyc2VCdWZmZXJdKSB7XG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgcmV0LnNlbGVjdG9yID0gZnVuKGRhdGEpO1xuICAgICAgICAgIGJyZWFrO1xuICAgICAgICB9IGNhdGNoIChlKSB7XG4gICAgICAgICAgcmV0LnNlbGVjdG9yID0gbmV3IEluc3RydW1lbnRSUENQYXJzZUVycm9yKGRhdGEpO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfVxuICAgIHJldHVybiByZXQ7XG4gIH1cbn1cblxuZXhwb3J0IHsgRFRYTWVzc2FnZUhlYWRlciwgRFRYTWVzc2FnZVBheWxvYWRIZWFkZXIsIERUWE1lc3NhZ2VBdXhCdWZmZXIsIERUWE1lc3NhZ2VBdXgsIERUWE1lc3NhZ2UsXG4gIERUWF9NRVNTQUdFX1BBWUxPQURfSEVBREVSX0xFTkdUSCwgRFRYX01FU1NBR0VfSEVBREVSX0xFTkdUSCwgRFRYX01FU1NBR0VfSEVBREVSX01BR0lDLCBEVFhfTUVTU0FHRV9IRUFERVJfTUFHSUNfTEVOLFxuICBGTEFHX1RZUEVTfTtcbiJdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7QUFBQTs7QUFDQTs7QUFDQTs7QUFFQSxNQUFNQSxpQ0FBaUMsR0FBRyxFQUExQzs7QUFDQSxNQUFN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