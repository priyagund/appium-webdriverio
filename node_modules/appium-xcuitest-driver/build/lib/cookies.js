"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.createJSCookie = createJSCookie;
exports.createJWPCookie = createJWPCookie;
exports.default = void 0;
exports.expireCookie = expireCookie;
exports.getValue = getValue;

require("source-map-support/register");

var _lodash = _interopRequireDefault(require("lodash"));

var _support = require("appium/support");

const log = _support.logger.getLogger('Cookie');

function convertCookie(value, converter) {
  if (value.indexOf('"') === 0) {
    value = value.slice(1, -1).replace(/\\"/g, '"').replace(/\\\\/g, '\\');
  }

  let parsedValue;

  try {
    parsedValue = decodeURIComponent(value.replace(/\+/g, ' '));
  } catch (e) {
    log.warn(e);
  }

  return converter ? converter(parsedValue) : parsedValue;
}

function createJSCookie(key, value, options = {}) {
  return [encodeURIComponent(key), '=', value, options.expires ? `; expires=${options.expires}` : '', options.path ? `; path=${options.path}` : '', options.domain ? `; domain=${options.domain}` : '', options.secure ? '; secure' : ''].join('');
}

function createJWPCookie(key, cookieString, converter = null) {
  let result = {};
  let cookies = cookieString ? cookieString.split('; ') : [];

  for (let cookie of cookies) {
    let parts = cookie.split('=');
    let name = decodeURIComponent(parts.shift());
    let val = parts[0];

    if (key && key === name) {
      result.name = key;
      result.value = convertCookie(val, converter);
    } else {
      result[name] = convertCookie(val, converter);
    }
  }

  return result;
}

function getValue(key, cookieString, converter = null) {
  let result = createJWPCookie(key, cookieString, converter);
  return _lodash.default.isUndefined(key) ? result : result.value;
}

function expireCookie(key, options) {
  return createJSCookie(key, '', _lodash.default.assign({}, options, {
    expires: 'Thu, 01 Jan 1970 00:00:00 GMT'
  }));
}

var _default = {
  createJSCookie,
  createJWPCookie,
  getValue,
  expireCookie
};
exports.default = _default;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJsb2ciLCJsb2dnZXIiLCJnZXRMb2dnZXIiLCJjb252ZXJ0Q29va2llIiwidmFsdWUiLCJjb252ZXJ0ZXIiLCJpbmRleE9mIiwic2xpY2UiLCJyZXBsYWNlIiwicGFyc2VkVmFsdWUiLCJkZWNvZGVVUklDb21wb25lbnQiLCJlIiwid2FybiIsImNyZWF0ZUpTQ29va2llIiwia2V5Iiwib3B0aW9ucyIsImVuY29kZVVSSUNvbXBvbmVudCIsImV4cGlyZXMiLCJwYXRoIiwiZG9tYWluIiwic2VjdXJlIiwiam9pbiIsImNyZWF0ZUpXUENvb2tpZSIsImNvb2tpZVN0cmluZyIsInJlc3VsdCIsImNvb2tpZXMiLCJzcGxpdCIsImNvb2tpZSIsInBhcnRzIiwibmFtZSIsInNoaWZ0IiwidmFsIiwiZ2V0VmFsdWUiLCJfIiwiaXNVbmRlZmluZWQiLCJleHBpcmVDb29raWUiLCJhc3NpZ24iXSwic291cmNlcyI6WyIuLi8uLi9saWIvY29va2llcy5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyIvKlxuICogZGVyaXZlZCBmcm9tIGpRdWVyeSBDb29raWUgUGx1Z2luIHYxLjQuMVxuICogaHR0cHM6Ly9naXRodWIuY29tL2NhcmhhcnRsL2pxdWVyeS1jb29raWVcbiAqL1xuXG4vLyBuZWVkZWQgdG8gY29tbXVuaWNhdGUvdHJhbnNsYXRlIGJldHdlZW4gSlNPTldpcmUgY29va2llcyBhbmQgcmVndWxhciBKYXZhU2NyaXB0IGNvb2tpZXNcblxuaW1wb3J0IF8gZnJvbSAnbG9kYXNoJztcbmltcG9ydCB7IGxvZ2dlciB9IGZyb20gJ2FwcGl1bS9zdXBwb3J0JztcblxuXG5jb25zdCBsb2cgPSBsb2dnZXIuZ2V0TG9nZ2VyKCdDb29raWUnKTtcblxuLy8gcGFyc2VzIHRoZSB2YWx1ZSBpZiBuZWVkZWQgYW5kIGNvbnZlcnRzIHRoZSB2YWx1ZSBpZiBhIGNvbnZlcnRlciBpcyBwcm92aWRlZFxuLy8gaW50ZXJuYWwgZnVuY3Rpb24sIG5vdCBleHBvcnRlZFxuZnVuY3Rpb24gY29udmVydENvb2tpZSAodmFsdWUsIGNvbnZlcnRlcikge1xuICBpZiAodmFsdWUuaW5kZXhPZignXCInKSA9PT0gMCkge1xuICAgIC8vIHRoaXMgaXMgYSBxdW90ZWQgY29va2llZCBhY2NvcmRpbmcgdG8gUkZDMjA2OFxuICAgIC8vIHJlbW92ZSBlbmNsb3NpbmcgcXVvdGVzIGFuZCBpbnRlcm5hbCBxdW90ZXMgYW5kIGJhY2tzbGFzaGVzXG4gICAgdmFsdWUgPSB2YWx1ZS5zbGljZSgxLCAtMSkucmVwbGFjZSgvXFxcXFwiL2csICdcIicpLnJlcGxhY2UoL1xcXFxcXFxcL2csICdcXFxcJyk7XG4gIH1cblxuICBsZXQgcGFyc2VkVmFsdWU7XG4gIHRyeSB7XG4gICAgcGFyc2VkVmFsdWUgPSBkZWNvZGVVUklDb21wb25lbnQodmFsdWUucmVwbGFjZSgvXFwrL2csICcgJykpO1xuICB9IGNhdGNoIChlKSB7XG4gICAgLy8gbm8gbmVlZCB0byBmYWlsIGlmIHdlIGNhbid0IGRlY29kZVxuICAgIGxvZy53YXJuKGUpO1xuICB9XG5cbiAgcmV0dXJuIGNvbnZlcnRlciA/IGNvbnZlcnRlcihwYXJzZWRWYWx1ZSkgOiBwYXJzZWRWYWx1ZTtcbn1cblxuLy8gdGFrZXMgYXJndW1lbnRzIGdpdmVuIGFuZCBjcmVhdGVzIGEgSmF2YVNjcmlwdCBDb29raWVcbmZ1bmN0aW9uIGNyZWF0ZUpTQ29va2llIChrZXksIHZhbHVlLCBvcHRpb25zID0ge30pIHtcbiAgcmV0dXJuIFtcbiAgICBlbmNvZGVVUklDb21wb25lbnQoa2V5KSwgJz0nLCB2YWx1ZSxcbiAgICBvcHRpb25zLmV4cGlyZXNcbiAgICAgID8gYDsgZXhwaXJlcz0ke29wdGlvbnMuZXhwaXJlc31gXG4gICAgICA6ICcnLFxuICAgIG9wdGlvbnMucGF0aFxuICAgICAgPyBgOyBwYXRoPSR7b3B0aW9ucy5wYXRofWBcbiAgICAgIDogJycsXG4gICAgb3B0aW9ucy5kb21haW5cbiAgICAgID8gYDsgZG9tYWluPSR7b3B0aW9ucy5kb21haW59YFxuICAgICAgOiAnJyxcbiAgICBvcHRpb25zLnNlY3VyZVxuICAgICAgPyAnOyBzZWN1cmUnXG4gICAgICA6ICcnXG4gIF0uam9pbignJyk7XG59XG5cbi8vIHRha2VzIHRoZSBKYXZhU2NyaXB0IGNvb2tpZVN0cmluZyBhbmQgdHJhbnNsYXRlcyBpdCBpbnRvIGEgSlNPTldpcmUgZm9ybWF0dGVkIGNvb2tpZVxuZnVuY3Rpb24gY3JlYXRlSldQQ29va2llIChrZXksIGNvb2tpZVN0cmluZywgY29udmVydGVyID0gbnVsbCkge1xuICBsZXQgcmVzdWx0ID0ge307XG4gIGxldCBjb29raWVzID0gY29va2llU3RyaW5nID8gY29va2llU3RyaW5nLnNwbGl0KCc7ICcpIDogW107XG4gIGZvciAobGV0IGNvb2tpZSBvZiBjb29raWVzKSB7XG4gICAgbGV0IHBhcnRzID0gY29va2llLnNwbGl0KCc9Jyk7XG5cbiAgICAvLyBnZXQgdGhlIGZpcnN0IGFuZCBzZWNvbmQgZWxlbWVudCBhcyBuYW1lIGFuZCB2YWx1ZVxuICAgIGxldCBuYW1lID0gZGVjb2RlVVJJQ29tcG9uZW50KHBhcnRzLnNoaWZ0KCkpO1xuICAgIGxldCB2YWwgPSBwYXJ0c1swXTtcblxuICAgIC8vIGlmIG5hbWUgaXMga2V5LCB0aGlzIGlzIHRoZSBjZW50cmFsIGVsZW1lbnQgb2YgdGhlIGNvb2tpZSwgc28gYWRkIGFzIGBuYW1lYFxuICAgIC8vIG90aGVyd2lzZSBpdCBpcyBhbiBvcHRpb25hbCBlbGVtZW50XG4gICAgaWYgKGtleSAmJiBrZXkgPT09IG5hbWUpIHtcbiAgICAgIHJlc3VsdC5uYW1lID0ga2V5O1xuICAgICAgcmVzdWx0LnZhbHVlID0gY29udmVydENvb2tpZSh2YWwsIGNvbnZlcnRlcik7XG4gICAgfSBlbHNlIHtcbiAgICAgIHJlc3VsdFtuYW1lXSA9IGNvbnZlcnRDb29raWUodmFsLCBjb252ZXJ0ZXIpO1xuICAgIH1cbiAgfVxuICByZXR1cm4gcmVzdWx0O1xufVxuXG4vLyB0YWtlcyBhIEphdmFTY3JpcHQgY29va2llc3RyaW5nIGFuZCBwYXJzZXMgaXQgZm9yIHRoZSB2YWx1ZSBnaXZlbiB0aGUga2V5XG5mdW5jdGlvbiBnZXRWYWx1ZSAoa2V5LCBjb29raWVTdHJpbmcsIGNvbnZlcnRlciA9IG51bGwpIHtcbiAgbGV0IHJlc3VsdCA9IGNyZWF0ZUpXUENvb2tpZShrZXksIGNvb2tpZVN0cmluZywgY29udmVydGVyKTtcblxuICAvLyBpZiBga2V5YCBpcyB1bmRlZmluZWQgd2Ugd2FudCB0aGUgZW50aXJlIGNvb2tpZVxuICByZXR1cm4gXy5pc1VuZGVmaW5lZChrZXkpID8gcmVzdWx0IDogcmVzdWx0LnZhbHVlO1xufVxuXG5cbi8vIHJldHVybnMgYSBjb29raWUgdGhhdCBleHBpcmVzIG9uIDAxIEphbiAxOTcwXG4vLyBhc3NpZ24gdGhlIHJldHVybmVkIGNvb2tpZSB0byBhbiBleGlzdGluZyBjb29raWUgdG8gZGVsZXRlIHRoYXQgY29va2llXG5mdW5jdGlvbiBleHBpcmVDb29raWUgKGtleSwgb3B0aW9ucykge1xuICAvLyBvdmVycmlkZSBgZXhwaXJlc2AgaW4gYG9wdGlvbnNgLCBhbmQgdGhlbiBtYWtlIHRoZSBjb29raWVcbiAgcmV0dXJuIGNyZWF0ZUpTQ29va2llKGtleSwgJycsIF8uYXNzaWduKHt9LCBvcHRpb25zLCB7XG4gICAgZXhwaXJlczogJ1RodSwgMDEgSmFuIDE5NzAgMDA6MDA6MDAgR01UJ1xuICB9KSk7XG59XG5cbi8vIGV4cG9ydCBpbmRpdmlkdWFsbHkgYW5kIGFsc28gKGFzIGRlZmF1bHQpIGFzIGFuIG9iamVjdFxuZXhwb3J0IHsgY3JlYXRlSlNDb29raWUsIGNyZWF0ZUpXUENvb2tpZSwgZ2V0VmFsdWUsIGV4cGlyZUNvb2tpZSB9O1xuZXhwb3J0IGRlZmF1bHQgeyBjcmVhdGVKU0Nvb2tpZSwgY3JlYXRlSldQQ29va2llLCBnZXRWYWx1ZSwgZXhwaXJlQ29va2llIH07XG4iXSwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7OztBQU9BOztBQUNBOztBQUdBLE1BQU1BLEdBQUcsR0FBR0MsZUFB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