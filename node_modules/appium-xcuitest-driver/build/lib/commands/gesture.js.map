{"version":3,"file":"gesture.js","names":["SUPPORTED_GESTURE_DIRECTIONS","helpers","extensions","commands","toElementId","opts","element","log","info","el","elementId","util","unwrapElement","toElementOrApplicationId","driver","findNativeElementOrElements","moveTo","xoffset","yoffset","isWebContext","x","y","getLocation","coords","curWebCoords","atomsElement","getAtomsElement","relCoords","executeAtom","_","isNil","curCoords","errors","UnknownException","elPos","requireFloatParameter","paramName","paramValue","methodName","isUndefined","InvalidArgumentError","result","parseFloat","isNaN","requireIntParameter","parseInt","mobileShake","isSimulator","UnknownError","device","shake","click","nativeClick","settings","getSettings","nativeWebTap","nativeWebTapStrict","debug","gesturesChainToString","gestures","keysToInclude","map","item","otherKeys","difference","keys","isArray","intersection","length","action","isPlainObject","JSON","stringify","join","performActions","actions","preprocessedActions","Object","assign","type","parameters","pointerType","modifiedAction","clone","filter","innerAction","duration","proxyCommand","releaseActions","warn","performTouch","e","errorAndThrow","message","performMultiAction","i","endpoint","mobileScrollToElement","mobileScroll","name","direction","predicateString","toVisible","distance","params","includes","toLower","mobileSwipe","velocity","mobilePinch","scale","mobileDoubleTap","mobileTwoFingerTap","mobileTouchAndHold","mobileTap","mobileDragFromToForDuration","fromX","fromY","toX","toY","mobileDragFromToWithVelocity","pressDuration","holdDuration","fromElementId","toElement","mobileTapWithNumberOfTaps","numberOfTaps","numberOfTouches","mobileForcePress","pressure","mobileSelectPickerWheelValue","isString","order","toLowerCase","offset","mobileRotateElement","rotation","getCoordinates","gesture","coordinates","areOffsets","optionX","options","optionY","rect","getElementRect","pos","size","w","width","h","height","offsetX","offsetY","applyMoveToOffset","firstCoordinates","secondCoordinates"],"sources":["../../../lib/commands/gesture.js"],"sourcesContent":["import { errors } from 'appium/driver';\nimport { util } from 'appium/support';\nimport _ from 'lodash';\nimport log from '../logger';\n\nconst SUPPORTED_GESTURE_DIRECTIONS = ['up', 'down', 'left', 'right'];\n\nconst helpers = {}, extensions = {}, commands = {};\n\nfunction toElementId (opts = {}) {\n  if (opts.element) {\n    log.info(`The 'element' argument name is deprecated. Consider using 'elementId' instead`);\n  }\n  const el = opts.elementId || opts.element;\n  return el ? util.unwrapElement(el) : null;\n}\n\nasync function toElementOrApplicationId (driver, opts = {}) {\n  return toElementId(opts)\n    || util.unwrapElement(await driver.findNativeElementOrElements(`class name`, `XCUIElementTypeApplication`, false));\n}\n\ncommands.moveTo = async function moveTo (el, xoffset = 0, yoffset = 0) {\n  el = util.unwrapElement(el);\n\n  if (this.isWebContext()) {\n    let {x, y} = await this.getLocation(el);\n    let coords = {\n      x: x + xoffset,\n      y: y + yoffset\n    };\n    this.curWebCoords = coords;\n    let atomsElement = this.getAtomsElement(el);\n    let relCoords = {x: xoffset, y: yoffset};\n    await this.executeAtom('move_mouse', [atomsElement, relCoords]);\n  } else {\n    if (_.isNil(el)) {\n      if (!this.curCoords) {\n        throw new errors.UnknownException(\n          'Current cursor position unknown, please use moveTo with an element the first time.');\n      }\n      this.curCoords = {\n        x: this.curCoords.x + xoffset,\n        y: this.curCoords.y + yoffset\n      };\n    } else {\n      let elPos = await this.getLocation(el);\n      this.curCoords = {\n        x: elPos.x + xoffset,\n        y: elPos.y + yoffset\n      };\n    }\n  }\n};\n\nfunction requireFloatParameter (paramName, paramValue, methodName) {\n  if (_.isUndefined(paramValue)) {\n    throw new errors.InvalidArgumentError(`\"${paramName}\" parameter is mandatory for \"${methodName}\" call`);\n  }\n  const result = parseFloat(paramValue);\n  if (isNaN(result)) {\n    throw new errors.InvalidArgumentError(`\"${paramName}\" parameter should be a valid number. \"${paramValue}\" is given instead`);\n  }\n  return result;\n}\n\nfunction requireIntParameter (paramName, paramValue, methodName) {\n  if (_.isUndefined(paramValue)) {\n    throw new errors.InvalidArgumentError(`\"${paramName}\" parameter is mandatory for \"${methodName}\" call`);\n  }\n  const result = parseInt(paramValue, 10);\n  if (isNaN(result)) {\n    throw new errors.InvalidArgumentError(`\"${paramName}\" parameter should be a valid integer. \"${paramValue}\" is given instead`);\n  }\n  return result;\n}\n\ncommands.mobileShake = async function mobileShake () {\n  if (!this.isSimulator()) {\n    throw new errors.UnknownError('Shake is not supported on real devices');\n  }\n  await this.opts.device.shake();\n};\n\ncommands.click = async function click (el) {\n  if (!this.isWebContext()) {\n    // there are multiple commands that map here, so manually proxy\n    return await this.nativeClick(el);\n  }\n  el = util.unwrapElement(el);\n  if ((await this.settings.getSettings()).nativeWebTap || (await this.settings.getSettings()).nativeWebTapStrict) {\n    // atoms-based clicks don't always work in safari 7\n    this.log.debug('Using native web tap');\n    await this.nativeWebTap(el);\n  } else {\n    const atomsElement = this.getAtomsElement(el);\n    return await this.executeAtom('click', [atomsElement]);\n  }\n};\n\nfunction gesturesChainToString (gestures, keysToInclude = ['options']) {\n  return gestures.map((item) => {\n    let otherKeys = _.difference(_.keys(item), ['action']);\n    otherKeys = _.isArray(keysToInclude) ? _.intersection(otherKeys, keysToInclude) : otherKeys;\n    if (otherKeys.length) {\n      return `${item.action}` +\n        `(${_.map(otherKeys, (x) => x + '=' + (_.isPlainObject(item[x]) ? JSON.stringify(item[x]) : item[x])).join(', ')})`;\n    }\n    return item.action;\n  }).join('-');\n}\n\ncommands.performActions = async function performActions (actions) {\n  this.log.debug(`Received the following W3C actions: ${JSON.stringify(actions, null, '  ')}`);\n  // This is mandatory, since WDA only supports TOUCH pointer type\n  // and Selenium API uses MOUSE as the default one\n  const preprocessedActions = actions\n    .map((action) => Object.assign({}, action, action.type === 'pointer' ? {\n      parameters: {\n        pointerType: 'touch'\n      }\n    } : {}))\n    .map((action) => {\n      const modifiedAction = _.clone(action) || {};\n      // Selenium API unexpectedly inserts zero pauses, which are not supported by WDA\n      modifiedAction.actions = (action.actions || [])\n        .filter((innerAction) => !(innerAction.type === 'pause' && innerAction.duration === 0));\n      return modifiedAction;\n    });\n  this.log.debug(`Preprocessed actions: ${JSON.stringify(preprocessedActions, null, '  ')}`);\n  return await this.proxyCommand('/actions', 'POST', {actions: preprocessedActions});\n};\n\ncommands.releaseActions = function releaseActions () {\n  this.log.warn('On this platform, releaseActions is a no-op');\n};\n\ncommands.performTouch = async function performTouch (gestures) {\n  this.log.debug(`Received the following touch action: ${gesturesChainToString(gestures)}`);\n  try {\n    return await this.proxyCommand('/wda/touch/perform', 'POST', {actions: gestures});\n  } catch (e) {\n    if (!this.isWebContext()) {\n      throw e;\n    }\n    this.log.errorAndThrow('The Touch API is aimed for usage in NATIVE context. ' +\n      'Consider using \"execute\" API with custom events trigger script ' +\n      `to emulate touch events being in WEBVIEW context. Original error: ${e.message}`);\n  }\n};\n\ncommands.performMultiAction = async function performMultiAction (actions) {\n  this.log.debug(`Received the following multi touch action:`);\n  for (let i in actions) {\n    this.log.debug(`    ${parseInt(i, 10) + 1}: ${_.map(actions[i], 'action').join('-')}`);\n  }\n  try {\n    return await this.proxyCommand('/wda/touch/multi/perform', 'POST', {actions});\n  } catch (e) {\n    if (!this.isWebContext()) {\n      throw e;\n    }\n    this.log.errorAndThrow('The MultiTouch API is aimed for usage in NATIVE context. ' +\n      'Consider using \"execute\" API with custom events trigger script ' +\n      `to emulate multitouch events being in WEBVIEW context. Original error: ${e.message}`);\n  }\n};\n\ncommands.nativeClick = async function nativeClick (el) {\n  el = util.unwrapElement(el);\n  let endpoint = `/element/${el}/click`;\n  return await this.proxyCommand(endpoint, 'POST', {});\n};\n\n/*\n * See https://github.com/facebook/WebDriverAgent/blob/master/WebDriverAgentLib/Commands/FBElementCommands.m\n * to get the info about available WDA gestures API\n *\n * See https://developer.apple.com/reference/xctest/xcuielement and\n * https://developer.apple.com/reference/xctest/xcuicoordinate to get the detailed description of\n * all XCTest gestures\n*/\n\ncommands.mobileScrollToElement = async function mobileScrollToElement (opts = {}) {\n  const elementId = await toElementId(opts);\n  if (!elementId) {\n    throw new errors.InvalidArgumentError('Element id must be provided');\n  }\n  return await this.proxyCommand(`/wda/element/${elementId}/scrollTo`, 'POST', {});\n};\n\nhelpers.mobileScroll = async function mobileScroll (opts = {}) {\n  // WDA supports four scrolling strategies: predication based on name, direction,\n  // predicateString, and toVisible, in that order\n  const {\n    name,\n    direction,\n    predicateString,\n    toVisible,\n    distance,\n  } = opts;\n  const params = {};\n  if (name) {\n    params.name = name;\n  } else if (direction) {\n    if (!SUPPORTED_GESTURE_DIRECTIONS.includes(_.toLower(direction))) {\n      throw new errors.InvalidArgumentError(`'direction' must be one of: ${SUPPORTED_GESTURE_DIRECTIONS}`);\n    }\n    params.direction = direction;\n  } else if (predicateString) {\n    params.predicateString = predicateString;\n  } else if (toVisible) {\n    params.toVisible = toVisible;\n  } else {\n    throw new errors.InvalidArgumentError(\n      'Mobile scroll supports the following strategies: name, direction, predicateString, and toVisible. ' +\n      'Specify one of these');\n  }\n  // we can also optionally pass a distance which appears to be a ratio of\n  // screen height, so 1.0 means a full screen's worth of scrolling\n  if (!_.isNil(distance)) {\n    params.distance = distance;\n  }\n  const elementId = await toElementOrApplicationId(this, opts);\n  return await this.proxyCommand(`/wda/element/${elementId}/scroll`, 'POST', params);\n};\n\nhelpers.mobileSwipe = async function mobileSwipe (opts = {}) {\n  const {\n    direction,\n    velocity,\n  } = opts;\n  if (!SUPPORTED_GESTURE_DIRECTIONS.includes(_.toLower(direction))) {\n    throw new errors.InvalidArgumentError(`'direction' must be one of: ${SUPPORTED_GESTURE_DIRECTIONS}`);\n  }\n  const params = {direction};\n  if (!_.isNil(velocity)) {\n    params.velocity = velocity;\n  }\n  const elementId = await toElementOrApplicationId(this, opts);\n  return await this.proxyCommand(`/wda/element/${elementId}/swipe`, 'POST', params);\n};\n\nhelpers.mobilePinch = async function mobilePinch (opts = {}) {\n  const params = {\n    scale: requireFloatParameter('scale', opts.scale, 'pinch'),\n    velocity: requireFloatParameter('velocity', opts.velocity, 'pinch')\n  };\n  const elementId = await toElementOrApplicationId(this, opts);\n  return await this.proxyCommand(`/wda/element/${elementId}/pinch`, 'POST', params);\n};\n\nhelpers.mobileDoubleTap = async function mobileDoubleTap (opts = {}) {\n  const elementId = toElementId(opts);\n  if (elementId) {\n    // Double tap element\n    return await this.proxyCommand(`/wda/element/${elementId}/doubleTap`, 'POST');\n  }\n  // Double tap coordinates\n  const params = {\n    x: requireFloatParameter('x', opts.x, 'doubleTap'),\n    y: requireFloatParameter('y', opts.y, 'doubleTap')\n  };\n  return await this.proxyCommand('/wda/doubleTap', 'POST', params);\n};\n\nhelpers.mobileTwoFingerTap = async function mobileTwoFingerTap (opts = {}) {\n  const elementId = await toElementOrApplicationId(this, opts);\n  return await this.proxyCommand(`/wda/element/${elementId}/twoFingerTap`, 'POST');\n};\n\nhelpers.mobileTouchAndHold = async function mobileTouchAndHold (opts = {}) {\n  const params = {\n    duration: requireFloatParameter('duration', opts.duration, 'touchAndHold')\n  };\n  const elementId = toElementId(opts);\n  if (elementId) {\n    // Long tap element\n    return await this.proxyCommand(`/wda/element/${elementId}/touchAndHold`, 'POST', params);\n  }\n  // Long tap coordinates\n  params.x = requireFloatParameter('x', opts.x, 'touchAndHold');\n  params.y = requireFloatParameter('y', opts.y, 'touchAndHold');\n  return await this.proxyCommand('/wda/touchAndHold', 'POST', params);\n};\n\nhelpers.mobileTap = async function mobileTap (opts = {}) {\n  const params = {\n    x: requireFloatParameter('x', opts.x, 'tap'),\n    y: requireFloatParameter('y', opts.y, 'tap')\n  };\n  const elementId = toElementId(opts) || '0';\n  return await this.proxyCommand(`/wda/tap/${elementId}`, 'POST', params);\n};\n\nhelpers.mobileDragFromToForDuration = async function mobileDragFromToForDuration (opts = {}) {\n  const params = {\n    duration: requireFloatParameter('duration', opts.duration, 'dragFromToForDuration'),\n    fromX: requireFloatParameter('fromX', opts.fromX, 'dragFromToForDuration'),\n    fromY: requireFloatParameter('fromY', opts.fromY, 'dragFromToForDuration'),\n    toX: requireFloatParameter('toX', opts.toX, 'dragFromToForDuration'),\n    toY: requireFloatParameter('toY', opts.toY, 'dragFromToForDuration')\n  };\n  const elementId = toElementId(opts);\n  return elementId\n    // Drag element\n    ? await this.proxyCommand(`/wda/element/${elementId}/dragfromtoforduration`, 'POST', params)\n    // Drag coordinates\n    : await this.proxyCommand('/wda/dragfromtoforduration', 'POST', params);\n};\n\nhelpers.mobileDragFromToWithVelocity = async function mobileDragFromToWithVelocity (opts = {}) {\n  const params = {\n    pressDuration: requireFloatParameter('pressDuration', opts.pressDuration, 'dragFromToWithVelocity'),\n    holdDuration: requireFloatParameter('holdDuration', opts.holdDuration, 'dragFromToWithVelocity'),\n    velocity: requireFloatParameter('velocity', opts.velocity, 'dragFromToWithVelocity'),\n  };\n  const fromElementId = opts.fromElementId ? util.unwrapElement(opts.fromElementId) : null;\n  if (fromElementId) {\n    const toElement = opts.toElementId ? util.unwrapElement(opts.toElementId) : null;\n    if (!toElement) {\n      throw new errors.InvalidArgumentError(`\"toElementId\" parameter is mandatory for \"dragFromToWithVelocity\" call`);\n    }\n    params.toElement = toElement;\n    return await this.proxyCommand(`/wda/element/${fromElementId}/pressAndDragWithVelocity`, 'POST', params);\n  }\n  params.fromX = requireFloatParameter('fromX', opts.fromX, 'dragFromToWithVelocity');\n  params.fromY = requireFloatParameter('fromY', opts.fromY, 'dragFromToWithVelocity');\n  params.toX = requireFloatParameter('toX', opts.toX, 'dragFromToWithVelocity');\n  params.toY = requireFloatParameter('toY', opts.toY, 'dragFromToWithVelocity');\n  return await this.proxyCommand('/wda/pressAndDragWithVelocity', 'POST', params);\n};\n\nhelpers.mobileTapWithNumberOfTaps = async function mobileTapWithNumberOfTaps (opts = {}) {\n  const elementId = toElementId(opts);\n  if (!elementId) {\n    throw new errors.InvalidArgumentError('Element id is expected to be set for tapWithNumberOfTaps method');\n  }\n  const params = {\n    numberOfTaps: requireIntParameter('numberOfTaps', opts.numberOfTaps, 'tapWithNumberOfTaps'),\n    numberOfTouches: requireIntParameter('numberOfTouches', opts.numberOfTouches, 'tapWithNumberOfTaps'),\n  };\n  return await this.proxyCommand(`/wda/element/${elementId}/tapWithNumberOfTaps`, 'POST', params);\n};\n\nhelpers.mobileForcePress = async function mobileForcePress (opts = {}) {\n  const {x, y, duration, pressure} = opts;\n  const elementId = toElementId(opts);\n  const endpoint = elementId ? `/wda/element/${elementId}/forceTouch` : `/wda/forceTouch`;\n  return await this.proxyCommand(endpoint, 'POST', {x, y, duration, pressure});\n};\n\nhelpers.mobileSelectPickerWheelValue = async function mobileSelectPickerWheelValue (opts = {}) {\n  const elementId = toElementId(opts);\n  if (!elementId) {\n    throw new errors.InvalidArgumentError('Element id is expected to be set for selectPickerWheelValue method');\n  }\n  if (!_.isString(opts.order) || !['next', 'previous'].includes(opts.order.toLowerCase())) {\n    throw new errors.InvalidArgumentError(`The mandatory 'order' parameter is expected to be equal either to 'next' or 'previous'. ` +\n      `'${opts.order}' is given instead`);\n  }\n  const params = {order: opts.order};\n  if (opts.offset) {\n    params.offset = requireFloatParameter('offset', opts.offset, 'selectPickerWheelValue');\n  }\n  return await this.proxyCommand(`/wda/pickerwheel/${elementId}/select`, 'POST', params);\n};\n\nhelpers.mobileRotateElement = async function mobileRotateElement (opts = {}) {\n  const elementId = toElementId(opts);\n  if (!elementId) {\n    throw new errors.InvalidArgumentError('Element id is expected to be set for rotateElement method');\n  }\n  const params = {\n    rotation: requireFloatParameter('rotation', opts.rotation, 'rotateElement'),\n    velocity: requireFloatParameter('velocity', opts.velocity, 'rotateElement'),\n  };\n  return await this.proxyCommand(`/wda/element/${elementId}/rotate`, 'POST', params);\n};\n\nhelpers.getCoordinates = async function getCoordinates (gesture) {\n  // defaults\n  let coordinates = {x: 0, y: 0, areOffsets: false};\n\n  let optionX = null;\n  if (gesture.options.x) {\n    optionX = requireFloatParameter('x', gesture.options.x, 'getCoordinates');\n  }\n  let optionY = null;\n  if (gesture.options.y) {\n    optionY = requireFloatParameter('y', gesture.options.y, 'getCoordinates');\n  }\n\n  // figure out the element coordinates.\n  const elementId = toElementId(gesture.options);\n  if (elementId) {\n    let rect = await this.getElementRect(elementId);\n    let pos = {x: rect.x, y: rect.y};\n    let size = {w: rect.width, h: rect.height};\n\n    // defaults\n    let offsetX = 0;\n    let offsetY = 0;\n\n    // get the real offsets\n    if (optionX || optionY) {\n      offsetX = (optionX || 0);\n      offsetY = (optionY || 0);\n    } else {\n      offsetX = (size.w / 2);\n      offsetY = (size.h / 2);\n    }\n\n    // apply the offsets\n    coordinates.x = pos.x + offsetX;\n    coordinates.y = pos.y + offsetY;\n  } else {\n    // moveTo coordinates are passed in as offsets\n    coordinates.areOffsets = (gesture.action === 'moveTo');\n    coordinates.x = (optionX || 0);\n    coordinates.y = (optionY || 0);\n  }\n  return coordinates;\n};\n\nhelpers.applyMoveToOffset = function applyMoveToOffset (firstCoordinates, secondCoordinates) {\n  if (secondCoordinates.areOffsets) {\n    return {\n      x: firstCoordinates.x + secondCoordinates.x,\n      y: firstCoordinates.y + secondCoordinates.y,\n    };\n  } else {\n    return secondCoordinates;\n  }\n};\n\nObject.assign(extensions, helpers, commands);\nexport { extensions, helpers, commands, gesturesChainToString };\nexport default extensions;\n"],"mappings":"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"}