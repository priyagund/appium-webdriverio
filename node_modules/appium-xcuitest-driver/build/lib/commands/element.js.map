{"version":3,"file":"element.js","names":["commands","extensions","elementDisplayed","el","util","unwrapElement","isWebContext","atomsElement","getAtomsElement","executeAtom","proxyCommand","elementEnabled","elementSelected","getName","script","getNativeAttribute","attribute","getContentSize","value","includes","_","isNull","isString","JSON","stringify","getAttribute","getProperty","property","getText","getElementRect","x","y","getLocation","width","height","getSize","getNativeRect","loc","opts","absoluteWebLocations","xOffset","yOffset","execute","rect","getLocationInView","prepareInputValue","inp","isArray","isFinite","some","f","Error","join","map","k","setValueImmediate","log","info","setValue","keys","clear","errors","NotYetImplementedError","type","locator","contentHeight","children","findElOrEls","length","head","firstRect","lastRect","last","elsInRow","initialRects","i","push","spaceBetweenEls","numRows","Math","ceil","size","origin","top","left","scrollableOffset","isKeyboardShown","findNativeElementOrElements","ign","Object","assign"],"sources":["../../../lib/commands/element.js"],"sourcesContent":["import _ from 'lodash';\nimport { errors } from 'appium/driver';\nimport { util } from 'appium/support';\n\n\nconst commands = {}, extensions = {};\n\ncommands.elementDisplayed = async function elementDisplayed (el) {\n  el = util.unwrapElement(el);\n  if (this.isWebContext()) {\n    const atomsElement = this.getAtomsElement(el);\n    return await this.executeAtom('is_displayed', [atomsElement]);\n  }\n\n  return await this.proxyCommand(`/element/${el}/displayed`, 'GET');\n};\n\ncommands.elementEnabled = async function elementEnabled (el) {\n  el = util.unwrapElement(el);\n  if (this.isWebContext()) {\n    const atomsElement = this.getAtomsElement(el);\n    return await this.executeAtom('is_enabled', [atomsElement]);\n  }\n\n  return await this.proxyCommand(`/element/${el}/enabled`, 'GET');\n};\n\ncommands.elementSelected = async function elementSelected (el) {\n  el = util.unwrapElement(el);\n  if (this.isWebContext()) {\n    const atomsElement = this.getAtomsElement(el);\n    return await this.executeAtom('is_selected', [atomsElement]);\n  }\n\n  return await this.proxyCommand(`/element/${el}/selected`, 'GET');\n};\n\ncommands.getName = async function getName (el) {\n  el = util.unwrapElement(el);\n  if (this.isWebContext()) {\n    const atomsElement = this.getAtomsElement(el);\n    const script = 'return arguments[0].tagName.toLowerCase()';\n    return await this.executeAtom('execute_script', [script, [atomsElement]]);\n  }\n\n  return await this.proxyCommand(`/element/${el}/name`, 'GET');\n};\n\ncommands.getNativeAttribute = async function getNativeAttribute (attribute, el) {\n  if (attribute === 'contentSize') {\n    // don't proxy requests for the content size of a scrollable element\n    return await this.getContentSize(el);\n  }\n\n  el = util.unwrapElement(el);\n\n  // otherwise let WDA handle attribute requests\n  let value = await this.proxyCommand(`/element/${el}/attribute/${attribute}`, 'GET');\n  // Transform the result for the case when WDA returns an integer representation for a boolean value\n  if ([0, 1].includes(value)) {\n    value = !!value;\n  }\n  // The returned value must be of type string according to https://www.w3.org/TR/webdriver/#get-element-attribute\n  return (_.isNull(value) || _.isString(value)) ? value : JSON.stringify(value);\n};\n\ncommands.getAttribute = async function getAttribute (attribute, el) {\n  el = util.unwrapElement(el);\n  if (!this.isWebContext()) {\n    return await this.getNativeAttribute(attribute, el);\n  }\n  const atomsElement = this.getAtomsElement(el);\n  return await this.executeAtom('get_attribute_value', [atomsElement, attribute]);\n};\n\ncommands.getProperty = async function getProperty (property, el) {\n  el = util.unwrapElement(el);\n  if (!this.isWebContext()) {\n    return await this.getNativeAttribute(property, el);\n  }\n  const atomsElement = this.getAtomsElement(el);\n  return await this.executeAtom('get_attribute_value', [atomsElement, property]);\n};\n\ncommands.getText = async function getText (el) {\n  el = util.unwrapElement(el);\n  if (!this.isWebContext()) {\n    return await this.proxyCommand(`/element/${el}/text`, 'GET');\n  }\n  let atomsElement = this.getAtomsElement(el);\n  return await this.executeAtom('get_text', [atomsElement]);\n};\n\ncommands.getElementRect = async function getElementRect (el) {\n  if (this.isWebContext()) {\n    // Mobile safari doesn't support rect\n    const {x, y} = await this.getLocation(el);\n    const {width, height} = await this.getSize(el);\n    return {x, y, width, height};\n  }\n\n  el = util.unwrapElement(el);\n  return await this.getNativeRect(el);\n};\n\nextensions.getNativeRect = async function getNativeRect (el) {\n  return await this.proxyCommand(`/element/${el}/rect`, 'GET');\n};\n\ncommands.getLocation = async function getLocation (el) {\n  el = util.unwrapElement(el);\n  if (this.isWebContext()) {\n    const atomsElement = await this.getAtomsElement(el);\n    let loc = await this.executeAtom('get_top_left_coordinates', [atomsElement]);\n    if (this.opts.absoluteWebLocations) {\n      const script = 'return [' +\n        'Math.max(window.pageXOffset,document.documentElement.scrollLeft,document.body.scrollLeft),' +\n        'Math.max(window.pageYOffset,document.documentElement.scrollTop,document.body.scrollTop)];';\n      const [xOffset, yOffset] = await this.execute(script);\n      loc.x += xOffset;\n      loc.y += yOffset;\n    }\n    return loc;\n  }\n\n  const rect = await this.getElementRect(el);\n  return {x: rect.x, y: rect.y};\n};\n\ncommands.getLocationInView = async function getLocationInView (el) {\n  return await this.getLocation(el);\n};\n\ncommands.getSize = async function getSize (el) {\n  el = util.unwrapElement(el);\n  if (this.isWebContext()) {\n    return await this.executeAtom('get_size', [this.getAtomsElement(el)]);\n  }\n\n  const rect = await this.getElementRect(el);\n  return {width: rect.width, height: rect.height};\n};\n\n/**\n * Prepares the input value to be passed as an argument to WDA.\n *\n * @param {string|Array<string>|number} inp The actual text to type.\n * Acceptable values of `inp`:\n *   ['some text']\n *   ['s', 'o', 'm', 'e', ' ', 't', 'e', 'x', 't']\n *   'some text'\n *   1234\n * @throws {Error} If the value is not acceptable for input\n * @returns {Array<string>} The preprocessed value\n */\nfunction prepareInputValue (inp) {\n  if (![_.isArray, _.isString, _.isFinite].some((f) => f(inp))) {\n    throw new Error(`Only strings, numbers and arrays are supported as input arguments. ` +\n      `Received: ${JSON.stringify(inp)}`);\n  }\n\n  // make it into a string, so then we assure\n  // the array items are single characters\n  if (_.isArray(inp)) {\n    inp = inp.join('');\n  } else if (_.isFinite(inp)) {\n    inp = `${inp}`;\n  }\n  // The `split` method must not be used on the string\n  // to properly handle all Unicode code points\n  return [...inp].map((k) => {\n    if (['\\uE006', '\\uE007'].includes(k)) { // RETURN or ENTER\n      return '\\n';\n    }\n    if (['\\uE003', '\\ue017'].includes(k)) { // BACKSPACE or DELETE\n      return '\\b';\n    }\n    return k;\n  });\n}\n\ncommands.setValueImmediate = async function setValueImmediate (value, el) {\n  // WDA does not provide no way to set the value directly\n  this.log.info('There is currently no way to bypass typing using XCUITest. Setting value through keyboard');\n  await this.setValue(value, el);\n};\n\ncommands.setValue = async function setValue (value, el) {\n  el = util.unwrapElement(el);\n  if (!this.isWebContext()) {\n    await this.proxyCommand(`/element/${el}/value`, 'POST', {\n      value: prepareInputValue(value),\n    });\n    return;\n  }\n\n  const atomsElement = this.getAtomsElement(el);\n  await this.executeAtom('click', [atomsElement]);\n  await this.executeAtom('type', [atomsElement, value]);\n};\n\ncommands.keys = async function keys (value) {\n  await this.proxyCommand('/wda/keys', 'POST', {\n    value: prepareInputValue(value),\n  });\n};\n\ncommands.clear = async function clear (el) {\n  el = util.unwrapElement(el);\n  if (this.isWebContext()) {\n    const atomsElement = this.getAtomsElement(el);\n    await this.executeAtom('clear', [atomsElement]);\n    return;\n  }\n  await this.proxyCommand(`/element/${el}/clear`, 'POST');\n};\n\ncommands.getContentSize = async function getContentSize (el) {\n  if (this.isWebContext()) {\n    throw new errors.NotYetImplementedError('Support for getContentSize for web context is not yet implemented. Please contact an Appium dev');\n  }\n\n  const type = await this.getAttribute('type', el);\n\n  if (type !== 'XCUIElementTypeTable' &&\n      type !== 'XCUIElementTypeCollectionView') {\n    throw new Error(`Can't get content size for type '${type}', only for ` +\n                    `tables and collection views`);\n  }\n  let locator = '*';\n  if (type === 'XCUIElementTypeTable') {\n    // only find table cells, not just any children\n    locator = 'XCUIElementTypeCell';\n  }\n\n  let contentHeight = 0;\n  const children = await this.findElOrEls(`class chain`, locator, true, el);\n  if (children.length === 1) {\n    // if we know there's only one element, we can optimize to make just one\n    // call to WDA\n    const rect = await this.getElementRect(_.head(children));\n    contentHeight = rect.height;\n  } else if (children.length) {\n    // otherwise if we have multiple elements, logic differs based on element\n    // type\n    switch (type) {\n      case 'XCUIElementTypeTable': {\n        const firstRect = await this.getElementRect(_.head(children));\n        const lastRect = await this.getElementRect(_.last(children));\n        contentHeight = lastRect.y + lastRect.height - firstRect.y;\n        break;\n      }\n      case 'XCUIElementTypeCollectionView': {\n        let elsInRow = 1; // we know there must be at least one element in the row\n        let firstRect = await this.getElementRect(_.head(children));\n        let initialRects = [firstRect];\n        for (let i = 1; i < children.length; i++) {\n          const rect = await this.getElementRect(children[i]);\n          initialRects.push(rect);\n          if (rect.y !== firstRect.y) {\n            elsInRow = i;\n            break;\n          }\n        }\n        const spaceBetweenEls = initialRects[elsInRow].y - initialRects[elsInRow - 1].y - initialRects[elsInRow - 1].height;\n        const numRows = Math.ceil(children.length / elsInRow);\n\n        // assume all cells are the same height\n        contentHeight = (numRows * firstRect.height) + (spaceBetweenEls * (numRows - 1));\n        break;\n      }\n      default: throw new Error(`Programming error: type '${type}' was not ` +\n                               `valid but should have already been rejected`);\n    }\n  }\n  const size = await this.getSize(el);\n  const origin = await this.getLocationInView(el);\n  // attributes have to be strings, so stringify this up\n  return JSON.stringify({\n    width: size.width,\n    height: size.height,\n    top: origin.y,\n    left: origin.x,\n    scrollableOffset: contentHeight\n  });\n};\n\ncommands.isKeyboardShown = async function isKeyboardShown () {\n  try {\n    await this.findNativeElementOrElements('class name', 'XCUIElementTypeKeyboard', false);\n    return true;\n  } catch (ign) {\n    return false;\n  }\n};\n\nObject.assign(extensions, commands);\nexport { commands };\nexport default extensions;\n"],"mappings":"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"}