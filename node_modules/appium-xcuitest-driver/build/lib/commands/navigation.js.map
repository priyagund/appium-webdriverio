{"version":3,"file":"navigation.js","names":["commands","helpers","extensions","CLOSE_WINDOW_TIMEOUT","CLOSE_WINDOW_INTERVAL","back","isWebContext","nativeBack","mobileWebNav","navBar","findNativeElementOrElements","buttons","length","Error","backButton","_","filter","value","label","log","debug","nativeClick","err","error","message","forward","closeWindow","errors","NotImplementedError","script","context","curContext","executeAtom","waitForCondition","waitMs","intervalMs","ign","Object","assign"],"sources":["../../../lib/commands/navigation.js"],"sourcesContent":["import { errors } from 'appium/driver';\nimport _ from 'lodash';\nimport { waitForCondition } from 'asyncbox';\n\nlet commands = {}, helpers = {}, extensions = {};\n\n// these two constitute the wait after closing a window\nconst CLOSE_WINDOW_TIMEOUT = 5000;\nconst CLOSE_WINDOW_INTERVAL = 100;\n\ncommands.back = async function back () {\n  if (!this.isWebContext()) {\n    await this.nativeBack();\n  } else {\n    await this.mobileWebNav('back');\n  }\n};\n\nhelpers.nativeBack = async function nativeBack () {\n  try {\n    let navBar = await this.findNativeElementOrElements('class name', 'XCUIElementTypeNavigationBar', false);\n    let buttons = await this.findNativeElementOrElements('class name', 'XCUIElementTypeButton', true, navBar);\n    if (buttons.length === 0) {\n      throw new Error('No buttons found in navigation bar');\n    }\n\n    let backButton = _.filter(buttons, (value) => value.label === 'Back')[0];\n    if (backButton) {\n      this.log.debug(`Found navigation bar 'back' button. Clicking.`);\n    } else {\n      this.log.debug(`Unable to find 'Back' button. Trying first button in navigation bar`);\n      backButton = buttons[0];\n    }\n    await this.nativeClick(backButton);\n  } catch (err) {\n    this.log.error(`Unable to find navigation bar and back button: ${err.message}`);\n  }\n};\n\ncommands.forward = async function forward () {\n  if (!this.isWebContext()) {\n  }\n  await this.mobileWebNav('forward');\n};\n\ncommands.closeWindow = async function closeWindow () {\n  if (!this.isWebContext()) {\n    throw new errors.NotImplementedError();\n  }\n\n  // since the window will be closed and the execution context gone, return\n  // first before closing. Waiting for close will happen in the finally block\n  const script = `setTimeout(function () {window.open('','_self').close();}, 0); return true;`;\n  const context = this.curContext;\n  try {\n    return await this.executeAtom('execute_script', [script, []], true);\n  } finally {\n    // wait for the window to successfully change...\n    try {\n      await waitForCondition(() => this.curContext !== context, {\n        waitMs: CLOSE_WINDOW_TIMEOUT,\n        intervalMs: CLOSE_WINDOW_INTERVAL,\n      });\n    } catch (ign) {\n      this.log.debug('Context has not yet been changed after closing window. Continuing...');\n    }\n  }\n};\n\n\nObject.assign(extensions, commands, helpers);\nexport { commands, helpers };\nexport default extensions;\n"],"mappings":";;;;;;;;;;;AAAA;;AACA;;AACA;;AAEA,IAAIA,QAAQ,GAAG,EAAf;AAAA,IAAmBC,OAAO,GAAG,EAA7B;AAAA,IAAiCC,UAAU,GAAG,EAA9C;;;AAGA,MAAMC,oBAAoB,GAAG,IAA7B;AACA,MAAMC,qBAAqB,GAAG,GAA9B;;AAEAJ,QAAQ,CAACK,IAAT,GAAgB,eAAeA,IAAf,GAAuB;EACrC,IAAI,CAAC,KAAKC,YAAL,EAAL,EAA0B;IACxB,MAAM,KAAKC,UAAL,EAAN;EACD,CAFD,MAEO;IACL,MAAM,KAAKC,YAAL,CAAkB,MAAlB,CAAN;EACD;AACF,CAND;;AAQAP,OAAO,CAACM,UAAR,GAAqB,eAAeA,UAAf,GAA6B;EAChD,IAAI;IACF,IAAIE,MAAM,GAAG,MAAM,KAAKC,2BAAL,CAAiC,YAAjC,EAA+C,8BAA/C,EAA+E,KAA/E,CAAnB;IACA,IAAIC,OAAO,GAAG,MAAM,KAAKD,2BAAL,CAAiC,YAAjC,EAA+C,uBAA/C,EAAwE,IAAxE,EAA8ED,MAA9E,CAApB;;IACA,IAAIE,OAAO,CAACC,MAAR,KAAmB,CAAvB,EAA0B;MACxB,MAAM,IAAIC,KAAJ,CAAU,oCAAV,CAAN;IACD;;IAED,IAAIC,UAAU,GAAGC,eAAA,CAAEC,MAAF,CAASL,OAAT,EAAmBM,KAAD,IAAWA,KAAK,CAACC,KAAN,KAAgB,MAA7C,EAAqD,CAArD,CAAjB;;IACA,IAAIJ,UAAJ,EAAgB;MACd,KAAKK,GAAL,CAASC,KAAT,CAAgB,+CAAhB;IACD,CAFD,MAEO;MACL,KAAKD,GAAL,CAASC,KAAT,CAAgB,qEAAhB;MACAN,UAAU,GAAGH,OAAO,CAAC,CAAD,CAApB;IACD;;IACD,MAAM,KAAKU,WAAL,CAAiBP,UAAjB,CAAN;EACD,CAfD,CAeE,OAAOQ,GAAP,EAAY;IACZ,KAAKH,GAAL,CAASI,KAAT,CAAgB,kDAAiDD,GAAG,CAACE,OAAQ,EAA7E;EACD;AACF,CAnBD;;AAqBAxB,QAAQ,CAACyB,OAAT,GAAmB,eAAeA,OAAf,GAA0B;EAC3C,IAAI,CAAC,KAAKnB,YAAL,EAAL,EAA0B,CACzB;;EACD,MAAM,KAAKE,YAAL,CAAkB,SAAlB,CAAN;AACD,CAJD;;AAMAR,QAAQ,CAAC0B,WAAT,GAAuB,eAAeA,WAAf,GAA8B;EACnD,IAAI,CAAC,KAAKpB,YAAL,EAAL,EAA0B;IACxB,MAAM,IAAIqB,cAAA,CAAOC,mBAAX,EAAN;EACD;;EAID,MAAMC,MAAM,GAAI,6EAAhB;EACA,MAAMC,OAAO,GAAG,KAAKC,UAArB;;EACA,IAAI;IACF,OAAO,MAAM,KAAKC,WAAL,CAAiB,gBAAjB,EAAmC,CAACH,MAAD,EAAS,EAAT,CAAnC,EAAiD,IAAjD,CAAb;EACD,CAFD,SAEU;IAER,IAAI;MACF,MAAM,IAAAI,0BAAA,EAAiB,MAAM,KAAKF,UAAL,KAAoBD,OAA3C,EAAoD;QACxDI,MAAM,EAAE/B,oBADgD;QAExDgC,UAAU,EAAE/B;MAF4C,CAApD,CAAN;IAID,CALD,CAKE,OAAOgC,GAAP,EAAY;MACZ,KAAKjB,GAAL,CAASC,KAAT,CAAe,sEAAf;IACD;EACF;AACF,CAtBD;;AAyBAiB,MAAM,CAACC,MAAP,CAAcpC,UAAd,EAA0BF,QAA1B,EAAoCC,OAApC;eAEeC,U"}