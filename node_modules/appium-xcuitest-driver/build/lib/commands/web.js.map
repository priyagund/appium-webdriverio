{"version":3,"file":"web.js","names":["IPHONE_TOP_BAR_HEIGHT","IPHONE_SCROLLED_TOP_BAR_HEIGHT","IPHONE_X_SCROLLED_OFFSET","IPHONE_X_NOTCH_OFFSET_IOS","IPHONE_X_NOTCH_OFFSET_IOS_13","IPHONE_LANDSCAPE_TOP_BAR_HEIGHT","IPHONE_BOTTOM_BAR_OFFSET","TAB_BAR_OFFSET","IPHONE_WEB_COORD_SMART_APP_BANNER_OFFSET","IPAD_WEB_COORD_SMART_APP_BANNER_OFFSET","NOTCHED_DEVICE_SIZES","w","h","W3C_WEB_ELEMENT_IDENTIFIER","util","ATOM_WAIT_TIMEOUT_MS","ATOM_INITIAL_WAIT_MS","ON_OBSTRUCTING_ALERT_EVENT","VISIBLE","INVISIBLE","DETECT","VISIBILITIES","TAB_BAR_POSITION_TOP","TAB_BAR_POSITION_BOTTOM","TAB_BAR_POSSITIONS","commands","helpers","extensions","isValidElementIdentifier","id","_","isString","isNumber","isEmpty","isNaN","setFrame","frame","isWebContext","errors","NotImplementedError","isNull","curWebFrames","log","debug","hasElementId","atomsElement","getAtomsElement","value","executeAtom","WINDOW","unshift","atom","isUndefined","NoSuchFrameError","getCssProperty","propertyName","el","submit","refresh","getUrl","remote","execute","title","getCookies","script","jsCookies","cookies","name","toPairs","cookieUtils","createJWPCookie","undefined","push","err","error","UnknownError","setCookie","cookie","clone","path","jsCookie","createJSCookie","expires","expiry","Date","toUTCString","domain","httpOnly","secure","JSON","stringify","deleteCookie","cookieName","indexOf","map","_deleteCookie","deleteCookies","length","webCookie","expireCookie","cacheWebElement","isPlainObject","elId","unwrapElement","cacheId","includes","uuidV4","webElementsCache","set","wrapElement","cacheWebElements","response","toCached","v","isArray","result","reduce","acc","key","findWebElementOrElements","strategy","selector","many","ctx","contextElement","isNil","element","doFind","implicitWaitForCondition","message","isFunction","match","NoSuchElementError","clickWebCoords","coords","translateWebCoords","curWebCoords","clickCoords","args","alwaysDefaultFrame","frames","promise","waitForAtom","executeAtomAsync","responseUrl","B","resolve","reject","asyncPromise","elOrId","has","StaleElementReferenceError","ELEMENT","get","convertElementsForAtoms","arg","isErrorType","getElementId","hasValue","getSafariIsIphone","isBoolean","_isSafariIphone","userAgent","toLowerCase","warn","getSafariDeviceSize","width","height","normHeight","normWidth","getSafariIsNotched","_isSafariNotched","device","getExtraTranslateWebCoordsOffset","wvPos","realDims","topOffset","bottomOffset","isIphone","nativeWebTapTabBarVisibility","nativeWebTapSmartAppBannerVisibility","safariTabBarPosition","compareVersions","opts","platformVersion","settings","getSettings","tabBarVisibility","lowerCase","bannerVisibility","tabBarPosition","InvalidArgumentError","isNotched","orientation","notchOffset","isScrolled","contextsAndViews","getContextsAndViews","tabs","filter","startsWith","getExtraNativeWebTapOffset","y","offset","banners","findNativeElementOrElements","tapWebElementNatively","driver","text","els","rect","proxyCommand","el2","rect2","x","Math","round","nativeWebTap","nativeWebTapStrict","Promise","all","size","coordinates","performTouch","action","options","webview","retryInterval","ign","Error","cmd","wvDims","implicitWaitMs","setImplicitWait","xRatio","yRatio","newCoords","checkForAlert","getAlertText","timer","timing","Timer","start","timedAtomPromise","timeout","handlePromiseError","p","originalError","AggregateError","TimeoutError","getDuration","asMilliSeconds","toFixed","any","delay","isFulfilled","_waitingAtoms","count","alertNotifier","EventEmitter","alertMonitor","onAlertCallback","isResolved","emit","UnexpectedAlertOpenError","once","then","catch","removeListener","mobileWebNav","navType","allowNavigationWithoutReload","Object","assign"],"sources":["../../../lib/commands/web.js"],"sourcesContent":["import { retryInterval } from 'asyncbox';\nimport { util, timing } from 'appium/support';\nimport _ from 'lodash';\nimport B from 'bluebird';\nimport { errors, isErrorType } from 'appium/driver';\nimport cookieUtils from '../cookies';\nimport { EventEmitter } from 'events';\n\nconst IPHONE_TOP_BAR_HEIGHT = 71;\nconst IPHONE_SCROLLED_TOP_BAR_HEIGHT = 41;\nconst IPHONE_X_SCROLLED_OFFSET = 55;\nconst IPHONE_X_NOTCH_OFFSET_IOS = 24;\nconst IPHONE_X_NOTCH_OFFSET_IOS_13 = 20;\n\nconst IPHONE_LANDSCAPE_TOP_BAR_HEIGHT = 51;\nconst IPHONE_BOTTOM_BAR_OFFSET = 49;\nconst TAB_BAR_OFFSET = 33;\nconst IPHONE_WEB_COORD_SMART_APP_BANNER_OFFSET = 84;\nconst IPAD_WEB_COORD_SMART_APP_BANNER_OFFSET = 95;\n\nconst NOTCHED_DEVICE_SIZES = [\n  {w: 1125, h: 2436}, // 11 Pro, X, Xs\n  {w: 828, h: 1792}, // 11, Xr\n  {w: 1242, h: 2688}, // 11 Pro Max, Xs Max\n];\n\nconst { W3C_WEB_ELEMENT_IDENTIFIER } = util;\n\nconst ATOM_WAIT_TIMEOUT_MS = 2 * 60000;\nconst ATOM_INITIAL_WAIT_MS = 1000;\n\nconst ON_OBSTRUCTING_ALERT_EVENT = 'alert';\n\nconst VISIBLE = 'visible';\nconst INVISIBLE = 'invisible';\nconst DETECT = 'detect';\nconst VISIBILITIES = [VISIBLE, INVISIBLE, DETECT];\n\n// The position of Safari's tab (search bar).\n// Since iOS 15, the bar is the bottom by default.\nconst TAB_BAR_POSITION_TOP = 'top';\nconst TAB_BAR_POSITION_BOTTOM = 'bottom';\nconst TAB_BAR_POSSITIONS = [TAB_BAR_POSITION_TOP, TAB_BAR_POSITION_BOTTOM];\n\nconst commands = {}, helpers = {}, extensions = {};\n\nfunction isValidElementIdentifier (id) {\n  if (!_.isString(id) && !_.isNumber(id)) {\n    return false;\n  }\n  if (_.isString(id) && _.isEmpty(id)) {\n    return false;\n  }\n  if (_.isNumber(id) && isNaN(id)) {\n    return false;\n  }\n  return true;\n}\n\ncommands.setFrame = async function setFrame (frame) {\n  if (!this.isWebContext()) {\n    throw new errors.NotImplementedError();\n  }\n\n  if (_.isNull(frame)) {\n    this.curWebFrames = [];\n    this.log.debug('Leaving web frame and going back to default content');\n    return;\n  }\n\n  if (helpers.hasElementId(frame)) {\n    const atomsElement = this.getAtomsElement(frame);\n    const value = await this.executeAtom('get_frame_window', [atomsElement]);\n    this.log.debug(`Entering new web frame: '${value.WINDOW}'`);\n    this.curWebFrames.unshift(value.WINDOW);\n  } else {\n    const atom = _.isNumber(frame) ? 'frame_by_index' : 'frame_by_id_or_name';\n    const value = await this.executeAtom(atom, [frame]);\n    if (_.isNull(value) || _.isUndefined(value.WINDOW)) {\n      throw new errors.NoSuchFrameError();\n    }\n    this.log.debug(`Entering new web frame: '${value.WINDOW}'`);\n    this.curWebFrames.unshift(value.WINDOW);\n  }\n};\n\ncommands.getCssProperty = async function getCssProperty (propertyName, el) {\n  if (!this.isWebContext()) {\n    throw new errors.NotImplementedError();\n  }\n\n  const atomsElement = this.getAtomsElement(el);\n  return await this.executeAtom('get_value_of_css_property', [atomsElement, propertyName]);\n};\n\ncommands.submit = async function submit (el) {\n  if (!this.isWebContext()) {\n    throw new errors.NotImplementedError();\n  }\n\n  const atomsElement = this.getAtomsElement(el);\n  await this.executeAtom('submit', [atomsElement]);\n};\n\ncommands.refresh = async function refresh () {\n  if (!this.isWebContext()) {\n    throw new errors.NotImplementedError();\n  }\n\n  await this.executeAtom('refresh', []);\n};\n\ncommands.getUrl = async function getUrl () {\n  if (!this.isWebContext()) {\n    throw new errors.NotImplementedError();\n  }\n\n  return await this.remote.execute('window.location.href');\n};\n\ncommands.title = async function title () {\n  if (!this.isWebContext()) {\n    throw new errors.NotImplementedError();\n  }\n\n  return await this.executeAtom('title', [], true);\n};\n\ncommands.getCookies = async function getCookies () {\n  if (!this.isWebContext()) {\n    throw new errors.NotImplementedError();\n  }\n\n  this.log.debug('Retrieving all cookies');\n\n  let script = 'return document.cookie';\n  let jsCookies = await this.executeAtom('execute_script', [script, []]);\n\n  let cookies = [];\n  try {\n    for (let [name, value] of _.toPairs(cookieUtils.createJWPCookie(undefined, jsCookies))) {\n      cookies.push({name, value});\n    }\n    return cookies;\n  } catch (err) {\n    this.log.error(err);\n    throw new errors.UnknownError(`Error parsing cookies from result: '${jsCookies}'`);\n  }\n};\n\ncommands.setCookie = async function setCookie (cookie) {\n  if (!this.isWebContext()) {\n    throw new errors.NotImplementedError();\n  }\n\n  cookie = _.clone(cookie);\n\n  // if `path` field is not specified, Safari will not update cookies as expected; eg issue #1708\n  if (!cookie.path) {\n    cookie.path = '/';\n  }\n\n  const jsCookie = cookieUtils.createJSCookie(cookie.name, cookie.value, {\n    expires: _.isNumber(cookie.expiry) ? (new Date(cookie.expiry * 1000)).toUTCString() :\n      cookie.expiry,\n    path: cookie.path,\n    domain: cookie.domain,\n    httpOnly: cookie.httpOnly,\n    secure: cookie.secure\n  });\n  let script = `document.cookie = ${JSON.stringify(jsCookie)}`;\n  await this.executeAtom('execute_script', [script, []]);\n};\n\ncommands.deleteCookie = async function deleteCookie (cookieName) {\n  if (!this.isWebContext()) {\n    throw new errors.NotImplementedError();\n  }\n\n  // check cookie existence\n  let cookies = await this.getCookies();\n  if (_.indexOf(_.map(cookies, 'name'), cookieName) === -1) {\n    this.log.debug(`Cookie '${cookieName}' not found. Ignoring.`);\n    return true;\n  }\n\n  return await this._deleteCookie(cookieName);\n};\n\ncommands.deleteCookies = async function deleteCookies () {\n  if (!this.isWebContext()) {\n    throw new errors.NotImplementedError();\n  }\n\n  let cookies = await this.getCookies();\n  if (cookies.length) {\n    for (let cookie of cookies) {\n      await this._deleteCookie(cookie.name);\n    }\n  }\n  return true;\n};\n\nhelpers._deleteCookie = async function _deleteCookie (cookieName) {\n  this.log.debug(`Deleting cookie '${cookieName}'`);\n  let webCookie = cookieUtils.expireCookie(cookieName, {path: '/'});\n  let script = `document.cookie = ${JSON.stringify(webCookie)}`;\n  await this.executeAtom('execute_script', [script, []]);\n};\n\nhelpers.cacheWebElement = function cacheWebElement (el) {\n  if (!_.isPlainObject(el)) {\n    return el;\n  }\n  const elId = util.unwrapElement(el);\n  if (!isValidElementIdentifier(elId)) {\n    return el;\n  }\n  // In newer debugger releases element identifiers look like `:wdc:1628151649325`\n  // We assume it is safe to use these to identify cached elements\n  const cacheId = _.includes(elId, ':') ? elId : util.uuidV4();\n  this.webElementsCache.set(cacheId, elId);\n  return util.wrapElement(cacheId);\n};\n\nhelpers.cacheWebElements = function cacheWebElements (response) {\n  const toCached = (v) => _.isArray(v) || _.isPlainObject(v)\n    ? this.cacheWebElements(v)\n    : v;\n\n  if (_.isArray(response)) {\n    return response.map(toCached);\n  } else if (_.isPlainObject(response)) {\n    const result = {...response, ...(this.cacheWebElement(response))};\n    return _.toPairs(result).reduce(\n      (acc, [key, value]) => {\n        acc[key] = toCached(value);\n        return acc;\n      }, {}\n    );\n  }\n  return response;\n};\n\nextensions.findWebElementOrElements = async function findWebElementOrElements (strategy, selector, many, ctx) {\n  const contextElement = _.isNil(ctx) ? null : this.getAtomsElement(ctx);\n  let element;\n  let doFind = async () => {\n    element = await this.executeAtom(`find_element${many ? 's' : ''}`, [strategy, selector, contextElement]);\n    return !_.isNull(element);\n  };\n  try {\n    await this.implicitWaitForCondition(doFind);\n  } catch (err) {\n    if (err.message && _.isFunction(err.message.match) && err.message.match(/Condition unmet/)) {\n      // condition was not met setting res to empty array\n      element = [];\n    } else {\n      throw err;\n    }\n  }\n\n  if (many) {\n    return this.cacheWebElements(element);\n  }\n  if (_.isEmpty(element)) {\n    throw new errors.NoSuchElementError();\n  }\n  return this.cacheWebElements(element);\n};\n\nextensions.clickWebCoords = async function clickWebCoords () {\n  let coords = await this.translateWebCoords(this.curWebCoords);\n  await this.clickCoords(coords);\n};\n\nhelpers.executeAtom = async function executeAtom (atom, args, alwaysDefaultFrame = false) {\n  let frames = alwaysDefaultFrame === true ? [] : this.curWebFrames;\n  let promise = this.remote.executeAtom(atom, args, frames);\n  return await this.waitForAtom(promise);\n};\n\nhelpers.executeAtomAsync = async function executeAtomAsync (atom, args, responseUrl) {\n  // save the resolve and reject methods of the promise to be waited for\n  let promise = new B((resolve, reject) => {\n    this.asyncPromise = {resolve, reject};\n  });\n  await this.remote.executeAtomAsync(atom, args, this.curWebFrames, responseUrl);\n  return await this.waitForAtom(promise);\n};\n\nhelpers.getAtomsElement = function getAtomsElement (elOrId) {\n  const elId = util.unwrapElement(elOrId);\n  if (!this.webElementsCache.has(elId)) {\n    throw new errors.StaleElementReferenceError();\n  }\n  return {ELEMENT: this.webElementsCache.get(elId)};\n};\n\nhelpers.convertElementsForAtoms = function convertElementsForAtoms (args = []) {\n  return args.map((arg) => {\n    if (helpers.hasElementId(arg)) {\n      try {\n        return this.getAtomsElement(arg);\n      } catch (err) {\n        if (!isErrorType(err, errors.StaleElementReferenceError)) {\n          throw err;\n        }\n      }\n      return arg;\n    }\n    return _.isArray(arg) ? this.convertElementsForAtoms(arg) : arg;\n  });\n};\n\nhelpers.getElementId = function getElementId (element) {\n  return element.ELEMENT || element[W3C_WEB_ELEMENT_IDENTIFIER];\n};\n\nhelpers.hasElementId = function hasElementId (element) {\n  return util.hasValue(element) && (util.hasValue(element.ELEMENT) || util.hasValue(element[W3C_WEB_ELEMENT_IDENTIFIER]));\n};\n\nextensions.getSafariIsIphone = async function getSafariIsIphone () {\n  if (_.isBoolean(this._isSafariIphone)) {\n    return this._isSafariIphone;\n  }\n  try {\n    const userAgent = await this.execute('return navigator.userAgent');\n    this._isSafariIphone = userAgent.toLowerCase().includes('iphone');\n  } catch (err) {\n    this.log.warn(`Unable to find device type from useragent. Assuming iPhone`);\n    this.log.debug(`Error: ${err.message}`);\n  }\n  return this._isSafariIphone ?? true;\n};\n\nextensions.getSafariDeviceSize = async function getSafariDeviceSize () {\n  const script = 'return {height: window.screen.availHeight * window.devicePixelRatio, width: window.screen.availWidth * window.devicePixelRatio};';\n  const {width, height} = await this.execute(script);\n  const [normHeight, normWidth] = height > width ? [height, width] : [width, height];\n  return {\n    width: normWidth,\n    height: normHeight,\n  };\n};\n\nextensions.getSafariIsNotched = async function getSafariIsNotched () {\n  if (_.isBoolean(this._isSafariNotched)) {\n    return this._isSafariNotched;\n  }\n\n  try {\n    const {width, height} = await this.getSafariDeviceSize();\n    for (const device of NOTCHED_DEVICE_SIZES) {\n      if (device.w === width && device.h === height) {\n        this._isSafariNotched = true;\n      }\n    }\n  } catch (err) {\n    this.log.warn(`Unable to find device type from dimensions. Assuming the device is not notched`);\n    this.log.debug(`Error: ${err.message}`);\n  }\n  return this._isSafariNotched ?? false;\n};\n\nextensions.getExtraTranslateWebCoordsOffset = async function getExtraTranslateWebCoordsOffset (wvPos, realDims) {\n  let topOffset = 0;\n  let bottomOffset = 0;\n\n  const isIphone = await this.getSafariIsIphone();\n\n  // No need to check whether the Smart App Banner or Tab Bar is visible or not\n  // if already defined by nativeWebTapTabBarVisibility or nativeWebTapSmartAppBannerVisibility in settings.\n  const {\n    nativeWebTapTabBarVisibility,\n    nativeWebTapSmartAppBannerVisibility,\n    safariTabBarPosition = util.compareVersions(this.opts.platformVersion, '>=', '15.0') && isIphone\n      ? TAB_BAR_POSITION_BOTTOM : TAB_BAR_POSITION_TOP,\n  } = await this.settings.getSettings();\n  let tabBarVisibility = _.lowerCase(nativeWebTapTabBarVisibility);\n  let bannerVisibility = _.lowerCase(nativeWebTapSmartAppBannerVisibility);\n  const tabBarPosition = _.lowerCase(safariTabBarPosition);\n\n  if (!VISIBILITIES.includes(tabBarVisibility)) {\n    tabBarVisibility = DETECT;\n  }\n  if (!VISIBILITIES.includes(bannerVisibility)) {\n    bannerVisibility = DETECT;\n  }\n\n  if (!TAB_BAR_POSSITIONS.includes(tabBarPosition)) {\n    throw new errors.InvalidArgumentError(\n      `${safariTabBarPosition} is invalid as Safari tab bar position. Available positions are ${TAB_BAR_POSSITIONS}.`);\n  }\n\n  const isNotched = isIphone && await this.getSafariIsNotched();\n\n  const orientation = realDims.h > realDims.w ? 'PORTRAIT' : 'LANDSCAPE';\n\n  const notchOffset = isNotched\n    ? util.compareVersions(this.opts.platformVersion, '=', '13.0')\n      ? IPHONE_X_NOTCH_OFFSET_IOS_13\n      : IPHONE_X_NOTCH_OFFSET_IOS\n    : 0;\n\n  const isScrolled = await this.execute('return document.documentElement.scrollTop > 0');\n  if (isScrolled) {\n    topOffset = IPHONE_SCROLLED_TOP_BAR_HEIGHT + notchOffset;\n\n    if (isNotched) {\n      topOffset -= IPHONE_X_SCROLLED_OFFSET;\n    }\n\n    // If the iPhone is landscape then there is no top bar\n    if (orientation === 'LANDSCAPE' && isIphone) {\n      topOffset = 0;\n    }\n  } else {\n    topOffset = tabBarPosition === TAB_BAR_POSITION_BOTTOM ? 0 : IPHONE_TOP_BAR_HEIGHT;\n    topOffset += notchOffset;\n    this.log.debug(`tabBarPosition and topOffset: ${tabBarPosition}, ${topOffset}`);\n\n    if (isIphone) {\n      if (orientation === 'PORTRAIT') {\n        // The bottom bar is only visible when portrait\n        bottomOffset = IPHONE_BOTTOM_BAR_OFFSET;\n      } else {\n        topOffset = IPHONE_LANDSCAPE_TOP_BAR_HEIGHT;\n      }\n    }\n\n    if (orientation === 'LANDSCAPE' || !isIphone) {\n      if (tabBarVisibility === VISIBLE) {\n        topOffset += TAB_BAR_OFFSET;\n      } else if (tabBarVisibility === DETECT) {\n        // Tabs only appear if the device is landscape or if it's an iPad so we only check visibility in this case\n        // Assume that each tab bar is a WebView\n        const contextsAndViews = await this.getContextsAndViews();\n        const tabs = contextsAndViews.filter((ctx) => ctx.id.startsWith('WEBVIEW_'));\n\n        if (tabs.length > 1) {\n          this.log.debug(`Found ${tabs.length} tabs. Assuming the tab bar is visible`);\n          topOffset += TAB_BAR_OFFSET;\n        }\n      }\n    }\n  }\n\n  topOffset += await this.getExtraNativeWebTapOffset(isIphone, bannerVisibility);\n\n  wvPos.y += topOffset;\n  realDims.h -= (topOffset + bottomOffset);\n};\n\nextensions.getExtraNativeWebTapOffset = async function getExtraNativeWebTapOffset (isIphone, bannerVisibility) {\n  let offset = 0;\n\n  if (bannerVisibility === VISIBLE) {\n    offset += isIphone ?\n      IPHONE_WEB_COORD_SMART_APP_BANNER_OFFSET :\n      IPAD_WEB_COORD_SMART_APP_BANNER_OFFSET;\n  } else if (bannerVisibility === DETECT) {\n    // try to see if there is an Smart App Banner\n    const banners = await this.findNativeElementOrElements('accessibility id', 'Close app download offer', true);\n    if (banners.length > 0) {\n      offset += isIphone ?\n        IPHONE_WEB_COORD_SMART_APP_BANNER_OFFSET :\n        IPAD_WEB_COORD_SMART_APP_BANNER_OFFSET;\n    }\n  }\n\n  this.log.debug(`Additional native web tap offset computed: ${offset}`);\n  return offset;\n};\n\nasync function tapWebElementNatively (driver, atomsElement) {\n  // try to get the text of the element, which will be accessible in the\n  // native context\n  try {\n    let text = await driver.executeAtom('get_text', [atomsElement]);\n    if (!text) {\n      text = await driver.executeAtom('get_attribute_value', [atomsElement, 'value']);\n    }\n\n    if (text) {\n      const els = await driver.findNativeElementOrElements('accessibility id', text, true);\n      if (els.length === 1 || els.length === 2) {\n        const el = els[0];\n        // use tap because on iOS 11.2 and below `nativeClick` crashes WDA\n        const rect = await driver.proxyCommand(`/element/${util.unwrapElement(el)}/rect`, 'GET');\n        if (els.length === 2) {\n          const el2 = els[1];\n          const rect2 = await driver.proxyCommand(`/element/${util.unwrapElement(el2)}/rect`, 'GET');\n\n          if ((rect.x !== rect2.x || rect.y !== rect2.y) ||\n          (rect.width !== rect2.width || rect.height !== rect2.height)) {\n            // These 2 native elements are not referring to the same web element\n            return false;\n          }\n        }\n        const coords = {\n          x: Math.round(rect.x + rect.width / 2),\n          y: Math.round(rect.y + rect.height / 2),\n        };\n        await driver.clickCoords(coords);\n        return true;\n      }\n    }\n  } catch (err) {\n    // any failure should fall through and trigger the more elaborate\n    // method of clicking\n    driver.log.warn(`Error attempting to click: ${err.message}`);\n  }\n  return false;\n}\n\nextensions.nativeWebTap = async function nativeWebTap (el) {\n  const atomsElement = this.getAtomsElement(el);\n\n  // if strict native tap, do not try to do it with WDA directly\n  if (!(await this.settings.getSettings()).nativeWebTapStrict && await tapWebElementNatively(this, atomsElement)) {\n    return;\n  }\n  this.log.warn('Unable to do simple native web tap. Attempting to convert coordinates');\n\n  // `get_top_left_coordinates` returns the wrong value sometimes,\n  // unless we pre-call both of these functions before the actual calls\n  await B.Promise.all([\n    this.executeAtom('get_size', [atomsElement]),\n    this.executeAtom('get_top_left_coordinates', [atomsElement]),\n  ]);\n\n  const [size, coordinates] = await B.Promise.all([\n    this.executeAtom('get_size', [atomsElement]),\n    this.executeAtom('get_top_left_coordinates', [atomsElement]),\n  ]);\n  const {width, height} = size;\n  let {x, y} = coordinates;\n  x += width / 2;\n  y += height / 2;\n\n  this.curWebCoords = {x, y};\n  await this.clickWebCoords();\n};\n\nextensions.clickCoords = async function clickCoords (coords) {\n  await this.performTouch([\n    {\n      action: 'tap',\n      options: coords,\n    },\n  ]);\n};\n\nextensions.translateWebCoords = async function translateWebCoords (coords) {\n  this.log.debug(`Translating coordinates (${JSON.stringify(coords)}) to web coordinates`);\n\n  // absolutize web coords\n  let webview;\n  try {\n    webview = await retryInterval(5, 100, async () => await this.findNativeElementOrElements('class name', 'XCUIElementTypeWebView', false));\n  } catch (ign) {}\n\n  if (!webview) {\n    throw new Error(`No WebView found. Unable to translate web coordinates for native web tap.`);\n  }\n\n  webview = util.unwrapElement(webview);\n\n  const rect = await this.proxyCommand(`/element/${webview}/rect`, 'GET');\n  const wvPos = {x: rect.x, y: rect.y};\n  const realDims = {w: rect.width, h: rect.height};\n\n  const cmd = '(function () { return {w: window.innerWidth, h: window.innerHeight}; })()';\n  const wvDims = await this.remote.execute(cmd);\n\n  // keep track of implicit wait, and set locally to 0\n  // https://github.com/appium/appium/issues/14988\n  const implicitWaitMs = this.implicitWaitMs;\n  await this.setImplicitWait(0);\n  try {\n    await this.getExtraTranslateWebCoordsOffset(wvPos, realDims);\n  } finally {\n    await this.setImplicitWait(implicitWaitMs);\n  }\n\n  if (wvDims && realDims && wvPos) {\n    let xRatio = realDims.w / wvDims.w;\n    let yRatio = realDims.h / wvDims.h;\n    let newCoords = {\n      x: wvPos.x + Math.round(xRatio * coords.x),\n      y: wvPos.y + Math.round(yRatio * coords.y),\n    };\n\n    // additional logging for coordinates, since it is sometimes broken\n    //   see https://github.com/appium/appium/issues/9159\n    this.log.debug(`Converted coordinates: ${JSON.stringify(newCoords)}`);\n    this.log.debug(`    rect: ${JSON.stringify(rect)}`);\n    this.log.debug(`    wvPos: ${JSON.stringify(wvPos)}`);\n    this.log.debug(`    realDims: ${JSON.stringify(realDims)}`);\n    this.log.debug(`    wvDims: ${JSON.stringify(wvDims)}`);\n    this.log.debug(`    xRatio: ${JSON.stringify(xRatio)}`);\n    this.log.debug(`    yRatio: ${JSON.stringify(yRatio)}`);\n\n    this.log.debug(`Converted web coords ${JSON.stringify(coords)} ` +\n      `into real coords ${JSON.stringify(newCoords)}`);\n    return newCoords;\n  }\n};\n\nextensions.checkForAlert = async function checkForAlert () {\n  return _.isString(await this.getAlertText());\n};\n\nextensions.waitForAtom = async function waitForAtom (promise) {\n  const timer = new timing.Timer().start();\n\n  // need to check for alert while the atom is being executed.\n  // so notify ourselves when it happens\n  const timedAtomPromise = B.resolve(promise).timeout(ATOM_WAIT_TIMEOUT_MS);\n  const handlePromiseError = async (p) => {\n    try {\n      return await p;\n    } catch (err) {\n      const originalError = (err instanceof B.AggregateError) ? err[0] : err;\n      this.log.debug(`Error received while executing atom: ${originalError.message}`);\n      if (originalError instanceof B.TimeoutError) {\n        throw new Error(`Did not get any response for atom execution after ` +\n          `${timer.getDuration().asMilliSeconds.toFixed(0)}ms`);\n      }\n      throw originalError;\n    }\n  };\n  // if the atom promise is fulfilled within ATOM_INITIAL_WAIT_MS\n  // then we don't need to check for an alert presence\n  await handlePromiseError(B.any([B.delay(ATOM_INITIAL_WAIT_MS), timedAtomPromise]));\n  if (timedAtomPromise.isFulfilled()) {\n    return await timedAtomPromise;\n  }\n\n  // ...otherwise make sure there is no unexpected alert covering the element\n  if (!_.isPlainObject(this._waitingAtoms)) {\n    this._waitingAtoms = {\n      count: 0,\n      alertNotifier: new EventEmitter(),\n      alertMonitor: B.resolve(),\n    };\n  }\n  this._waitingAtoms.count++;\n\n  let onAlertCallback;\n  try {\n    // only restart the monitor if it is not running already\n    if (this._waitingAtoms.alertMonitor.isResolved()) {\n      this._waitingAtoms.alertMonitor = B.resolve((async () => {\n        while (this._waitingAtoms.count > 0) {\n          try {\n            if (await this.checkForAlert()) {\n              this._waitingAtoms.alertNotifier.emit(ON_OBSTRUCTING_ALERT_EVENT);\n            }\n          } catch (ign) {}\n          await B.delay(ATOM_INITIAL_WAIT_MS / 2);\n        }\n      })());\n    }\n\n    return await new B((resolve, reject) => {\n      onAlertCallback = () => reject(new errors.UnexpectedAlertOpenError());\n      this._waitingAtoms.alertNotifier.once(ON_OBSTRUCTING_ALERT_EVENT, onAlertCallback);\n      handlePromiseError(timedAtomPromise)\n        // eslint-disable-next-line promise/prefer-await-to-then\n        .then(resolve)\n        .catch(reject);\n    });\n  } finally {\n    if (onAlertCallback) {\n      this._waitingAtoms.alertNotifier.removeListener(ON_OBSTRUCTING_ALERT_EVENT, onAlertCallback);\n    }\n    this._waitingAtoms.count--;\n  }\n};\n\nextensions.mobileWebNav = async function mobileWebNav (navType) {\n  this.remote.allowNavigationWithoutReload = true;\n  try {\n    await this.executeAtom('execute_script', [`history.${navType}();`, null]);\n  } finally {\n    this.remote.allowNavigationWithoutReload = false;\n  }\n};\n\nObject.assign(commands, extensions, helpers);\n\nexport default commands;\n"],"mappings":"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"}