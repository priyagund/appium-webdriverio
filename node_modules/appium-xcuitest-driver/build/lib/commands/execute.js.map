{"version":3,"file":"execute.js","names":["extensions","receiveAsyncResponse","status","value","log","debug","JSON","stringify","util","hasValue","asyncPromise","warn","reject","errorFromCode","message","_","isString","error","errorFromW3CJsonCode","stacktrace","resolve","execute","script","args","match","replace","trim","executeMobile","isArray","isWebContext","convertElementsForAtoms","result","executeAtom","cacheWebElements","errors","NotImplementedError","executeAsync","asyncWaitMs","promise","remote","executeAtomAsync","curWebFrames","waitForAtom","mobileCommand","opts","commandMap","tap","scroll","selectPickerWheelValue","swipe","pinch","doubleTap","twoFingerTap","tapWithNumberOfTaps","touchAndHold","dragFromToForDuration","rotateElement","dragFromToWithVelocity","forcePress","scrollToElement","alert","setPasteboard","getPasteboard","source","getContexts","installApp","isAppInstalled","removeApp","launchApp","terminateApp","killApp","queryAppState","activateApp","listApps","viewportScreenshot","viewportRect","startPerfRecord","stopPerfRecord","installCertificate","listCertificates","startLogsBroadcast","stopLogsBroadcast","batteryInfo","deviceInfo","getDeviceTime","activeAppInfo","deviceScreenInfo","pressButton","enrollBiometric","sendBiometricMatch","isBiometricEnrolled","clearKeychains","getPermission","setPermission","resetPermission","getAppearance","setAppearance","siriCommand","pushFile","pullFile","pullFolder","deleteFile","deleteFolder","startAudioRecording","stopAudioRecording","runXCTest","installXCTestBundle","listXCTestBundles","listXCTestsInTestBundle","pushNotification","expectNotification","performIoHidEvent","configureLocalization","resetLocationService","startPcap","stopPcap","listConditionInducers","enableConditionInducer","disableConditionInducer","has","UnknownCommandError","keys","join"],"sources":["../../../lib/commands/execute.js"],"sourcesContent":["import _ from 'lodash';\nimport {\n  errors, errorFromCode, errorFromW3CJsonCode\n} from 'appium/driver';\nimport { util } from 'appium/support';\n\nconst extensions = {};\n\nextensions.receiveAsyncResponse = async function receiveAsyncResponse (status, value) { // eslint-disable-line require-await\n  this.log.debug(`Received async response: ${JSON.stringify(value)}`);\n  if (!util.hasValue(this.asyncPromise)) {\n    this.log.warn(`Received async response when we were not expecting one! ` +\n      `Response was: ${JSON.stringify(value)}`);\n    return;\n  }\n\n  if (util.hasValue(status) && status !== 0) {\n    // MJSONWP\n    return this.asyncPromise.reject(errorFromCode(status, value.message));\n  }\n  if (!util.hasValue(status) && value && _.isString(value.error)) {\n    // W3C\n    return this.asyncPromise.reject(errorFromW3CJsonCode(value.error, value.message, value.stacktrace));\n  }\n  return this.asyncPromise.resolve(value);\n};\n\nextensions.execute = async function execute (script, args) {\n  if (script.match(/^mobile:/)) {\n    script = script.replace(/^mobile:/, '').trim();\n    return await this.executeMobile(script, _.isArray(args) ? args[0] : args);\n  } else if (this.isWebContext()) {\n    args = this.convertElementsForAtoms(args);\n    const result = await this.executeAtom('execute_script', [script, args]);\n    return this.cacheWebElements(result);\n  } else {\n    throw new errors.NotImplementedError();\n  }\n};\n\nextensions.executeAsync = async function executeAsync (script, args) {\n  if (!this.isWebContext()) {\n    throw new errors.NotImplementedError();\n  }\n\n  args = this.convertElementsForAtoms(args);\n  this.asyncWaitMs = this.asyncWaitMs || 0;\n  const promise = this.remote.executeAtomAsync('execute_async_script', [\n    script, args, this.asyncWaitMs\n  ], this.curWebFrames);\n  return this.cacheWebElements(await this.waitForAtom(promise));\n};\n\nextensions.executeMobile = async function executeMobile (mobileCommand, opts = {}) {\n  const commandMap = {\n    //region gestures support\n    tap: 'mobileTap',\n    scroll: 'mobileScroll',\n    selectPickerWheelValue: 'mobileSelectPickerWheelValue',\n    // https://developer.apple.com/documentation/xctest/xcuielement/1618668-swipeleft?language=objc\n    // https://developer.apple.com/documentation/xctest/xcuielement/1618674-swiperight?language=objc\n    // https://developer.apple.com/documentation/xctest/xcuielement/1618667-swipeup?language=objc\n    // https://developer.apple.com/documentation/xctest/xcuielement/1618664-swipedown?language=objc\n    swipe: 'mobileSwipe',\n    // https://developer.apple.com/documentation/xctest/xcuielement/1618669-pinchwithscale?language=objc\n    pinch: 'mobilePinch',\n    // https://developer.apple.com/documentation/xctest/xcuielement/1618673-doubletap?language=objc\n    doubleTap: 'mobileDoubleTap',\n    // https://developer.apple.com/documentation/xctest/xcuielement/1618675-twofingertap?language=objc\n    twoFingerTap: 'mobileTwoFingerTap',\n    // https://developer.apple.com/documentation/xctest/xcuielement/1618671-tapwithnumberoftaps?language=objc\n    tapWithNumberOfTaps: 'mobileTapWithNumberOfTaps',\n    // https://developer.apple.com/documentation/xctest/xcuielement/1618663-pressforduration?language=objc\n    touchAndHold: 'mobileTouchAndHold',\n    // https://developer.apple.com/documentation/xctest/xcuielement/1618670-pressforduration?language=objc\n    dragFromToForDuration: 'mobileDragFromToForDuration',\n    // https://developer.apple.com/documentation/xctest/xcuielement/1618665-rotate?language=objc\n    rotateElement: 'mobileRotateElement',\n    // https://developer.apple.com/documentation/xctest/xcuicoordinate/3551692-pressforduration?language=objc\n    dragFromToWithVelocity: 'mobileDragFromToWithVelocity',\n    forcePress: 'mobileForcePress',\n    scrollToElement: 'mobileScrollToElement',\n\n    //endregion gestures support\n    alert: 'mobileHandleAlert',\n\n    setPasteboard: 'mobileSetPasteboard',\n    getPasteboard: 'mobileGetPasteboard',\n\n    source: 'mobileGetSource',\n    getContexts: 'mobileGetContexts',\n\n    //region multiple apps management\n    installApp: 'mobileInstallApp',\n    isAppInstalled: 'mobileIsAppInstalled',\n    removeApp: 'mobileRemoveApp',\n    launchApp: 'mobileLaunchApp',\n    terminateApp: 'mobileTerminateApp',\n    killApp: 'mobileKillApp',\n    queryAppState: 'mobileQueryAppState',\n    activateApp: 'mobileActivateApp',\n    listApps: 'mobileListApps',\n    //endregion multiple apps management\n\n    viewportScreenshot: 'getViewportScreenshot',\n    viewportRect: 'getViewportRect',\n\n    startPerfRecord: 'mobileStartPerfRecord',\n    stopPerfRecord: 'mobileStopPerfRecord',\n\n    installCertificate: 'mobileInstallCertificate',\n    listCertificates: 'mobileListCertificates',\n\n    startLogsBroadcast: 'mobileStartLogsBroadcast',\n    stopLogsBroadcast: 'mobileStopLogsBroadcast',\n\n    batteryInfo: 'mobileGetBatteryInfo',\n    deviceInfo: 'mobileGetDeviceInfo',\n    getDeviceTime: 'mobileGetDeviceTime',\n    activeAppInfo: 'mobileGetActiveAppInfo',\n    deviceScreenInfo: 'getScreenInfo',\n\n    pressButton: 'mobilePressButton',\n\n    enrollBiometric: 'mobileEnrollBiometric',\n    sendBiometricMatch: 'mobileSendBiometricMatch',\n    isBiometricEnrolled: 'mobileIsBiometricEnrolled',\n\n    clearKeychains: 'mobileClearKeychains',\n\n    getPermission: 'mobileGetPermission',\n    setPermission: 'mobileSetPermissions',\n    resetPermission: 'mobileResetPermission',\n\n    getAppearance: 'mobileGetAppearance',\n    setAppearance: 'mobileSetAppearance',\n\n    siriCommand: 'mobileSiriCommand',\n\n    pushFile: 'mobilePushFile',\n    pullFile: 'mobilePullFile',\n    pullFolder: 'mobilePullFolder',\n    deleteFile: 'mobileDeleteFile',\n    deleteFolder: 'mobileDeleteFolder',\n\n    startAudioRecording: 'startAudioRecording',\n    stopAudioRecording: 'stopAudioRecording',\n\n    // XCTest\n    runXCTest: 'mobileRunXCTest',\n    installXCTestBundle: 'mobileInstallXCTestBundle',\n    listXCTestBundles: 'mobileListXCTestBundles',\n    listXCTestsInTestBundle: 'mobileListXCTestsInTestBundle',\n\n    pushNotification: 'mobilePushNotification',\n    expectNotification: 'mobileExpectNotification',\n\n    performIoHidEvent: 'mobilePerformIoHidEvent',\n\n    configureLocalization: 'mobileConfigureLocalization',\n\n    resetLocationService: 'mobileResetLocationService',\n\n    startPcap: 'mobileStartPcap',\n    stopPcap: 'mobileStopPcap',\n    listConditionInducers: 'mobileListConditionInducers',\n    enableConditionInducer: 'mobileEnableConditionInducer',\n    disableConditionInducer: 'mobileDisableConditionInducer',\n  };\n\n  if (!_.has(commandMap, mobileCommand)) {\n    throw new errors.UnknownCommandError(`Unknown mobile command '${mobileCommand}'. Only ${_.keys(commandMap).join(', ')} commands are supported.`);\n  }\n  return await this[commandMap[mobileCommand]](opts);\n};\n\nexport default extensions;\n"],"mappings":"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"}