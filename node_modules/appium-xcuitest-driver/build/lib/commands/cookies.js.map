{"version":3,"file":"cookies.js","names":["commands","helpers","extensions","getCookies","isWebContext","errors","NotImplementedError","cookies","remote","decodedCookieValues","map","cookie","decodeURI","value","error","log","debug","name","warn","undefined","_","zip","filter","isUndefined","Object","assign","deleteCookie","cookieName","find","_deleteCookie","deleteCookies","url","secure","domain","path"],"sources":["../../../lib/commands/cookies.js"],"sourcesContent":["import _ from 'lodash';\nimport { errors } from 'appium/driver';\n\n\nlet commands = {}, helpers = {}, extensions = {};\n\ncommands.getCookies = async function getCookies () {\n  if (!this.isWebContext()) {\n    throw new errors.NotImplementedError();\n  }\n\n  // get the cookies from the remote debugger, or an empty object\n  const cookies = await this.remote.getCookies() || {cookies: []};\n\n  // the value is URI encoded, so decode it safely\n  const decodedCookieValues = cookies.cookies.map((cookie) => {\n    try {\n      return decodeURI(cookie.value);\n    } catch (error) {\n      this.log.debug(`Cookie ${cookie.name} was not decoded successfully. Cookie value: ${cookie.value}`);\n      this.log.warn(error);\n      return undefined;\n    }\n  });\n\n  // zip cookes with decoded value, removing undefined cookie values\n  return _.zip(cookies.cookies, decodedCookieValues)\n    .filter(([, value]) => !_.isUndefined(value))\n    .map(([cookie, value]) => Object.assign({}, cookie, {value}));\n};\n\ncommands.deleteCookie = async function deleteCookie (cookieName) {\n  if (!this.isWebContext()) {\n    throw new errors.NotImplementedError();\n  }\n\n  const cookies = await this.getCookies();\n  const cookie = cookies.find((cookie) => cookie.name === cookieName);\n  if (!cookie) {\n    this.log.debug(`Cookie '${cookieName}' not found. Ignoring.`);\n    return true;\n  }\n\n  await this._deleteCookie(cookie);\n  return true;\n};\n\ncommands.deleteCookies = async function deleteCookies () {\n  if (!this.isWebContext()) {\n    throw new errors.NotImplementedError();\n  }\n\n  const cookies = await this.getCookies();\n  for (const cookie of cookies) {\n    await this._deleteCookie(cookie);\n  }\n  return true;\n};\n\nhelpers._deleteCookie = async function _deleteCookie (cookie) {\n  const url = `http${cookie.secure ? 's' : ''}://${cookie.domain}${cookie.path}`;\n  return await this.remote.deleteCookie(cookie.name, url);\n};\n\nObject.assign(extensions, commands, helpers);\nexport { commands, helpers };\nexport default extensions;\n"],"mappings":";;;;;;;;;;;AAAA;;AACA;;AAGA,IAAIA,QAAQ,GAAG,EAAf;AAAA,IAAmBC,OAAO,GAAG,EAA7B;AAAA,IAAiCC,UAAU,GAAG,EAA9C;;;;AAEAF,QAAQ,CAACG,UAAT,GAAsB,eAAeA,UAAf,GAA6B;EACjD,IAAI,CAAC,KAAKC,YAAL,EAAL,EAA0B;IACxB,MAAM,IAAIC,cAAA,CAAOC,mBAAX,EAAN;EACD;;EAGD,MAAMC,OAAO,GAAG,OAAM,KAAKC,MAAL,CAAYL,UAAZ,EAAN,KAAkC;IAACI,OAAO,EAAE;EAAV,CAAlD;EAGA,MAAME,mBAAmB,GAAGF,OAAO,CAACA,OAAR,CAAgBG,GAAhB,CAAqBC,MAAD,IAAY;IAC1D,IAAI;MACF,OAAOC,SAAS,CAACD,MAAM,CAACE,KAAR,CAAhB;IACD,CAFD,CAEE,OAAOC,KAAP,EAAc;MACd,KAAKC,GAAL,CAASC,KAAT,CAAgB,UAASL,MAAM,CAACM,IAAK,gDAA+CN,MAAM,CAACE,KAAM,EAAjG;MACA,KAAKE,GAAL,CAASG,IAAT,CAAcJ,KAAd;MACA,OAAOK,SAAP;IACD;EACF,CAR2B,CAA5B;EAWA,OAAOC,eAAA,CAAEC,GAAF,CAAMd,OAAO,CAACA,OAAd,EAAuBE,mBAAvB,EACJa,MADI,CACG,CAAC,GAAGT,KAAH,CAAD,KAAe,CAACO,eAAA,CAAEG,WAAF,CAAcV,KAAd,CADnB,EAEJH,GAFI,CAEA,CAAC,CAACC,MAAD,EAASE,KAAT,CAAD,KAAqBW,MAAM,CAACC,MAAP,CAAc,EAAd,EAAkBd,MAAlB,EAA0B;IAACE;EAAD,CAA1B,CAFrB,CAAP;AAGD,CAvBD;;AAyBAb,QAAQ,CAAC0B,YAAT,GAAwB,eAAeA,YAAf,CAA6BC,UAA7B,EAAyC;EAC/D,IAAI,CAAC,KAAKvB,YAAL,EAAL,EAA0B;IACxB,MAAM,IAAIC,cAAA,CAAOC,mBAAX,EAAN;EACD;;EAED,MAAMC,OAAO,GAAG,MAAM,KAAKJ,UAAL,EAAtB;EACA,MAAMQ,MAAM,GAAGJ,OAAO,CAACqB,IAAR,CAAcjB,MAAD,IAAYA,MAAM,CAACM,IAAP,KAAgBU,UAAzC,CAAf;;EACA,IAAI,CAAChB,MAAL,EAAa;IACX,KAAKI,GAAL,CAASC,KAAT,CAAgB,WAAUW,UAAW,wBAArC;IACA,OAAO,IAAP;EACD;;EAED,MAAM,KAAKE,aAAL,CAAmBlB,MAAnB,CAAN;EACA,OAAO,IAAP;AACD,CAdD;;AAgBAX,QAAQ,CAAC8B,aAAT,GAAyB,eAAeA,aAAf,GAAgC;EACvD,IAAI,CAAC,KAAK1B,YAAL,EAAL,EAA0B;IACxB,MAAM,IAAIC,cAAA,CAAOC,mBAAX,EAAN;EACD;;EAED,MAAMC,OAAO,GAAG,MAAM,KAAKJ,UAAL,EAAtB;;EACA,KAAK,MAAMQ,MAAX,IAAqBJ,OAArB,EAA8B;IAC5B,MAAM,KAAKsB,aAAL,CAAmBlB,MAAnB,CAAN;EACD;;EACD,OAAO,IAAP;AACD,CAVD;;AAYAV,OAAO,CAAC4B,aAAR,GAAwB,eAAeA,aAAf,CAA8BlB,MAA9B,EAAsC;EAC5D,MAAMoB,GAAG,GAAI,OAAMpB,MAAM,CAACqB,MAAP,GAAgB,GAAhB,GAAsB,EAAG,MAAKrB,MAAM,CAACsB,MAAO,GAAEtB,MAAM,CAACuB,IAAK,EAA7E;EACA,OAAO,MAAM,KAAK1B,MAAL,CAAYkB,YAAZ,CAAyBf,MAAM,CAACM,IAAhC,EAAsCc,GAAtC,CAAb;AACD,CAHD;;AAKAP,MAAM,CAACC,MAAP,CAAcvB,UAAd,EAA0BF,QAA1B,EAAoCC,OAApC;eAEeC,U"}