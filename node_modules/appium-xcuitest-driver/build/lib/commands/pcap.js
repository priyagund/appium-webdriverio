"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = exports.commands = void 0;

require("source-map-support/register");

var _pyIosDeviceClient = _interopRequireDefault(require("../py-ios-device-client"));

var _support = require("appium/support");

var _utils = require("../utils");

var _driver = require("appium/driver");

const MAX_CAPTURE_TIME_SEC = 60 * 60 * 12;
const DEFAULT_CAPTURE_TIME_SEC = 60 * 5;
const DEFAULT_EXT = '.pcap';

const pcapLogger = _support.logger.getLogger('pcapd');

const commands = {};
exports.commands = commands;

class TrafficCapture {
  constructor(udid, log, resultPath) {
    this.udid = udid;
    this.log = log;
    this.resultPath = resultPath;
    this.mainProcess = null;
  }

  async start(timeoutSeconds) {
    this.mainProcess = await new _pyIosDeviceClient.default(this.udid).collectPcap(this.resultPath);
    this.mainProcess.on('output', (stdout, stderr) => {
      if (stderr) {
        pcapLogger.info(`${stderr}`);
      }
    });
    this.log.info(`Starting network traffic capture session on the device '${this.udid}'. ` + `Will timeout in ${timeoutSeconds}s`);
    setTimeout(async () => await this.interrupt(), timeoutSeconds * 1000);
    this.mainProcess.once('exit', (code, signal) => {
      this.log.debug(`The traffic capture session on the device '${this.udid}' has exited ` + `with code ${code}, signal ${signal}`);
    });
  }

  isCapturing() {
    var _this$mainProcess;

    return !!((_this$mainProcess = this.mainProcess) !== null && _this$mainProcess !== void 0 && _this$mainProcess.isRunning);
  }

  async interrupt(force = false) {
    if (this.isCapturing()) {
      const interruptPromise = this.mainProcess.stop(force ? 'SIGTERM' : 'SIGINT');
      this.mainProcess = null;

      try {
        await interruptPromise;
      } catch (e) {
        this.log.warn(`Cannot ${force ? 'terminate' : 'interrupt'} the traffic capture session. ` + `Original error: ${e.message}`);
        return false;
      }
    }

    return true;
  }

  async finish() {
    await this.interrupt();
    return this.resultPath;
  }

  async cleanup() {
    if (await _support.fs.exists(this.resultPath)) {
      await _support.fs.rimraf(this.resultPath);
    }
  }

}

commands.mobileStartPcap = async function mobileStartPcap(options = {}) {
  var _this$_trafficCapture;

  if (this.isSimulator()) {
    this.log.errorAndThrow('Network traffic capture only works on real devices');
  }

  const {
    timeLimitSec = DEFAULT_CAPTURE_TIME_SEC,
    forceRestart
  } = options;

  if ((_this$_trafficCapture = this._trafficCapture) !== null && _this$_trafficCapture !== void 0 && _this$_trafficCapture.isCapturing()) {
    this.log.info(`There is an active traffic capture process`);

    if (forceRestart) {
      this.log.info(`Stopping it because 'forceRestart' option is set to true`);
      await this._trafficCapture.interrupt(true);
    } else {
      this.log.info(`Doing nothing. ` + `Set 'forceRestart' option to true if you'd like to start a new traffic capture session`);
      return;
    }
  }

  if (this._trafficCapture) {
    await this._trafficCapture.cleanup();
    this._trafficCapture = null;
  }

  const resultPath = await _support.tempDir.path({
    prefix: `appium_${_support.util.uuidV4().substring(0, 8)}`,
    suffix: DEFAULT_EXT
  });
  const trafficCollector = new TrafficCapture(this.opts.device.udid, this.log, resultPath);
  const timeoutSeconds = parseInt(timeLimitSec, 10);

  if (isNaN(timeoutSeconds) || timeoutSeconds > MAX_CAPTURE_TIME_SEC || timeoutSeconds <= 0) {
    throw new _driver.errors.InvalidArgumentError(`The timeLimitSec value must be in range [1, ${MAX_CAPTURE_TIME_SEC}] seconds. ` + `The value of '${timeLimitSec}' has been passed instead.`);
  }

  try {
    await trafficCollector.start(timeoutSeconds);
  } catch (e) {
    await trafficCollector.interrupt(true);
    await trafficCollector.cleanup();
    throw e;
  }

  this._trafficCapture = trafficCollector;
};

commands.mobileStopPcap = async function mobileStopPcap() {
  if (!this._trafficCapture) {
    this.log.info('Network traffic collector has not been started. There is nothing to stop');
    return '';
  }

  let resultPath;

  try {
    resultPath = await this._trafficCapture.finish();

    if (!(await _support.fs.exists(resultPath))) {
      this.log.errorAndThrow(`The network traffic capture utility has failed ` + `to store the actual traffic capture at '${resultPath}'`);
    }
  } catch (e) {
    await this._trafficCapture.interrupt(true);
    await this._trafficCapture.cleanup();
    this._trafficCapture = null;
    throw e;
  }

  return await (0, _utils.encodeBase64OrUpload)(resultPath);
};

var _default = commands;
exports.default = _default;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJNQVhfQ0FQVFVSRV9USU1FX1NFQyIsIkRFRkFVTFRfQ0FQVFVSRV9USU1FX1NFQyIsIkRFRkFVTFRfRVhUIiwicGNhcExvZ2dlciIsImxvZ2dlciIsImdldExvZ2dlciIsImNvbW1hbmRzIiwiVHJhZmZpY0NhcHR1cmUiLCJjb25zdHJ1Y3RvciIsInVkaWQiLCJsb2ciLCJyZXN1bHRQYXRoIiwibWFpblByb2Nlc3MiLCJzdGFydCIsInRpbWVvdXRTZWNvbmRzIiwiUHlpZGV2aWNlIiwiY29sbGVjdFBjYXAiLCJvbiIsInN0ZG91dCIsInN0ZGVyciIsImluZm8iLCJzZXRUaW1lb3V0IiwiaW50ZXJydXB0Iiwib25jZSIsImNvZGUiLCJzaWduYWwiLCJkZWJ1ZyIsImlzQ2FwdHVyaW5nIiwiaXNSdW5uaW5nIiwiZm9yY2UiLCJpbnRlcnJ1cHRQcm9taXNlIiwic3RvcCIsImUiLCJ3YXJuIiwibWVzc2FnZSIsImZpbmlzaCIsImNsZWFudXAiLCJmcyIsImV4aXN0cyIsInJpbXJhZiIsIm1vYmlsZVN0YXJ0UGNhcCIsIm9wdGlvbnMiLCJpc1NpbXVsYXRvciIsImVycm9yQW5kVGhyb3ciLCJ0aW1lTGltaXRTZWMiLCJmb3JjZVJlc3RhcnQiLCJfdHJhZmZpY0NhcHR1cmUiLCJ0ZW1wRGlyIiwicGF0aCIsInByZWZpeCIsInV0aWwiLCJ1dWlkVjQiLCJzdWJzdHJpbmciLCJzdWZmaXgiLCJ0cmFmZmljQ29sbGVjdG9yIiwib3B0cyIsImRldmljZSIsInBhcnNlSW50IiwiaXNOYU4iLCJlcnJvcnMiLCJJbnZhbGlkQXJndW1lbnRFcnJvciIsIm1vYmlsZVN0b3BQY2FwIiwiZW5jb2RlQmFzZTY0T3JVcGxvYWQiXSwic291cmNlcyI6WyIuLi8uLi8uLi9saWIvY29tbWFuZHMvcGNhcC5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgUHlpZGV2aWNlIGZyb20gJy4uL3B5LWlvcy1kZXZpY2UtY2xpZW50JztcbmltcG9ydCB7IGZzLCB0ZW1wRGlyLCBsb2dnZXIsIHV0aWwgfSBmcm9tICdhcHBpdW0vc3VwcG9ydCc7XG5pbXBvcnQgeyBlbmNvZGVCYXNlNjRPclVwbG9hZCB9IGZyb20gJy4uL3V0aWxzJztcbmltcG9ydCB7IGVycm9ycyB9IGZyb20gJ2FwcGl1bS9kcml2ZXInO1xuXG5cbmNvbnN0IE1BWF9DQVBUVVJFX1RJTUVfU0VDID0gNjAgKiA2MCAqIDEyO1xuY29uc3QgREVGQVVMVF9DQVBUVVJFX1RJTUVfU0VDID0gNjAgKiA1O1xuY29uc3QgREVGQVVMVF9FWFQgPSAnLnBjYXAnO1xuY29uc3QgcGNhcExvZ2dlciA9IGxvZ2dlci5nZXRMb2dnZXIoJ3BjYXBkJyk7XG5cbmNvbnN0IGNvbW1hbmRzID0ge307XG5cblxuY2xhc3MgVHJhZmZpY0NhcHR1cmUge1xuICBjb25zdHJ1Y3RvciAodWRpZCwgbG9nLCByZXN1bHRQYXRoKSB7XG4gICAgdGhpcy51ZGlkID0gdWRpZDtcbiAgICB0aGlzLmxvZyA9IGxvZztcbiAgICB0aGlzLnJlc3VsdFBhdGggPSByZXN1bHRQYXRoO1xuICAgIHRoaXMubWFpblByb2Nlc3MgPSBudWxsO1xuICB9XG5cbiAgYXN5bmMgc3RhcnQgKHRpbWVvdXRTZWNvbmRzKSB7XG4gICAgdGhpcy5tYWluUHJvY2VzcyA9IGF3YWl0IG5ldyBQeWlkZXZpY2UodGhpcy51ZGlkKS5jb2xsZWN0UGNhcCh0aGlzLnJlc3VsdFBhdGgpO1xuICAgIHRoaXMubWFpblByb2Nlc3Mub24oJ291dHB1dCcsIChzdGRvdXQsIHN0ZGVycikgPT4ge1xuICAgICAgaWYgKHN0ZGVycikge1xuICAgICAgICBwY2FwTG9nZ2VyLmluZm8oYCR7c3RkZXJyfWApO1xuICAgICAgfVxuICAgIH0pO1xuICAgIHRoaXMubG9nLmluZm8oYFN0YXJ0aW5nIG5ldHdvcmsgdHJhZmZpYyBjYXB0dXJlIHNlc3Npb24gb24gdGhlIGRldmljZSAnJHt0aGlzLnVkaWR9Jy4gYCArXG4gICAgICBgV2lsbCB0aW1lb3V0IGluICR7dGltZW91dFNlY29uZHN9c2ApO1xuICAgIHNldFRpbWVvdXQoYXN5bmMgKCkgPT4gYXdhaXQgdGhpcy5pbnRlcnJ1cHQoKSwgdGltZW91dFNlY29uZHMgKiAxMDAwKTtcbiAgICB0aGlzLm1haW5Qcm9jZXNzLm9uY2UoJ2V4aXQnLCAoY29kZSwgc2lnbmFsKSA9PiB7XG4gICAgICB0aGlzLmxvZy5kZWJ1ZyhgVGhlIHRyYWZmaWMgY2FwdHVyZSBzZXNzaW9uIG9uIHRoZSBkZXZpY2UgJyR7dGhpcy51ZGlkfScgaGFzIGV4aXRlZCBgICtcbiAgICAgICAgYHdpdGggY29kZSAke2NvZGV9LCBzaWduYWwgJHtzaWduYWx9YCk7XG4gICAgfSk7XG4gIH1cblxuICBpc0NhcHR1cmluZyAoKSB7XG4gICAgcmV0dXJuICEhKHRoaXMubWFpblByb2Nlc3M/LmlzUnVubmluZyk7XG4gIH1cblxuICBhc3luYyBpbnRlcnJ1cHQgKGZvcmNlID0gZmFsc2UpIHtcbiAgICBpZiAodGhpcy5pc0NhcHR1cmluZygpKSB7XG4gICAgICBjb25zdCBpbnRlcnJ1cHRQcm9taXNlID0gdGhpcy5tYWluUHJvY2Vzcy5zdG9wKGZvcmNlID8gJ1NJR1RFUk0nIDogJ1NJR0lOVCcpO1xuICAgICAgdGhpcy5tYWluUHJvY2VzcyA9IG51bGw7XG4gICAgICB0cnkge1xuICAgICAgICBhd2FpdCBpbnRlcnJ1cHRQcm9taXNlO1xuICAgICAgfSBjYXRjaCAoZSkge1xuICAgICAgICB0aGlzLmxvZy53YXJuKGBDYW5ub3QgJHtmb3JjZSA/ICd0ZXJtaW5hdGUnIDogJ2ludGVycnVwdCd9IHRoZSB0cmFmZmljIGNhcHR1cmUgc2Vzc2lvbi4gYCArXG4gICAgICAgICAgYE9yaWdpbmFsIGVycm9yOiAke2UubWVzc2FnZX1gKTtcbiAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgfVxuICAgIH1cblxuICAgIHJldHVybiB0cnVlO1xuICB9XG5cbiAgYXN5bmMgZmluaXNoICgpIHtcbiAgICBhd2FpdCB0aGlzLmludGVycnVwdCgpO1xuICAgIHJldHVybiB0aGlzLnJlc3VsdFBhdGg7XG4gIH1cblxuICBhc3luYyBjbGVhbnVwICgpIHtcbiAgICBpZiAoYXdhaXQgZnMuZXhpc3RzKHRoaXMucmVzdWx0UGF0aCkpIHtcbiAgICAgIGF3YWl0IGZzLnJpbXJhZih0aGlzLnJlc3VsdFBhdGgpO1xuICAgIH1cbiAgfVxufVxuXG5cbi8qKlxuICogQHR5cGVkZWYge09iamVjdH0gU3RhcnRDYXB0dXJlT3B0aW9uc1xuICpcbiAqIEBwcm9wZXJ0eSB7P3N0cmluZ3xudW1iZXJ9IHRpbWVMaW1pdFNlYyBbMTgwXSAtIFRoZSBtYXhpbXVtIHRyYWZmaWMgY2FwdHVyZSB0aW1lLCBpbiBzZWNvbmRzLlxuICogVGhlIGRlZmF1bHQgdmFsdWUgaXMgMTgwLCB0aGUgbWF4aW11bSB2YWx1ZSBpcyA0MzIwMCAoMTIgaG91cnMpLlxuICogQHByb3BlcnR5IHs/Ym9vbGVhbn0gZm9yY2VSZXN0YXJ0IFtmYWxzZV0gLSBXaGV0aGVyIHRvIHJlc3RhcnQgYXVkaW8gY2FwdHVyZSBwcm9jZXNzIGZvcmNlZnVsbHkgd2hlblxuICogc3RhcnRQY2FwIGlzIGNhbGxlZCAoYHRydWVgKSBvciBpZ25vcmUgdGhlIGNhbGwgdW50aWwgdGhlIGN1cnJlbnQgbmV0d29yayB0cmFmZmljIGNhcHR1cmUgaXMgY29tcGxldGVkLlxuICovXG5cbi8qKlxuICogUmVjb3JkcyB0aGUgZ2l2ZW4gbmV0d29yayB0cmFmZmljIGNhcHR1cmUgaW50byBhIC5wY2FwIGZpbGUuXG4gKlxuICogQHBhcmFtIHs/U3RhcnRDYXB0dXJlT3B0aW9uc30gb3B0aW9ucyAtIFRoZSBhdmFpbGFibGUgb3B0aW9ucy5cbiAqIEB0aHJvd3Mge0Vycm9yfSBJZiBuZXR3b3JrIHRyYWZmaWMgY2FwdHVyZSBoYXMgZmFpbGVkIHRvIHN0YXJ0LlxuICovXG5jb21tYW5kcy5tb2JpbGVTdGFydFBjYXAgPSBhc3luYyBmdW5jdGlvbiBtb2JpbGVTdGFydFBjYXAgKG9wdGlvbnMgPSB7fSkge1xuICBpZiAodGhpcy5pc1NpbXVsYXRvcigpKSB7XG4gICAgdGhpcy5sb2cuZXJyb3JBbmRUaHJvdygnTmV0d29yayB0cmFmZmljIGNhcHR1cmUgb25seSB3b3JrcyBvbiByZWFsIGRldmljZXMnKTtcbiAgfVxuXG4gIGNvbnN0IHtcbiAgICB0aW1lTGltaXRTZWMgPSBERUZBVUxUX0NBUFRVUkVfVElNRV9TRUMsXG4gICAgZm9yY2VSZXN0YXJ0LFxuICB9ID0gb3B0aW9ucztcblxuICBpZiAodGhpcy5fdHJhZmZpY0NhcHR1cmU/LmlzQ2FwdHVyaW5nKCkpIHtcbiAgICB0aGlzLmxvZy5pbmZvKGBUaGVyZSBpcyBhbiBhY3RpdmUgdHJhZmZpYyBjYXB0dXJlIHByb2Nlc3NgKTtcbiAgICBpZiAoZm9yY2VSZXN0YXJ0KSB7XG4gICAgICB0aGlzLmxvZy5pbmZvKGBTdG9wcGluZyBpdCBiZWNhdXNlICdmb3JjZVJlc3RhcnQnIG9wdGlvbiBpcyBzZXQgdG8gdHJ1ZWApO1xuICAgICAgYXdhaXQgdGhpcy5fdHJhZmZpY0NhcHR1cmUuaW50ZXJydXB0KHRydWUpO1xuICAgIH0gZWxzZSB7XG4gICAgICB0aGlzLmxvZy5pbmZvKGBEb2luZyBub3RoaW5nLiBgICtcbiAgICAgICAgYFNldCAnZm9yY2VSZXN0YXJ0JyBvcHRpb24gdG8gdHJ1ZSBpZiB5b3UnZCBsaWtlIHRvIHN0YXJ0IGEgbmV3IHRyYWZmaWMgY2FwdHVyZSBzZXNzaW9uYCk7XG4gICAgICByZXR1cm47XG4gICAgfVxuICB9XG4gIGlmICh0aGlzLl90cmFmZmljQ2FwdHVyZSkge1xuICAgIGF3YWl0IHRoaXMuX3RyYWZmaWNDYXB0dXJlLmNsZWFudXAoKTtcbiAgICB0aGlzLl90cmFmZmljQ2FwdHVyZSA9IG51bGw7XG4gIH1cblxuICBjb25zdCByZXN1bHRQYXRoID0gYXdhaXQgdGVtcERpci5wYXRoKHtcbiAgICBwcmVmaXg6IGBhcHBpdW1fJHt1dGlsLnV1aWRWNCgpLnN1YnN0cmluZygwLCA4KX1gLFxuICAgIHN1ZmZpeDogREVGQVVMVF9FWFQsXG4gIH0pO1xuXG4gIGNvbnN0IHRyYWZmaWNDb2xsZWN0b3IgPSBuZXcgVHJhZmZpY0NhcHR1cmUodGhpcy5vcHRzLmRldmljZS51ZGlkLCB0aGlzLmxvZywgcmVzdWx0UGF0aCk7XG5cbiAgY29uc3QgdGltZW91dFNlY29uZHMgPSBwYXJzZUludCh0aW1lTGltaXRTZWMsIDEwKTtcbiAgaWYgKGlzTmFOKHRpbWVvdXRTZWNvbmRzKSB8fCB0aW1lb3V0U2Vjb25kcyA+IE1BWF9DQVBUVVJFX1RJTUVfU0VDIHx8IHRpbWVvdXRTZWNvbmRzIDw9IDApIHtcbiAgICB0aHJvdyBuZXcgZXJyb3JzLkludmFsaWRBcmd1bWVudEVycm9yKGBUaGUgdGltZUxpbWl0U2VjIHZhbHVlIG11c3QgYmUgaW4gcmFuZ2UgWzEsICR7TUFYX0NBUFRVUkVfVElNRV9TRUN9XSBzZWNvbmRzLiBgICtcbiAgICAgIGBUaGUgdmFsdWUgb2YgJyR7dGltZUxpbWl0U2VjfScgaGFzIGJlZW4gcGFzc2VkIGluc3RlYWQuYCk7XG4gIH1cblxuICB0cnkge1xuICAgIGF3YWl0IHRyYWZmaWNDb2xsZWN0b3Iuc3RhcnQodGltZW91dFNlY29uZHMpO1xuICB9IGNhdGNoIChlKSB7XG4gICAgYXdhaXQgdHJhZmZpY0NvbGxlY3Rvci5pbnRlcnJ1cHQodHJ1ZSk7XG4gICAgYXdhaXQgdHJhZmZpY0NvbGxlY3Rvci5jbGVhbnVwKCk7XG4gICAgdGhyb3cgZTtcbiAgfVxuICB0aGlzLl90cmFmZmljQ2FwdHVyZSA9IHRyYWZmaWNDb2xsZWN0b3I7XG59O1xuXG4vKipcbiAqIFN0b3AgY2FwdHVyZSBvZiB0aGUgZGV2aWNlIG5ldHdvcmsgdHJhZmZpYy4gSWYgbm8gdHJhZmZpYyBjYXB0dXJlIHByb2Nlc3MgaXMgcnVubmluZyB0aGVuXG4gKiB0aGUgZW5kcG9pbnQgd2lsbCB0cnkgdG8gZ2V0IHRoZSByZWNlbnRseSByZWNvcmRlZCBmaWxlLlxuICogSWYgbm8gcHJldmlvdXNseSByZWNvcmRlZCBmaWxlIGlzIGZvdW5kIGFuZCBubyBhY3RpdmUgdHJhZmZpYyBjYXB0dXJlXG4gKiBwcm9jZXNzZXMgYXJlIHJ1bm5pbmcgdGhlbiB0aGUgbWV0aG9kIHJldHVybnMgYW4gZW1wdHkgc3RyaW5nLlxuICpcbiAqIEByZXR1cm5zIHtzdHJpbmd9IEJhc2U2NC1lbmNvZGVkIGNvbnRlbnQgb2YgdGhlIHJlY29yZGVkIHBjYXAgZmlsZSBvciBhblxuICogZW1wdHkgc3RyaW5nIGlmIG5vIHRyYWZmaWMgY2FwdHVyZSBoYXMgYmVlbiBzdGFydGVkIGJlZm9yZS5cbiAqIEB0aHJvd3Mge0Vycm9yfSBJZiB0aGVyZSB3YXMgYW4gZXJyb3Igd2hpbGUgZ2V0dGluZyB0aGUgY2FwdHVyZSBmaWxlLlxuICovXG5jb21tYW5kcy5tb2JpbGVTdG9wUGNhcCA9IGFzeW5jIGZ1bmN0aW9uIG1vYmlsZVN0b3BQY2FwICgpIHtcbiAgaWYgKCF0aGlzLl90cmFmZmljQ2FwdHVyZSkge1xuICAgIHRoaXMubG9nLmluZm8oJ05ldHdvcmsgdHJhZmZpYyBjb2xsZWN0b3IgaGFzIG5vdCBiZWVuIHN0YXJ0ZWQuIFRoZXJlIGlzIG5vdGhpbmcgdG8gc3RvcCcpO1xuICAgIHJldHVybiAnJztcbiAgfVxuXG4gIGxldCByZXN1bHRQYXRoO1xuICB0cnkge1xuICAgIHJlc3VsdFBhdGggPSBhd2FpdCB0aGlzLl90cmFmZmljQ2FwdHVyZS5maW5pc2goKTtcbiAgICBpZiAoIWF3YWl0IGZzLmV4aXN0cyhyZXN1bHRQYXRoKSkge1xuICAgICAgdGhpcy5sb2cuZXJyb3JBbmRUaHJvdyhgVGhlIG5ldHdvcmsgdHJhZmZpYyBjYXB0dXJlIHV0aWxpdHkgaGFzIGZhaWxlZCBgICtcbiAgICAgICAgYHRvIHN0b3JlIHRoZSBhY3R1YWwgdHJhZmZpYyBjYXB0dXJlIGF0ICcke3Jlc3VsdFBhdGh9J2ApO1xuICAgIH1cbiAgfSBjYXRjaCAoZSkge1xuICAgIGF3YWl0IHRoaXMuX3RyYWZmaWNDYXB0dXJlLmludGVycnVwdCh0cnVlKTtcbiAgICBhd2FpdCB0aGlzLl90cmFmZmljQ2FwdHVyZS5jbGVhbnVwKCk7XG4gICAgdGhpcy5fdHJhZmZpY0NhcHR1cmUgPSBudWxsO1xuICAgIHRocm93IGU7XG4gIH1cbiAgcmV0dXJuIGF3YWl0IGVuY29kZUJhc2U2NE9yVXBsb2FkKHJlc3VsdFBhdGgpO1xufTtcblxuZXhwb3J0IHsgY29tbWFuZHMgfTtcbmV4cG9ydCBkZWZhdWx0IGNvbW1hbmRzO1xuIl0sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7OztBQUFBOztBQUNBOztBQUNBOztBQUNBOztBQUdBLE1BQU1BLG9CQUFvQixHQUFHLEtBQUssRUFBTCxHQUFVLEVBQXZDO0FBQ0EsTUFBTUMsd0JBQXdCLEdBQUcsS0FBSyxDQUF0QztBQUNBLE1BQU1DLFdBQVcsR0FBRyxPQUFwQjs7QUFDQSxNQUFNQyxVQUFVLEdBQUdDLGVBQUEsQ0FBT0MsU0FBUCxDQUFpQixPQUFqQixDQUFuQjs7QUFFQSxNQUFNQyxRQUFRLEdBQUcsRUFBakI7OztBQUdBLE1BQU1DLGNBQU4sQ0FBcUI7RUFDbkJDLFdBQVcsQ0FBRUMsSUFBRixFQUFRQyxHQUFSLEVBQWFDLFVBQWIsRUFBeUI7SUFDbEMsS0FBS0YsSUFBTCxHQUFZQSxJQUFaO0lBQ0EsS0FBS0MsR0FBTCxHQUFXQSxHQUFYO0lBQ0EsS0FBS0MsVUFBTCxHQUFrQkEsVUFBbEI7SUFDQSxLQUFLQyxXQUFMLEdBQW1CLElBQW5CO0VBQ0Q7O0VBRVUsTUFBTEMsS0FBSyxDQUFFQyxjQUFGLEVBQWtCO0lBQzNCLEtBQUtGLFdBQUwsR0FBbUIsTUFBTSxJQUFJRywwQkFBSixDQUFjLEtBQUtOLElBQW5CLEVBQXlCTyxXQUF6QixDQUFxQyxLQUFLTCxVQUExQyxDQUF6QjtJQUNBLEtBQUtDLFdBQUwsQ0FBaUJLLEVBQWpCLENBQW9CLFFBQXBCLEVBQThCLENBQUNDLE1BQUQsRUFBU0MsTUFBVCxLQUFvQjtNQUNoRCxJQUFJQSxNQUFKLEVBQVk7UUFDVmhCLFVBQVUsQ0FBQ2lCLElBQVgsQ0FBaUIsR0FBRUQsTUFBTyxFQUExQjtNQUNEO0lBQ0YsQ0FKRDtJQUtBLEtBQUtULEdBQUwsQ0FBU1UsSUFBVCxDQUFlLDJEQUEwRCxLQUFLWCxJ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