{"version":3,"file":"general.js","names":["commands","helpers","extensions","MOMENT_FORMAT_ISO8601","active","isWebContext","cacheWebElements","executeAtom","proxyCommand","background","seconds","homescreen","deactivateApp","endpoint","params","selectEndpoint","timeoutSeconds","util","hasValue","isNaN","duration","parseFloat","_","has","timeout","errors","InvalidArgumentError","JSON","stringify","touchId","match","mobileSendBiometricMatch","toggleEnrollTouchId","isEnabled","mobileEnrollBiometric","getWindowSizeWeb","getWindowSizeNative","getWindowSize","windowHandle","NotYetImplementedError","getDeviceTime","format","log","info","isRealDevice","cmd","args","inputFormat","stdout","exec","trim","debug","join","parsedTimestamp","moment","utc","isValid","warn","utcOffset","_tzm","timestamp","timeZone","utilities","opts","udid","unix","Math","abs","includes","tz","mobileGetDeviceTime","getWindowRect","width","height","x","y","hideKeyboard","strategy","possibleKeys","keyNames","compact","slice","map","push","getStrings","language","stringFile","parseLocalizableStrings","Object","assign","strictMode","removeApp","bundleId","mobileRemoveApp","launchApp","appName","app","start","err","closeApp","stop","keys","UnknownError","el","unwrapElement","isEmpty","NoSuchElementError","setValue","setUrl","url","setCurrentUrl","curWebFrames","remote","navToUrl","device","simctl","openUrl","getViewportRect","scale","getDevicePixelRatio","statusBarHeight","round","getStatusBarHeight","windowSize","left","top","getScreenInfo","statusBarSize","mobilePressButton","name","durationSeconds","isNil","isNumber","mobileSiriCommand","text"],"sources":["../../../lib/commands/general.js"],"sourcesContent":["import _ from 'lodash';\nimport { errors } from 'appium/driver';\nimport { util } from 'appium/support';\nimport moment from 'moment-timezone';\nimport { utilities } from 'appium-ios-device';\nimport { exec } from 'teen_process';\nimport { parseLocalizableStrings } from '../app-utils';\n\nlet commands = {}, helpers = {}, extensions = {};\n\nconst MOMENT_FORMAT_ISO8601 = 'YYYY-MM-DDTHH:mm:ssZ';\n\n\ncommands.active = async function active () {\n  if (this.isWebContext()) {\n    return this.cacheWebElements(await this.executeAtom('active_element', []));\n  }\n  return await this.proxyCommand(`/element/active`, 'GET');\n};\n\n/**\n * Close app (simulate device home button). It is possible to restore\n * the app after the timeout or keep it minimized based on the parameter value.\n *\n * @param {?number|Object} seconds\n * - any positive number of seconds: come back after X seconds\n * - any negative number of seconds or zero: never come back\n * - undefined/null: never come back\n * - {timeout: 5000}: come back after 5 seconds\n * - {timeout: null}, {timeout: -2}: never come back\n */\ncommands.background = async function background (seconds) {\n  const homescreen = '/wda/homescreen';\n  const deactivateApp = '/wda/deactivateApp';\n\n  let endpoint;\n  let params = {};\n  const selectEndpoint = (timeoutSeconds) => {\n    if (!util.hasValue(timeoutSeconds)) {\n      endpoint = homescreen;\n    } else if (!isNaN(timeoutSeconds)) {\n      const duration = parseFloat(timeoutSeconds);\n      if (duration >= 0) {\n        params = {duration};\n        endpoint = deactivateApp;\n      } else {\n        endpoint = homescreen;\n      }\n    }\n  };\n  if (_.has(seconds, 'timeout')) {\n    const {timeout} = seconds;\n    selectEndpoint(isNaN(timeout) ? timeout : parseFloat(timeout) / 1000.0);\n  } else {\n    selectEndpoint(seconds);\n  }\n  if (!endpoint) {\n    throw new errors.InvalidArgumentError(`Argument value is expected to be a valid number. ` +\n      `${JSON.stringify(seconds)} has been provided instead`);\n  }\n  return await this.proxyCommand(endpoint, 'POST', params, endpoint !== homescreen);\n};\n\ncommands.touchId = async function touchId (match = true) {\n  await this.mobileSendBiometricMatch({match});\n};\n\ncommands.toggleEnrollTouchId = async function toggleEnrollTouchId (isEnabled = true) {\n  await this.mobileEnrollBiometric({isEnabled});\n};\n\nhelpers.getWindowSizeWeb = async function getWindowSizeWeb () {\n  return await this.executeAtom('get_window_size', []);\n};\n\nhelpers.getWindowSizeNative = async function getWindowSizeNative () {\n  return await this.proxyCommand(`/window/size`, 'GET');\n};\n\ncommands.getWindowSize = async function getWindowSize (windowHandle = 'current') {\n  if (windowHandle !== 'current') {\n    throw new errors.NotYetImplementedError('Currently only getting current window size is supported.');\n  }\n\n  if (!this.isWebContext()) {\n    return await this.getWindowSizeNative();\n  } else {\n    return await this.getWindowSizeWeb();\n  }\n};\n\n/**\n * Retrieves the current device's timestamp.\n *\n * @param {string} format - The set of format specifiers. Read\n *                          https://momentjs.com/docs/ to get the full list of supported\n *                          datetime format specifiers. The default format is\n *                          `YYYY-MM-DDTHH:mm:ssZ`, which complies to ISO-8601\n * @returns Formatted datetime string or the raw command output if formatting fails\n */\ncommands.getDeviceTime = async function getDeviceTime (format = MOMENT_FORMAT_ISO8601) {\n  this.log.info('Attempting to capture iOS device date and time');\n  if (!this.isRealDevice()) {\n    this.log.info('On simulator. Assuming device time is the same as host time');\n    const cmd = 'date';\n    const args = ['+%Y-%m-%dT%H:%M:%S%z'];\n    const inputFormat = 'YYYY-MM-DDTHH:mm:ssZZ';\n    const stdout = (await exec(cmd, args)).stdout.trim();\n    this.log.debug(`Got the following output out of '${cmd} ${args.join(' ')}': ${stdout}`);\n    const parsedTimestamp = moment.utc(stdout, inputFormat);\n    if (!parsedTimestamp.isValid()) {\n      this.log.warn(`Cannot parse the timestamp '${stdout}' returned by '${cmd}' command. Returning it as is`);\n      return stdout;\n    }\n    return parsedTimestamp.utcOffset(parsedTimestamp._tzm || 0).format(format);\n  }\n\n  const {\n    timestamp,\n    utcOffset,\n    timeZone,\n  } = await utilities.getDeviceTime(this.opts.udid);\n  this.log.debug(`timestamp: ${timestamp}, utcOffset: ${utcOffset}, timeZone: ${timeZone}`);\n  const utc = moment.unix(timestamp).utc();\n  // at some point of time Apple started to return timestamps\n  // in utcOffset instead of actual UTC offsets\n  if (Math.abs(utcOffset) <= 12 * 60) {\n    return utc.utcOffset(utcOffset).format(format);\n  }\n  // timeZone could either be a time zone name or\n  // an UTC offset in seconds\n  if (_.includes(timeZone, '/')) {\n    return utc.tz(timeZone).format(format);\n  }\n  if (Math.abs(timeZone) <= 12 * 60 * 60) {\n    return utc.utcOffset(timeZone / 60).format(format);\n  }\n  this.log.warn('Did not know how to apply the UTC offset. Returning the timestamp without it');\n  return utc.format(format);\n};\n\n/**\n * @typedef {Object} DeviceTimeOptions\n * @property {string} format [YYYY-MM-DDTHH:mm:ssZ] - See getDeviceTime#format\n */\n\n/**\n * Retrieves the current device time\n *\n * @param {DeviceTimeOptions} opts\n * @return {string} Formatted datetime string or the raw command output if formatting fails\n */\ncommands.mobileGetDeviceTime = async function mobileGetDeviceTime (opts = {}) {\n  return await this.getDeviceTime(opts.format);\n};\n\n// For W3C\ncommands.getWindowRect = async function getWindowRect () {\n  const {width, height} = await this.getWindowSize();\n  return {\n    width,\n    height,\n    x: 0,\n    y: 0\n  };\n};\n\ncommands.hideKeyboard = async function hideKeyboard (strategy, ...possibleKeys) {\n  // last parameter is the session id\n  const keyNames = _.compact(possibleKeys.slice(0, -1)).map((x) => `${x}`);\n  if (!keyNames.includes('done')) {\n    keyNames.push('done');\n  }\n  await this.proxyCommand('/wda/keyboard/dismiss', 'POST', {keyNames});\n};\n\ncommands.getStrings = async function getStrings (language, stringFile = null) {\n  this.log.debug(`Gettings strings for language '${language}' and string file '${stringFile}'`);\n  return await parseLocalizableStrings(Object.assign({}, this.opts, {\n    language,\n    stringFile,\n    strictMode: true,\n  }));\n};\n\ncommands.removeApp = async function removeApp (bundleId) {\n  return await this.mobileRemoveApp({bundleId});\n};\n\ncommands.launchApp = async function launchApp () {\n  const appName = this.opts.app || this.opts.bundleId;\n  try {\n    await this.start();\n    this.log.info(`Successfully launched the '${appName}' app.`);\n  } catch (err) {\n    this.log.warn(`Something went wrong while launching the '${appName}' app.`);\n    throw err;\n  }\n};\n\ncommands.closeApp = async function closeApp () {\n  const appName = this.opts.app || this.opts.bundleId;\n  try {\n    await this.stop();\n    this.log.info(`Successfully closed the '${appName}' app.`);\n  } catch (err) {\n    this.log.warn(`Something went wrong while closing the '${appName}' app.`);\n    throw err;\n  }\n};\n\ncommands.keys = async function keys (keys) {\n  if (!this.isWebContext()) {\n    throw new errors.UnknownError('Command should be proxied to WDA');\n  }\n  let el = util.unwrapElement(await this.active());\n  if (_.isEmpty(el)) {\n    throw new errors.NoSuchElementError();\n  }\n  await this.setValue(keys, el);\n};\n\ncommands.setUrl = async function setUrl (url) {\n  this.log.debug(`Attempting to set url '${url}'`);\n\n  if (this.isWebContext()) {\n    this.setCurrentUrl(url);\n    // make sure to clear out any leftover web frames\n    this.curWebFrames = [];\n    await this.remote.navToUrl(url);\n    return;\n  }\n\n  if (this.isRealDevice()) {\n    await this.proxyCommand('/url', 'POST', {url});\n  } else {\n    await this.opts.device.simctl.openUrl(url);\n  }\n};\n\ncommands.getViewportRect = async function getViewportRect () {\n  const scale = await this.getDevicePixelRatio();\n  // status bar height comes in unscaled, so scale it\n  const statusBarHeight = Math.round(await this.getStatusBarHeight() * scale);\n  const windowSize = await this.getWindowSize();\n\n  // ios returns coordinates/dimensions in logical pixels, not device pixels,\n  // so scale up to device pixels. status bar height is already scaled.\n  return {\n    left: 0,\n    top: statusBarHeight,\n    width: windowSize.width * scale,\n    height: ((windowSize.height * scale) - statusBarHeight),\n  };\n};\n\n// memoized in constructor\ncommands.getScreenInfo = async function getScreenInfo () {\n  return await this.proxyCommand('/wda/screen', 'GET');\n};\n\ncommands.getStatusBarHeight = async function getStatusBarHeight () {\n  const {statusBarSize} = await this.getScreenInfo();\n  return statusBarSize.height;\n};\n\n// memoized in constructor\ncommands.getDevicePixelRatio = async function getDevicePixelRatio () {\n  const {scale} = await this.getScreenInfo();\n  return scale;\n};\n\n/**\n * @typedef {Object} PressButtonOptions\n * @property {string} name - The name of the button to be pressed.\n * @property {?number} durationSeconds - Duration in float seconds.\n */\n\n/**\n * Emulates press the given devive button name.\n *\n * @param {PressButtonOptions} opts\n */\ncommands.mobilePressButton = async function mobilePressButton (opts = {}) {\n  const {name, durationSeconds} = opts;\n  if (!name) {\n    throw new errors.InvalidArgumentError('Button name is mandatory');\n  }\n  if (!_.isNil(durationSeconds) && !_.isNumber(durationSeconds)) {\n    throw new errors.InvalidArgumentError('durationSeconds should be a number');\n  }\n  return await this.proxyCommand('/wda/pressButton', 'POST',\n    {name, duration: durationSeconds});\n};\n\ncommands.mobileSiriCommand = async function mobileSiriCommand (opts = {}) {\n  const {text} = opts;\n  if (!util.hasValue(text)) {\n    throw new errors.InvalidArgumentError('\"text\" argument is mandatory');\n  }\n  return await this.proxyCommand('/wda/siri/activate', 'POST', {text});\n};\n\nObject.assign(extensions, commands, helpers);\n\nexport { commands, helpers, extensions };\nexport default extensions;\n"],"mappings":"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"}