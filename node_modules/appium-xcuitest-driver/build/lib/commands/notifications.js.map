{"version":3,"file":"notifications.js","names":["extensions","mobilePushNotification","opts","isSimulator","Error","payload","bundleId","errors","InvalidArgumentError","_","isPlainObject","JSON","stringify","aps","device","pushNotification","mobileExpectNotification","name","type","timeoutSeconds","proxyCommand","timeout"],"sources":["../../../lib/commands/notifications.js"],"sourcesContent":["import { errors } from 'appium/driver';\nimport _ from 'lodash';\n\nconst extensions = {};\n\n/**\n * @typedef {Object} PushNotification\n *\n * @property {!string} bundleId - The bundle identifier of the target application\n * @property {!object} payload - Remote notification payload. Read the `Create the JSON Payload` topic of\n * https://developer.apple.com/documentation/usernotifications/setting_up_a_remote_notification_server/generating_a_remote_notification\n * for more details on how to create this payload.\n */\n\n/**\n * Simulates push notification delivery to Simulator.\n * Only application remote push notifications are supported. VoIP, Complication, File Provider,\n * and other types are not supported\n *\n * @since Xcode SDK 11.4\n * @param {PushNotification} opts - The object that describes Apple push notification content.\n * It must contain a top-level `bundleId` key with a string value matching\n * the target applicationâ€˜s bundle identifier and \"payload.aps\" key with valid Apple Push Notification values.\n * Check the output of `xcrun simctl help push` command for more details.\n */\nextensions.mobilePushNotification = async function mobilePushNotification (opts = {}) {\n  if (!this.isSimulator()) {\n    throw new Error('This extension only works on Simulator');\n  }\n\n  const { payload, bundleId } = opts;\n  if (!bundleId) {\n    throw new errors.InvalidArgumentError(`'bundleId' argument must be a valid bundle identifier string`);\n  }\n  if (!_.isPlainObject(payload)) {\n    throw new errors.InvalidArgumentError(`The 'payload' argument value must be a valid dictionary. ` +\n      `Got ${JSON.stringify(payload)} instead`);\n  }\n  if (!_.isPlainObject(payload.aps)) {\n    throw new errors.InvalidArgumentError(`The 'payload.aps' value must be a valid dictionary. ` +\n      `Got ${JSON.stringify(payload.aps)} instead`);\n  }\n  return await this.opts.device.pushNotification({\n    ...payload,\n    'Simulator Target Bundle': bundleId,\n  });\n};\n\n\n/**\n * @typedef {Object} NotificationExpectationOptions\n *\n * @property {!string} name - The name of the notification to expect\n * @property {?string} type [plain] - Which notification type to expect.\n * Either 'plain' to wait for a notification from the default notification center or 'darwin'\n * to wait for a system notification.\n * @property {number} timeoutSeconds [60] - For how long to wait until the notification is delivered\n * in float seconds.\n */\n\n/**\n * Blocks until the expected notification is delivered.\n * This method is a thin wrapper over XCTNSNotificationExpectation and\n * XCTDarwinNotificationExpectation entities.\n *\n * @param {NotificationExpectationOptions} opts\n * @throws TimeoutError if the expected notification has not been delivered within the given timeout\n */\nextensions.mobileExpectNotification = async function mobileExpectNotification (opts = {}) {\n  const { name, type, timeoutSeconds } = opts;\n  return await this.proxyCommand('/wda/expectNotification', 'POST', {\n    name,\n    type,\n    timeout: timeoutSeconds,\n  });\n};\n\nexport default extensions;\n"],"mappings":";;;;;;;;;;;AAAA;;AACA;;AAEA,MAAMA,UAAU,GAAG,EAAnB;;AAsBAA,UAAU,CAACC,sBAAX,GAAoC,eAAeA,sBAAf,CAAuCC,IAAI,GAAG,EAA9C,EAAkD;EACpF,IAAI,CAAC,KAAKC,WAAL,EAAL,EAAyB;IACvB,MAAM,IAAIC,KAAJ,CAAU,wCAAV,CAAN;EACD;;EAED,MAAM;IAAEC,OAAF;IAAWC;EAAX,IAAwBJ,IAA9B;;EACA,IAAI,CAACI,QAAL,EAAe;IACb,MAAM,IAAIC,cAAA,CAAOC,oBAAX,CAAiC,8DAAjC,CAAN;EACD;;EACD,IAAI,CAACC,eAAA,CAAEC,aAAF,CAAgBL,OAAhB,CAAL,EAA+B;IAC7B,MAAM,IAAIE,cAAA,CAAOC,oBAAX,CAAiC,2DAAD,GACnC,OAAMG,IAAI,CAACC,SAAL,CAAeP,OAAf,CAAwB,UAD3B,CAAN;EAED;;EACD,IAAI,CAACI,eAAA,CAAEC,aAAF,CAAgBL,OAAO,CAACQ,GAAxB,CAAL,EAAmC;IACjC,MAAM,IAAIN,cAAA,CAAOC,oBAAX,CAAiC,sDAAD,GACnC,OAAMG,IAAI,CAACC,SAAL,CAAeP,OAAO,CAACQ,GAAvB,CAA4B,UAD/B,CAAN;EAED;;EACD,OAAO,MAAM,KAAKX,IAAL,CAAUY,MAAV,CAAiBC,gBAAjB,CAAkC,EAC7C,GAAGV,OAD0C;IAE7C,2BAA2BC;EAFkB,CAAlC,CAAb;AAID,CArBD;;AA2CAN,UAAU,CAACgB,wBAAX,GAAsC,eAAeA,wBAAf,CAAyCd,IAAI,GAAG,EAAhD,EAAoD;EACxF,MAAM;IAAEe,IAAF;IAAQC,IAAR;IAAcC;EAAd,IAAiCjB,IAAvC;EACA,OAAO,MAAM,KAAKkB,YAAL,CAAkB,yBAAlB,EAA6C,MAA7C,EAAqD;IAChEH,IADgE;IAEhEC,IAFgE;IAGhEG,OAAO,EAAEF;EAHuD,CAArD,CAAb;AAKD,CAPD;;eASenB,U"}