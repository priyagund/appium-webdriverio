{"version":3,"file":"cookies.js","names":["log","logger","getLogger","convertCookie","value","converter","indexOf","slice","replace","parsedValue","decodeURIComponent","e","warn","createJSCookie","key","options","encodeURIComponent","expires","path","domain","secure","join","createJWPCookie","cookieString","result","cookies","split","cookie","parts","name","shift","val","getValue","_","isUndefined","expireCookie","assign"],"sources":["../../lib/cookies.js"],"sourcesContent":["/*\n * derived from jQuery Cookie Plugin v1.4.1\n * https://github.com/carhartl/jquery-cookie\n */\n\n// needed to communicate/translate between JSONWire cookies and regular JavaScript cookies\n\nimport _ from 'lodash';\nimport { logger } from 'appium/support';\n\n\nconst log = logger.getLogger('Cookie');\n\n// parses the value if needed and converts the value if a converter is provided\n// internal function, not exported\nfunction convertCookie (value, converter) {\n  if (value.indexOf('\"') === 0) {\n    // this is a quoted cookied according to RFC2068\n    // remove enclosing quotes and internal quotes and backslashes\n    value = value.slice(1, -1).replace(/\\\\\"/g, '\"').replace(/\\\\\\\\/g, '\\\\');\n  }\n\n  let parsedValue;\n  try {\n    parsedValue = decodeURIComponent(value.replace(/\\+/g, ' '));\n  } catch (e) {\n    // no need to fail if we can't decode\n    log.warn(e);\n  }\n\n  return converter ? converter(parsedValue) : parsedValue;\n}\n\n// takes arguments given and creates a JavaScript Cookie\nfunction createJSCookie (key, value, options = {}) {\n  return [\n    encodeURIComponent(key), '=', value,\n    options.expires\n      ? `; expires=${options.expires}`\n      : '',\n    options.path\n      ? `; path=${options.path}`\n      : '',\n    options.domain\n      ? `; domain=${options.domain}`\n      : '',\n    options.secure\n      ? '; secure'\n      : ''\n  ].join('');\n}\n\n// takes the JavaScript cookieString and translates it into a JSONWire formatted cookie\nfunction createJWPCookie (key, cookieString, converter = null) {\n  let result = {};\n  let cookies = cookieString ? cookieString.split('; ') : [];\n  for (let cookie of cookies) {\n    let parts = cookie.split('=');\n\n    // get the first and second element as name and value\n    let name = decodeURIComponent(parts.shift());\n    let val = parts[0];\n\n    // if name is key, this is the central element of the cookie, so add as `name`\n    // otherwise it is an optional element\n    if (key && key === name) {\n      result.name = key;\n      result.value = convertCookie(val, converter);\n    } else {\n      result[name] = convertCookie(val, converter);\n    }\n  }\n  return result;\n}\n\n// takes a JavaScript cookiestring and parses it for the value given the key\nfunction getValue (key, cookieString, converter = null) {\n  let result = createJWPCookie(key, cookieString, converter);\n\n  // if `key` is undefined we want the entire cookie\n  return _.isUndefined(key) ? result : result.value;\n}\n\n\n// returns a cookie that expires on 01 Jan 1970\n// assign the returned cookie to an existing cookie to delete that cookie\nfunction expireCookie (key, options) {\n  // override `expires` in `options`, and then make the cookie\n  return createJSCookie(key, '', _.assign({}, options, {\n    expires: 'Thu, 01 Jan 1970 00:00:00 GMT'\n  }));\n}\n\n// export individually and also (as default) as an object\nexport { createJSCookie, createJWPCookie, getValue, expireCookie };\nexport default { createJSCookie, createJWPCookie, getValue, expireCookie };\n"],"mappings":"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"}