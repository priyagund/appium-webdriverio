{"version":3,"file":"ios-performance-log.js","names":["log","logger","getLogger","MAX_EVENTS","IOSPerformanceLog","constructor","remoteDebugger","maxEvents","parseInt","timelineEvents","startCapture","debug","startTimeline","onTimelineEvent","bind","stopCapture","stopTimeline","event","_","truncate","JSON","stringify","push","length","removedEvent","shift","warn","getLogs","events","getAllLogs"],"sources":["../../../lib/device-log/ios-performance-log.js"],"sourcesContent":["import { logger } from 'appium/support';\nimport _ from 'lodash';\n\nconst log = logger.getLogger('IOSPerformanceLog');\nconst MAX_EVENTS = 5000;\n\nclass IOSPerformanceLog {\n  constructor (remoteDebugger, maxEvents = MAX_EVENTS) {\n    this.remoteDebugger = remoteDebugger;\n    this.maxEvents = parseInt(maxEvents, 10);\n\n    this.timelineEvents = [];\n  }\n\n  async startCapture () {\n    log.debug('Starting performance (Timeline) log capture');\n    this.timelineEvents = [];\n    return await this.remoteDebugger.startTimeline(this.onTimelineEvent.bind(this));\n  }\n\n  async stopCapture () {\n    log.debug('Stopping performance (Timeline) log capture');\n    return await this.remoteDebugger.stopTimeline();\n  }\n\n  onTimelineEvent (event) {\n    log.debug(`Received Timeline event: ${_.truncate(JSON.stringify(event))}`);\n    this.timelineEvents.push(event);\n\n    // if we have too many, get rid of the oldest log line\n    if (this.timelineEvents.length > this.maxEvents) {\n      let removedEvent = this.timelineEvents.shift();\n      log.warn(`Too many Timeline events, removing earliest: ${_.truncate(JSON.stringify(removedEvent))}`);\n    }\n  }\n\n  async getLogs () { // eslint-disable-line require-await\n    let events = this.timelineEvents;\n\n    // flush events\n    log.debug('Flushing Timeline events');\n    this.timelineEvents = [];\n\n    return events;\n  }\n\n  async getAllLogs () { // eslint-disable-line require-await\n    return this.getLogs();\n  }\n}\n\n\nexport { IOSPerformanceLog };\nexport default IOSPerformanceLog;\n"],"mappings":";;;;;;;;;;;AAAA;;AACA;;AAEA,MAAMA,GAAG,GAAGC,eAAA,CAAOC,SAAP,CAAiB,mBAAjB,CAAZ;;AACA,MAAMC,UAAU,GAAG,IAAnB;;AAEA,MAAMC,iBAAN,CAAwB;EACtBC,WAAW,CAAEC,cAAF,EAAkBC,SAAS,GAAGJ,UAA9B,EAA0C;IACnD,KAAKG,cAAL,GAAsBA,cAAtB;IACA,KAAKC,SAAL,GAAiBC,QAAQ,CAACD,SAAD,EAAY,EAAZ,CAAzB;IAEA,KAAKE,cAAL,GAAsB,EAAtB;EACD;;EAEiB,MAAZC,YAAY,GAAI;IACpBV,GAAG,CAACW,KAAJ,CAAU,6CAAV;IACA,KAAKF,cAAL,GAAsB,EAAtB;IACA,OAAO,MAAM,KAAKH,cAAL,CAAoBM,aAApB,CAAkC,KAAKC,eAAL,CAAqBC,IAArB,CAA0B,IAA1B,CAAlC,CAAb;EACD;;EAEgB,MAAXC,WAAW,GAAI;IACnBf,GAAG,CAACW,KAAJ,CAAU,6CAAV;IACA,OAAO,MAAM,KAAKL,cAAL,CAAoBU,YAApB,EAAb;EACD;;EAEDH,eAAe,CAAEI,KAAF,EAAS;IACtBjB,GAAG,CAACW,KAAJ,CAAW,4BAA2BO,eAAA,CAAEC,QAAF,CAAWC,IAAI,CAACC,SAAL,CAAeJ,KAAf,CAAX,CAAkC,EAAxE;IACA,KAAKR,cAAL,CAAoBa,IAApB,CAAyBL,KAAzB;;IAGA,IAAI,KAAKR,cAAL,CAAoBc,MAApB,GAA6B,KAAKhB,SAAtC,EAAiD;MAC/C,IAAIiB,YAAY,GAAG,KAAKf,cAAL,CAAoBgB,KAApB,EAAnB;MACAzB,GAAG,CAAC0B,IAAJ,CAAU,gDAA+CR,eAAA,CAAEC,QAAF,CAAWC,IAAI,CAACC,SAAL,CAAeG,YAAf,CAAX,CAAyC,EAAlG;IACD;EACF;;EAEY,MAAPG,OAAO,GAAI;IACf,IAAIC,MAAM,GAAG,KAAKnB,cAAlB;IAGAT,GAAG,CAACW,KAAJ,CAAU,0BAAV;IACA,KAAKF,cAAL,GAAsB,EAAtB;IAEA,OAAOmB,MAAP;EACD;;EAEe,MAAVC,UAAU,GAAI;IAClB,OAAO,KAAKF,OAAL,EAAP;EACD;;AA1CqB;;;eA+CTvB,iB"}