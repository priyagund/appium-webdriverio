{"version":3,"file":"ios-log.js","names":["MAX_LOG_ENTRIES_COUNT","IOSLog","EventEmitter","constructor","logs","logIdxSinceLastRequest","maxBufferSize","startCapture","Error","stopCapture","isCapturing","broadcast","logLine","logObj","timestamp","Date","now","level","message","push","emit","length","shift","getLogs","result","slice","getAllLogs"],"sources":["../../../lib/device-log/ios-log.js"],"sourcesContent":["import { EventEmitter } from 'events';\n\n// We keep only the most recent log entries to avoid out of memory error\nconst MAX_LOG_ENTRIES_COUNT = 10000;\n\nclass IOSLog extends EventEmitter {\n\n  constructor () {\n    super();\n    this.logs = [];\n    this.logIdxSinceLastRequest = -1;\n    this.maxBufferSize = MAX_LOG_ENTRIES_COUNT;\n  }\n\n  async startCapture () { // eslint-disable-line require-await\n    throw new Error(`Sub-classes need to implement a 'startCapture' function`);\n  }\n\n  async stopCapture () { // eslint-disable-line require-await\n    throw new Error(`Sub-classes need to implement a 'stopCapture' function`);\n  }\n\n  get isCapturing () {\n    throw new Error(`Sub-classes need to implement a 'isCapturing' function`);\n  }\n\n  broadcast (logLine) {\n    const logObj = {\n      timestamp: Date.now(),\n      level: 'ALL',\n      message: logLine\n    };\n    this.logs.push(logObj);\n    this.emit('output', logObj);\n    if (this.logs.length > this.maxBufferSize) {\n      this.logs.shift();\n      if (this.logIdxSinceLastRequest > 0) {\n        --this.logIdxSinceLastRequest;\n      }\n    }\n  }\n\n  getLogs () {\n    if (this.logs.length && this.logIdxSinceLastRequest < this.logs.length) {\n      let result = this.logs;\n      if (this.logIdxSinceLastRequest > 0) {\n        result = result.slice(this.logIdxSinceLastRequest);\n      }\n      this.logIdxSinceLastRequest = this.logs.length;\n      return result;\n    }\n    return [];\n  }\n\n  getAllLogs () {\n    return this.logs;\n  }\n}\n\nexport { IOSLog };\nexport default IOSLog;\n"],"mappings":";;;;;;;;;AAAA;;AAGA,MAAMA,qBAAqB,GAAG,KAA9B;;AAEA,MAAMC,MAAN,SAAqBC,oBAArB,CAAkC;EAEhCC,WAAW,GAAI;IACb;IACA,KAAKC,IAAL,GAAY,EAAZ;IACA,KAAKC,sBAAL,GAA8B,CAAC,CAA/B;IACA,KAAKC,aAAL,GAAqBN,qBAArB;EACD;;EAEiB,MAAZO,YAAY,GAAI;IACpB,MAAM,IAAIC,KAAJ,CAAW,yDAAX,CAAN;EACD;;EAEgB,MAAXC,WAAW,GAAI;IACnB,MAAM,IAAID,KAAJ,CAAW,wDAAX,CAAN;EACD;;EAEc,IAAXE,WAAW,GAAI;IACjB,MAAM,IAAIF,KAAJ,CAAW,wDAAX,CAAN;EACD;;EAEDG,SAAS,CAAEC,OAAF,EAAW;IAClB,MAAMC,MAAM,GAAG;MACbC,SAAS,EAAEC,IAAI,CAACC,GAAL,EADE;MAEbC,KAAK,EAAE,KAFM;MAGbC,OAAO,EAAEN;IAHI,CAAf;IAKA,KAAKR,IAAL,CAAUe,IAAV,CAAeN,MAAf;IACA,KAAKO,IAAL,CAAU,QAAV,EAAoBP,MAApB;;IACA,IAAI,KAAKT,IAAL,CAAUiB,MAAV,GAAmB,KAAKf,aAA5B,EAA2C;MACzC,KAAKF,IAAL,CAAUkB,KAAV;;MACA,IAAI,KAAKjB,sBAAL,GAA8B,CAAlC,EAAqC;QACnC,EAAE,KAAKA,sBAAP;MACD;IACF;EACF;;EAEDkB,OAAO,GAAI;IACT,IAAI,KAAKnB,IAAL,CAAUiB,MAAV,IAAoB,KAAKhB,sBAAL,GAA8B,KAAKD,IAAL,CAAUiB,MAAhE,EAAwE;MACtE,IAAIG,MAAM,GAAG,KAAKpB,IAAlB;;MACA,IAAI,KAAKC,sBAAL,GAA8B,CAAlC,EAAqC;QACnCmB,MAAM,GAAGA,MAAM,CAACC,KAAP,CAAa,KAAKpB,sBAAlB,CAAT;MACD;;MACD,KAAKA,sBAAL,GAA8B,KAAKD,IAAL,CAAUiB,MAAxC;MACA,OAAOG,MAAP;IACD;;IACD,OAAO,EAAP;EACD;;EAEDE,UAAU,GAAI;IACZ,OAAO,KAAKtB,IAAZ;EACD;;AAnD+B;;;eAuDnBH,M"}