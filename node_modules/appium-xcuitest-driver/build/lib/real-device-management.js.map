{"version":3,"file":"real-device-management.js","names":["getConnectedDevices","utilities","getOSVersion","udid","resetRealDevice","device","opts","bundleId","fullReset","SAFARI_BUNDLE_ID","log","debug","terminateApp","isAppInstalled","remove","err","error","message","runRealDeviceReset","noReset","installToRealDevice","app","strategy","timeout","install","getRealDeviceObj","IOSDeploy"],"sources":["../../lib/real-device-management.js"],"sourcesContent":["import { utilities } from 'appium-ios-device';\nimport IOSDeploy from './ios-deploy';\nimport log from './logger';\nimport { SAFARI_BUNDLE_ID } from './app-utils';\n\n\nasync function getConnectedDevices () {\n  return await utilities.getConnectedDevices();\n}\n\nasync function getOSVersion (udid) {\n  return await utilities.getOSVersion(udid);\n}\n\nasync function resetRealDevice (device, opts) {\n  const { bundleId, fullReset } = opts;\n  if (!bundleId) {\n    return;\n  }\n\n  if (bundleId === SAFARI_BUNDLE_ID) {\n    log.debug('Reset requested. About to terminate Safari');\n    await device.terminateApp(bundleId);\n    return;\n  }\n\n  if (!fullReset) {\n    return;\n  }\n\n  log.debug(`Reset: fullReset requested. Will try to uninstall the app '${bundleId}'.`);\n  if (!await device.isAppInstalled(bundleId)) {\n    log.debug('Reset: app not installed. No need to uninstall');\n    return;\n  }\n  try {\n    await device.remove(bundleId);\n  } catch (err) {\n    log.error(`Reset: could not remove '${bundleId}' from device: ${err.message}`);\n    throw err;\n  }\n  log.debug(`Reset: removed '${bundleId}'`);\n}\n\nasync function runRealDeviceReset (device, opts) {\n  if (!opts.noReset || opts.fullReset) {\n    log.debug('Reset: running ios real device reset flow');\n    if (!opts.noReset) {\n      await resetRealDevice(device, opts);\n    }\n  } else {\n    log.debug('Reset: fullReset not set. Leaving as is');\n  }\n}\n\nasync function installToRealDevice (device, app, bundleId, opts = {}) {\n  if (!device.udid || !app) {\n    log.debug('No device id or app, not installing to real device.');\n    return;\n  }\n\n  const {\n    noReset = false,\n    strategy,\n    timeout,\n  } = opts;\n\n  if (await device.isAppInstalled(bundleId)) {\n    if (noReset) {\n      log.debug(`App '${bundleId}' is already installed. No need to reinstall.`);\n      return;\n    }\n    log.debug(`Reset requested. Removing app with id '${bundleId}' from the device`);\n    await device.remove(bundleId);\n  }\n  log.debug(`Installing '${app}' on device with UUID '${device.udid}'...`);\n  await device.install(app, timeout, strategy);\n  log.debug('The app has been installed successfully.');\n}\n\nfunction getRealDeviceObj (udid) {\n  log.debug(`Creating iDevice object with udid '${udid}'`);\n  return new IOSDeploy(udid);\n}\n\nexport { getConnectedDevices, getOSVersion, runRealDeviceReset, installToRealDevice,\n  getRealDeviceObj };\n"],"mappings":";;;;;;;;;;;;;;;AAAA;;AACA;;AACA;;AACA;;AAGA,eAAeA,mBAAf,GAAsC;EACpC,OAAO,MAAMC,0BAAA,CAAUD,mBAAV,EAAb;AACD;;AAED,eAAeE,YAAf,CAA6BC,IAA7B,EAAmC;EACjC,OAAO,MAAMF,0BAAA,CAAUC,YAAV,CAAuBC,IAAvB,CAAb;AACD;;AAED,eAAeC,eAAf,CAAgCC,MAAhC,EAAwCC,IAAxC,EAA8C;EAC5C,MAAM;IAAEC,QAAF;IAAYC;EAAZ,IAA0BF,IAAhC;;EACA,IAAI,CAACC,QAAL,EAAe;IACb;EACD;;EAED,IAAIA,QAAQ,KAAKE,0BAAjB,EAAmC;IACjCC,eAAA,CAAIC,KAAJ,CAAU,4CAAV;;IACA,MAAMN,MAAM,CAACO,YAAP,CAAoBL,QAApB,CAAN;IACA;EACD;;EAED,IAAI,CAACC,SAAL,EAAgB;IACd;EACD;;EAEDE,eAAA,CAAIC,KAAJ,CAAW,8DAA6DJ,QAAS,IAAjF;;EACA,IAAI,EAAC,MAAMF,MAAM,CAACQ,cAAP,CAAsBN,QAAtB,CAAP,CAAJ,EAA4C;IAC1CG,eAAA,CAAIC,KAAJ,CAAU,gDAAV;;IACA;EACD;;EACD,IAAI;IACF,MAAMN,MAAM,CAACS,MAAP,CAAcP,QAAd,CAAN;EACD,CAFD,CAEE,OAAOQ,GAAP,EAAY;IACZL,eAAA,CAAIM,KAAJ,CAAW,4BAA2BT,QAAS,kBAAiBQ,GAAG,CAACE,OAAQ,EAA5E;;IACA,MAAMF,GAAN;EACD;;EACDL,eAAA,CAAIC,KAAJ,CAAW,mBAAkBJ,QAAS,GAAtC;AACD;;AAED,eAAeW,kBAAf,CAAmCb,MAAnC,EAA2CC,IAA3C,EAAiD;EAC/C,IAAI,CAACA,IAAI,CAACa,OAAN,IAAiBb,IAAI,CAACE,SAA1B,EAAqC;IACnCE,eAAA,CAAIC,KAAJ,CAAU,2CAAV;;IACA,IAAI,CAACL,IAAI,CAACa,OAAV,EAAmB;MACjB,MAAMf,eAAe,CAACC,MAAD,EAASC,IAAT,CAArB;IACD;EACF,CALD,MAKO;IACLI,eAAA,CAAIC,KAAJ,CAAU,yCAAV;EACD;AACF;;AAED,eAAeS,mBAAf,CAAoCf,MAApC,EAA4CgB,GAA5C,EAAiDd,QAAjD,EAA2DD,IAAI,GAAG,EAAlE,EAAsE;EACpE,IAAI,CAACD,MAAM,CAACF,IAAR,IAAgB,CAACkB,GAArB,EAA0B;IACxBX,eAAA,CAAIC,KAAJ,CAAU,qDAAV;;IACA;EACD;;EAED,MAAM;IACJQ,OAAO,GAAG,KADN;IAEJG,QAFI;IAGJC;EAHI,IAIFjB,IAJJ;;EAMA,IAAI,MAAMD,MAAM,CAACQ,cAAP,CAAsBN,QAAtB,CAAV,EAA2C;IACzC,IAAIY,OAAJ,EAAa;MACXT,eAAA,CAAIC,KAAJ,CAAW,QAAOJ,QAAS,+CAA3B;;MACA;IACD;;IACDG,eAAA,CAAIC,KAAJ,CAAW,0CAAyCJ,QAAS,mBAA7D;;IACA,MAAMF,MAAM,CAACS,MAAP,CAAcP,QAAd,CAAN;EACD;;EACDG,eAAA,CAAIC,KAAJ,CAAW,eAAcU,GAAI,0BAAyBhB,MAAM,CAACF,IAAK,MAAlE;;EACA,MAAME,MAAM,CAACmB,OAAP,CAAeH,GAAf,EAAoBE,OAApB,EAA6BD,QAA7B,CAAN;;EACAZ,eAAA,CAAIC,KAAJ,CAAU,0CAAV;AACD;;AAED,SAASc,gBAAT,CAA2BtB,IAA3B,EAAiC;EAC/BO,eAAA,CAAIC,KAAJ,CAAW,sCAAqCR,IAAK,GAArD;;EACA,OAAO,IAAIuB,kBAAJ,CAAcvB,IAAd,CAAP;AACD"}