{"version":3,"file":"install.js","names":["DOWNLOAD_TIMEOUT_MS","LATEST_VERSION","formatCdVersion","ver","retrieveData","CD_CDN","accept","timeout","trim","prepareChromedriverDir","platformName","chromedriverDir","getChromedriverDir","fs","exists","mkdirp","install","osInfo","getOsInfo","client","ChromedriverStorageClient","name","syncDrivers","versions","CD_VER","doInstall"],"sources":["../../lib/install.js"],"sourcesContent":["import { fs, mkdirp } from 'appium/support';\nimport ChromedriverStorageClient from './storage-client';\nimport {\n  CD_CDN, CD_VER, retrieveData, getOsInfo, getChromedriverDir,\n} from './utils';\n\n\nconst DOWNLOAD_TIMEOUT_MS = 15 * 1000;\nconst LATEST_VERSION = 'LATEST';\n\nasync function formatCdVersion (ver) {\n  return ver === LATEST_VERSION\n    ? (await retrieveData(`${CD_CDN}/LATEST_RELEASE`, {\n      'user-agent': 'appium',\n      accept: '*/*',\n    }, { timeout: DOWNLOAD_TIMEOUT_MS })).trim()\n    : ver;\n}\n\nasync function prepareChromedriverDir (platformName) {\n  const chromedriverDir = getChromedriverDir(platformName);\n  if (!await fs.exists(chromedriverDir)) {\n    await mkdirp(chromedriverDir);\n  }\n  return chromedriverDir;\n}\n\nasync function install () {\n  const osInfo = await getOsInfo();\n  const client = new ChromedriverStorageClient({\n    chromedriverDir: await prepareChromedriverDir(osInfo.name),\n  });\n  await client.syncDrivers({\n    osInfo,\n    versions: [await formatCdVersion(CD_VER)],\n  });\n}\n\nasync function doInstall () {\n  await install();\n}\n\nexport { install, doInstall };\n"],"mappings":";;;;;;;;;;;;AAAA;;AACA;;AACA;;AAKA,MAAMA,mBAAmB,GAAG,KAAK,IAAjC;AACA,MAAMC,cAAc,GAAG,QAAvB;;AAEA,eAAeC,eAAf,CAAgCC,GAAhC,EAAqC;EACnC,OAAOA,GAAG,KAAKF,cAAR,GACH,CAAC,MAAM,IAAAG,mBAAA,EAAc,GAAEC,aAAO,iBAAvB,EAAyC;IAChD,cAAc,QADkC;IAEhDC,MAAM,EAAE;EAFwC,CAAzC,EAGN;IAAEC,OAAO,EAAEP;EAAX,CAHM,CAAP,EAGoCQ,IAHpC,EADG,GAKHL,GALJ;AAMD;;AAED,eAAeM,sBAAf,CAAuCC,YAAvC,EAAqD;EACnD,MAAMC,eAAe,GAAG,IAAAC,yBAAA,EAAmBF,YAAnB,CAAxB;;EACA,IAAI,EAAC,MAAMG,WAAA,CAAGC,MAAH,CAAUH,eAAV,CAAP,CAAJ,EAAuC;IACrC,MAAM,IAAAI,eAAA,EAAOJ,eAAP,CAAN;EACD;;EACD,OAAOA,eAAP;AACD;;AAED,eAAeK,OAAf,GAA0B;EACxB,MAAMC,MAAM,GAAG,MAAM,IAAAC,gBAAA,GAArB;EACA,MAAMC,MAAM,GAAG,IAAIC,sBAAJ,CAA8B;IAC3CT,eAAe,EAAE,MAAMF,sBAAsB,CAACQ,MAAM,CAACI,IAAR;EADF,CAA9B,CAAf;EAGA,MAAMF,MAAM,CAACG,WAAP,CAAmB;IACvBL,MADuB;IAEvBM,QAAQ,EAAE,CAAC,MAAMrB,eAAe,CAACsB,aAAD,CAAtB;EAFa,CAAnB,CAAN;AAID;;AAED,eAAeC,SAAf,GAA4B;EAC1B,MAAMT,OAAO,EAAb;AACD"}